/*
 * This code is for Internal Salesforce use only, and subject to change without notice.
 * Customers shouldn't reference this file in any web pages.
 */
Sfdc.ns("Sfdc.DropdownPanel");Sfdc.DropdownPanel=function(a,b){this.id=a;this.clazz=b||"dropdownPanel";this.domObj=null;Sfdc.DropdownPanel.registerPanel(this)};Sfdc.DropdownPanel.list={};Sfdc.DropdownPanel.getPanel=function(a){return Sfdc.DropdownPanel.list[a]};Sfdc.DropdownPanel.registerPanel=function(a){Sfdc.DropdownPanel.list[a.id]=a};Sfdc.DropdownPanel.prototype.resizeEventHandler=function(a){return function(){a.close()}};Sfdc.DropdownPanel.prototype.scrollEventHandler=function(a){return function(){a.close()}};
Sfdc.DropdownPanel.prototype.clickEventHandler=function(a,b){return function(){!a.hasFocus&&Sfdc.Dom.isVisible(b)&&a.close();a.hasFocus=!1}};Sfdc.DropdownPanel.prototype.keydownEventHandler=function(a){return function(b){getEvent(b).keyCode==KEY_ESC&&a.close()}};
Sfdc.DropdownPanel.prototype.init=function(){if(!this.domObj){var a=document.createElement("div");a.id=this.id;a.className=this.clazz;document.body.appendChild(a);var b=this;addEvent(a,"mouseover",function(){b.hasFocus=!0});addEvent(a,"mouseout",function(){b.hasFocus=!1});addEvent(window,"resize",b.resizeEventHandler(b));addEvent(window,"scroll",b.scrollEventHandler(b));addEvent(document.body,"click",b.clickEventHandler(b,a));addEvent(document.body,"keydown",b.keydownEventHandler(b),!1);this.initCustomEvents();
this.domObj=a}return this.domObj};Sfdc.DropdownPanel.prototype.initCustomEvents=function(){};Sfdc.DropdownPanel.prototype.getXY=function(a){var b=0,c=0;a&&a.x&&(b=a.x);a&&a.y&&(c=a.y);return{x:b,y:c}};Sfdc.DropdownPanel.prototype.getSize=function(){return null};Sfdc.DropdownPanel.prototype.getContent=function(a){return""};Sfdc.DropdownPanel.prototype.hasFocusInitially=function(){return!0};
Sfdc.DropdownPanel.prototype.show=function(a,b){var c=this.init();if(c){this.hasFocus=this.hasFocusInitially();this.anchorElem=a;Sfdc.Dom.show(c);var d=this.getXY(b);c.style.left=d.x+"px";c.style.top=d.y+"px";if(d=this.getSize())d.width&&(c.style.width=d.width+"px"),d.height&&(c.style.height=d.height+"px");if(d=this.getContent(b))c.innerHTML=d}};Sfdc.DropdownPanel.prototype.close=function(){this.domObj&&(Sfdc.Dom.hideByDisplay(this.domObj),this.hasFocus=!1)};
function OverlayDialog(){this.dialog=this.id=null;this.isModal=!0;this.extraClass="";this.background=null;this.width=OverlayDialog.MAX_WIDTH;this.minHeight=OverlayDialog.MIN_HEIGHT;this.minWidth=OverlayDialog.MIN_WIDTH;this.buttons=[];this.info=this.header=this.title=null;this.created=this.isOpen=!1;this.allowKeyboardEsc=this.displayX=!0;this.resizing=this.moving=this.positioned=this.isAbsolutePositioned=this.isMovable=this.isResizable=!1;this.changeY=this.changeX=this.relativeY=this.relativeX=this.fixedY=
this.fixedX=0;this.wrappingPointId=this.focusPointId=null;this.focusOnShow=!0;this.useCSS=!1;this.htmlOverflow="";this.refreshOnClose=!1}OverlayDialog.MAX_BUTTONS=4;OverlayDialog.MAX_WIDTH=800;OverlayDialog.MIN_WIDTH=300;OverlayDialog.MIN_HEIGHT=200;OverlayDialog.EDGE_BUFFER=40;OverlayDialog.LOAD_MARK="OverlayLoadStart";OverlayDialog.HIDDEN_STYLE="width:2px;height:2px;position:absolute;border:0;margin:0;padding:0;background:none;outline:none;z-index:-1;cursor:none;";
OverlayDialog.prototype.addEvents=function(){if(this.id){var a=this;this.allowKeyboardEsc&&addEvent(document,"keydown",function(c){a.handleKeyPress(c)},!1);this.useCSS||(addEvent(window,"resize",function(){a.resizeEvent()},!1),Sfdc.userAgent.isIE6&&addEvent(window,"scroll",function(){a.scrollEvent()},!1))}};OverlayDialog.prototype.setTitle=function(a){this.title=a;this.created&&(document.getElementById(this.id+"Title").innerHTML=this.title)};
OverlayDialog.prototype.setHeader=function(a){this.header=a;this.created&&(document.getElementById(this.id+"Header").innerHTML=this.header)};OverlayDialog.prototype.setInfo=function(a){this.info=a;this.created&&(document.getElementById(this.id+"Info").innerHTML=this.info)};OverlayDialog.prototype.setWidth=function(a){this.width=a;this.dialog&&(Sfdc.isDefAndNotNull(a)&&(this.dialog.style.width="string"==typeof a?a:a+"px"),this.isOpen&&this.position())};
OverlayDialog.prototype.setMinHeight=function(a){this.minHeight=a};OverlayDialog.prototype.setMinWidth=function(a){this.minWidth=a};OverlayDialog.prototype.overrideButton=function(a,c,b){if(a>=OverlayDialog.MAX_BUTTONS)throw"Cannot have more than "+OverlayDialog.MAX_BUTTONS+" buttons.";this.buttons[a]={display:c,action:b}};
OverlayDialog.prototype.setupDefaultButtons=function(){this.buttons=[];this.buttons[0]={display:LC.getLabel("Buttons","ok"),action:null};this.buttons[1]={display:LC.getLabel("Buttons","cancel"),action:null}};OverlayDialog.prototype.clearButtons=function(){this.buttons=[]};
OverlayDialog.prototype.show=function(){if(this.useCSS){var a=this.getPageOverflowElement();this.htmlOverflow=a.style.overflow;a.style.overflow="hidden"}this.dialog?(this.dialog.style.display="block",this.position(),this.isModal&&(this.background||this.createBackground(),this.resizeBackground(),this.background.style.display="block",this.processSelectElems()),this.dialog.style.visibility="visible",this.isOpen=!0,Sfdc.Function.delay(this.setPrimaryFocus,1,this,[this]),window.Perf&&Perf.endMark(OverlayDialog.LOAD_MARK)):
Sfdc.log("WARNING \x3e OverlayDialog.show() was called even though no dialog object had been created with createDialog(). This means that the dialog creation failed or is stuck in the Aloha onLoad queue.")};
OverlayDialog.prototype.setPrimaryFocus=function(a,c){a||(a=this);if(!0===c){if(null!==a.wrappingPointId){var b=document.getElementById(a.wrappingPointId);if(null!==b&&!0!==b.disabled)try{b.focus()}catch(d){}else Sfdc.error(a.wrappingPointId+" could not be focused")}}else if(!0===a.focusOnShow){b=null;null!==a.focusPointId&&(b=document.getElementById(a.focusPointId));if(null===b||b.disabled||"none"===b.style.display||"hidden"===b.style.display.visibility){var e=a.dialog.getElementsByTagName("*"),
f=null,h=null;for(i=0;i<e.length;i++)if(!e[i].disabled&&!("none"===e[i].style.display||"hidden"===e[i].style.visibility)){var g=e[i].tagName;if("INPUT"===g||"TEXTAREA"===g||"SELECT"===g){h=i;break}null===f&&"A"===g&&(f=i)}null!==h?b=e[h]:null!==f&&(b=e[f])}if(null!==b&&!0!==b.disabled){try{b.focus()}catch(k){}("text"==b.type||"textarea"==b.type)&&b.select()}else Sfdc.error(a.focusPointId+" could not be focused")}};
OverlayDialog.prototype.processSelectElems=function(a){if(Sfdc.userAgent.isIE6){for(var c=document.getElementsByTagName("select"),b=c.length,d=0;d<b;d++)c[d].style.visibility=a?"visible":"hidden";if(!a){a=this.dialog.getElementsByTagName("select");c=a.length;for(d=0;d<c;d++)a[d].style.visibility="visible"}}};
OverlayDialog.prototype.hide=function(){this.isMovable&&this.stopDrag();this.isModal&&(this.background.style.display="none",this.processSelectElems(!0));this.dialog.style.visibility="hidden";Sfdc.userAgent.isFirefox||(this.dialog.style.display="none");this.useCSS&&(this.getPageOverflowElement().style.overflow=this.htmlOverflow);this.htmlOverflow="";this.isOpen=!1;this.refreshOnClose&&(Sfdc.userAgent.isChromeFrame?window.location=window.location:window.location.reload(!0))};
OverlayDialog.prototype.getPageOverflowElement=function(){return Sfdc.userAgent.isFirefox?document.body:document.documentElement};OverlayDialog.prototype.cancel=function(){this.hide()};OverlayDialog.prototype.handleKeyPress=function(a){if(this.isOpen){a=getEvent(a);var c=a.keyCode;c==KEY_ESC&&this.allowKeyboardEsc?this.handleCancel():c==KEY_ENTER&&this.captureEnter(getEventTarget(a))&&this.enter()}};
OverlayDialog.prototype.captureEnter=function(a){return"A"!=a.nodeName&&"TEXTAREA"!=a.nodeName&&"button"!=a.type};OverlayDialog.prototype.enter=function(){};OverlayDialog.prototype.handleCancel=function(){this.cancel()};
OverlayDialog.prototype.position=function(){if(this.dialog){var a=this.dialog.style;if(this.useCSS)a.marginTop=-0.25*this.dialog.offsetHeight+"px",LC&&LC.isRtlPage()?a.marginRight=-0.5*this.dialog.offsetWidth+"px":a.marginLeft=-0.5*this.dialog.offsetWidth+"px";else if(this.resizing){var c=this.startWidth+this.changeX,b=this.startHeight+this.changeY;c<this.minWidth&&(c=this.minWidth);b<this.minHeight&&(b=this.minHeight);a.width=c+"px";a.height=b+"px";document.getElementById(this.getContentId()).style.height=
b-46+"px"}else{if(c=document.getElementById(this.getContentId()))c.style.height="",c.style.overflowY="",c.style.position="",this.dialog.offsetHeight>getWindowHeight()&&(c.style.height=getWindowHeight()-100+"px",c.style.overflowY="auto",c.style.position="relative");if(this.positioned){var c=Sfdc.Window.getWindowWidth()-OverlayDialog.EDGE_BUFFER,b=Sfdc.Window.getWindowHeight()-OverlayDialog.EDGE_BUFFER,d=OverlayDialog.EDGE_BUFFER-this.dialog.offsetWidth,e=-OverlayDialog.EDGE_BUFFER/2;this.fixedX<d?
this.fixedX=d:this.fixedX>c&&(this.fixedX=c);this.fixedY<e?this.fixedY=e:this.fixedY>b&&(this.fixedY=b)}else this.setInnerHeight(),c=Sfdc.Window.getWindowWidth()-this.dialog.offsetWidth,c=6>c?6:c/2,b=Sfdc.Window.getWindowHeight()-this.dialog.offsetHeight,this.fixedX=c,this.fixedY=6>b?6:b/2;Sfdc.userAgent.isIE6?(a.left=this.fixedX+getScrollX()+"px",a.top=this.fixedY+getScrollY()+"px"):(a.left=this.fixedX+"px",a.top=this.fixedY+"px")}}};OverlayDialog.prototype.setInnerHeight=function(){};
OverlayDialog.prototype.createBackground=function(){this.background=document.createElement("div");this.background.className="overlayBackground";this.useCSS&&(Sfdc.userAgent.isSafariIOS?(this.background.style.width=document.body.scrollWidth+"px",this.background.style.height=document.body.scrollHeight+"px"):(this.background.style.width="10000px",this.background.style.height="20000px"));document.body.appendChild(this.background);var a=this;addEvent(this.background,"mousedown",function(c){a.smash(c)},
!1);addEvent(this.background,"click",function(c){a.smash(c)},!1)};OverlayDialog.prototype.resizeBackground=function(){if(this.background&&!this.useCSS&&this.created){var a=this.background.style;this.dialog.currentStyle&&Sfdc.userAgent.isIE6?(a.width=document.body.offsetWidth+"px",a.height=document.body.offsetHeight+"px"):(a.width=Math.max(document.documentElement.scrollWidth,Sfdc.Window.getWindowWidth())+"px",a.height=Math.max(document.documentElement.scrollHeight,Sfdc.Window.getWindowHeight())+"px")}};
OverlayDialog.prototype.scrollEvent=function(){this.created&&this.position()};OverlayDialog.prototype.resizeEvent=function(){this.resizeBackground();this.position()};
OverlayDialog.prototype.createDialog=function(){this.dialog=this.createDialogElement();document.body.appendChild(this.dialog);this.setWidth(this.width);var a=this;addEvent(document.getElementById(this.blurCatchId),"focus",function(){a.setPrimaryFocus(a,!0)});addEvent(document.body,"keyup",function(){if(a&&a.isOpen){for(var b=document.activeElement,c=!0;b.id!=a.id;){if(b===document.body){c=!1;break}b=b.parentNode}c||a.setPrimaryFocus(a)}});if(!this.useCSS&&(this.isMovable||this.isResizable))if(addEvent(document,
"mouseup",function(){a.stopDrag()},!1),this.isMovable&&(addEvent(this.dialog.firstChild,"mousedown",function(b){a.startMove(b)},!1),addEvent(document,"mousemove",function(b){a.move(b)},!1)),this.isResizable){var c=document.getElementById(this.id+"Resize");addEvent(c,"mousedown",function(b){a.startResize(b)},!1);addEvent(document,"mousemove",function(b){a.resize(b)},!1)}this.createContent();this.created=!0};
OverlayDialog.prototype.createDialogElement=function(){this.blurCatchId=this.id+"BlurCatch";this.focusPointId=this.id+"FocusPoint";this.wrappingPointId=this.id+"X";var a=this.id+"Title",c=document.createElement("div");c.id=this.id;c.setAttribute("role","dialog");c.setAttribute("aria-live","assertive");c.setAttribute("aria-describedby",a);var b=["overlayDialog"];this.isAbsolutePositioned&&b.push("absolutePositionedOverlayDialog");this.useCSS&&b.push("cssDialog");b.push(this.extraClass);c.className=
b.join(" ");b=[];b.push("\x3cdiv class\x3d'topRight");this.isMovable&&b.push(" movable");b.push("'\x3e");b.push("\x3ca id\x3d'"+this.focusPointId+"' ");b.push("href\x3d'javascript:void(0)' ");b.push("onclick\x3d'return false;' ");b.push("style\x3d'"+OverlayDialog.HIDDEN_STYLE+"' ");b.push("title\x3d'"+LC.getLabel("Global","startOfDialog")+"' ");this.displayX&&b.push("onfocus\x3d'document.getElementById(\""+this.wrappingPointId+"\").focus()'");b.push("\x3e");b.push(LC.getLabel("Global","startOfDialog"));
b.push("\x3c/a\x3e");b.push("\x3cdiv class\x3d'topLeft'\x3e");this.displayX&&(b.push("\x3ca id\x3d'"+this.wrappingPointId+"' title\x3d'"+LC.getLabel("Buttons","close")+"' tabindex\x3d'0' onmouseover\x3d\"this.className \x3d 'dialogCloseOn'\" onmouseout\x3d\"this.className \x3d 'dialogClose'\" onclick\x3d\"sfdcPage.getDialogById('"),b.push(this.id),b.push("').cancel()\" href\x3d'javascript:void(0)' class\x3d'dialogClose'\x3e"+LC.getLabel("Buttons","close")+"\x3c/a\x3e"));b.push("\x3ch2 id\x3d'"+a+
"'\x3e");b.push(this.title);b.push("\x3c/h2\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'middle'\x3e\x3cdiv class\x3d'innerContent' id\x3d'");b.push(this.getContentId());b.push("'\x3e\x3c/div\x3e\x3c/div\x3e");this.isResizable&&(b.push("\x3cdiv id\x3d'"),b.push(this.id),b.push("Resize' class\x3d'dialogResize'\x3e\x3c/div\x3e"));b.push('\x3cdiv class\x3d\'bottomRight\'\x3e\x3clabel style\x3d"display:none;" for \x3d"'+this.blurCatchId+"\"\x3e'\x26nbsp;'\x3c/label\x3e\x3cinput id\x3d'"+this.blurCatchId+
"' style\x3d'"+OverlayDialog.HIDDEN_STYLE+"' type\x3d'text' /\x3e\x3cdiv class\x3d'bottomLeft'\x3e\x3c/div\x3e\x3c/div\x3e");c.innerHTML=b.join("");return c};OverlayDialog.prototype.createContent=function(){};
OverlayDialog.prototype.startMove=function(a){a=getEvent(a);"IMG"!=getEventTarget(a).nodeName&&(this.moving=this.positioned=!0,this.relativeX=a.clientX-this.dialog.offsetLeft,this.relativeY=a.clientY-this.dialog.offsetTop,Sfdc.userAgent.isIE6&&(this.relativeX+=getScrollX(),this.relativeY+=getScrollY()),this.fixedX=a.clientX-this.relativeX,this.fixedY=a.clientY-this.relativeY,this.smash(a))};
OverlayDialog.prototype.startResize=function(a){a=getEvent(a);this.resizing=this.positioned=!0;this.relativeX=a.clientX;this.relativeY=a.clientY;this.startWidth=this.dialog.offsetWidth;this.startHeight=this.dialog.offsetHeight;this.smash(a)};OverlayDialog.prototype.stopDrag=function(){this.resizing=this.moving=!1};OverlayDialog.prototype.move=function(a){this.moving&&(a=getEvent(a),this.smash(a),this.fixedX=a.clientX-this.relativeX,this.fixedY=a.clientY-this.relativeY,this.position())};
OverlayDialog.prototype.resize=function(a){this.resizing&&(a=getEvent(a),this.smash(a),this.changeX=a.clientX-this.relativeX,this.changeY=a.clientY-this.relativeY,this.position())};OverlayDialog.prototype.smash=function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;a.preventDefault?a.preventDefault():a.returnValue=!1};OverlayDialog.prototype.getContentId=function(){return this.id+"Content"};
OverlayDialog.prototype.createButtons=function(a){a.push("\x3cdiv id\x3d'"+this.id+"_buttons' class\x3d'buttons ");a.push("zen");a.push("'\x3e");for(var c=0;c<this.buttons.length;c++){var b=this.buttons[c].display,d=this.buttons[c].action,e=this.buttons[c].id;a.push("\x3cinput class\x3d'");a.push("zen-btn");a.push("' type\x3d'button' value\x3d'");a.push(b);e&&(a.push("' id\x3d'"),a.push(e));a.push("' onclick\x3d\"");"string"==typeof d?(a.push("if("),a.push(d.replace(/"/,'\\"')),a.push(")")):"function"==
typeof d&&(a.push("if("),a.push(d.name),a.push("())"));a.push("sfdcPage.getDialogById('");a.push(this.id);a.push("').hide();\"\x3e")}a.push("\x3c/div\x3e")};OverlayDialog.prototype.register=function(){sfdcPage.registerDialog(this)};
function AttachmentRetryDialog(a){this.isModal=!0;this.isMovable=!1;this.width=400;this.id=a;this.title=LC.getLabel("EmailAttachmentRetry","RetryTitle");this.addEvents()}
AttachmentRetryDialog.addEventsToListenerOnPageLoad=function(){var a=this;Sfdc.EntityFeed.getEventBus().addEventListener("case:attachmentRetryDialog","onAttachLimitReached",function(c,b){var d=caseInteraction.getEmailPublisher(b.context.entityId);"undefined"!=typeof d&&(Sfdc.EntityFeed.SelectPanel.selectComponentWithOption("FeedView"),d.showPublisher(),a.context=b.context,a.fileSizes=b.fileSizes,a.limit=b.limit,a.limitDisplay=b.limitDisplay,a.availableSizeDisplay=b.availableSizeDisplay,AttachmentRetryDialog.showDialogWithPreselected(b.context,
b.retryListHtml))})};AttachmentRetryDialog.prototype=new OverlayDialog;
AttachmentRetryDialog.prototype.createContent=function(){var a=[];a.push("\x3cdiv id\x3d'"+this.id+"Inner'\x3e\x3c/div\x3e");a.push("\x3cdiv id\x3d'"+this.id+"Error' class\x3d'eaErrMsg'\x3e\x3c/div\x3e");this.overrideButton(0,LC.getLabel("EmailAttachmentRetry","RetrySubmit"),"AttachmentRetryDialog.reportAttachmentSelection()");this.overrideButton(1,LC.getLabel("Buttons","cancel"),"AttachmentRetryDialog.hideDialog()");this.buttons[0].id=this.id+"AttachmentSubmit";this.createButtons(a);document.getElementById(this.getContentId()).innerHTML=
a.join("")};
AttachmentRetryDialog.showDialogWithPreselected=function(a,c){var b="attachmentRetryPicker_"+caseInteraction.getEmailPublisherTempEmailId(a.entityId);this.attachmentRetryPopup||(this.attachmentRetryPopup=new AttachmentRetryDialog(b),this.attachmentRetryPopup.register());b=Sfdc.get(this.attachmentRetryPopup.id+"Inner");b||(sfdcPage.executeOnloadQueue(),b=Sfdc.get(this.attachmentRetryPopup.id+"Inner"));b.innerHTML=c;Sfdc.get(this.attachmentRetryPopup.id+"Error").innerHTML=LC.getLabel("EmailAttachment","MaxAttachmentSizeReached",
this.limitDisplay,this.availableSizeDisplay);this.attachmentRetryPopup.show()};AttachmentRetryDialog.hideDialog=function(){this.attachmentRetryPopup.hide()};
AttachmentRetryDialog.reportAttachmentSelection=function(){var a=[],c=document.getElementsByName("eaAttachmentIds"),b=0;for(i=0;i<c.length;i++)if(!0===c[i].checked){var d=c[i].value,b=b+this.fileSizes[d];a.push(d)}0===a.length||b>this.limit||(caseInteraction.getCaseArticles().insertArticleInlineToCaseEmail(this.context.entityId,this.context.articleId,this.context.language,this.context.versionNumber,this.context.insertRichContentToEmailEnabled,a),AttachmentRetryDialog.hideDialog())};Sfdc.onload(function(){AttachmentRetryDialog.addEventsToListenerOnPageLoad()});
Sfdc.ns("Sfdc.DragAndDropAttachment");
Sfdc.DragAndDropAttachment.createDnDAttachmentUtil=function(e){var b={dndHandles:{},url:"default",cancelOption:!1,fireEvent:function(a,b,c){"undefined"!=typeof Sfdc.EntityFeed?Sfdc.EntityFeed.getEventBus().fireEvent(a,b,c):chatter.getEventBus().fireEvent(a,b,c)},addEventListener:function(a,b,c){"undefined"!=typeof Sfdc.EntityFeed?Sfdc.EntityFeed.getEventBus().addEventListener(a,b,c):chatter.getEventBus().addEventListener(a,b,c)},showAttachmentProgressBar:function(a){b.hideAttachmentList(a);b.hideAttachmentErrorList(a);
a=Sfdc.get(".zen."+b.config.prefix+"ProgressBarCallout",Sfdc.get(a));Sfdc.Dom.isVisible(a)||Sfdc.Effects.fadeIn(a)},hideAttachmentProgressBar:function(a){a=Sfdc.get(".zen."+e+"ProgressBarCallout",Sfdc.get(a));Sfdc.Dom.isVisible(a)&&Sfdc.Effects.fadeOut(a)},hideAttachmentList:function(a){},showAttachmentErrorList:function(a){b.hideAttachmentList(a);b.hideAttachmentProgressBar(a);a=Sfdc.get(".zen."+e+"DragAndDropCallout",Sfdc.get(a));Sfdc.Dom.isVisible(a)||Sfdc.Dom.show(a)},hideAttachmentErrorList:function(a){var g=
Sfdc.get(".zen."+e+"DragAndDropCallout",Sfdc.get(a));g&&Sfdc.Dom.isVisible(g)&&(Sfdc.Dom.hideByDisplay(g),Sfdc.get("."+e+"DragAndDropErrorItem",Sfdc.get(a)).innerHTML="",b.setRefresh&&(b.refresh(),b.setRefresh=!1))},getDragAndDropAttachmentHandle:function(a){return this.dndHandles[a]},initDragAndDropAttachmentHandle:function(a){b.config=a;a.prefix=e;this.dndHandles[a.parentId]=new b.dragAndDropAttachmentHandle(a);this.dndHandles[a.parentId].initDragAndDropZone()},updateEvents:function(){},preInitTasks:function(a){return a},
getFormData:function(a,b){return new FormData},dragAndDropAttachmentHandle:function(a){this.uploadQueue=[];this.uploadInProgress=!1;this.config=a;var g=this.isDraggingFilesInProgress=!1;this.initDragAndDropZone=function(){var c=Sfdc.get(this.config.dropzoneId);if(c){var h=this,m=a.prefix+"DragAndDropOverlay_"+h.config.dropzoneId;g=b.preInitTasks(g);Sfdc.Event.removeAll(c,!1);Sfdc.Event.add(c,"dragenter",function(a){a.stopPropagation();a.preventDefault();var b=!1;if(a.dataTransfer.types)for(var c=
0;c<a.dataTransfer.types.length;c++)if("Files"==a.dataTransfer.types[c]){b=!0;break}b&&((a=Sfdc.get(m))&&Sfdc.Dom.show(a),h.isDraggingFilesInProgress=!0)});Sfdc.Event.add(c,"dragover",function(a){h.isDraggingFilesInProgress&&(a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy")});Sfdc.Event.add(c,"dragleave",function(b){h.isDraggingFilesInProgress&&(b.stopPropagation(),b.preventDefault(),b.target.className===a.prefix+"DragAndDropOverlay"&&(b=Sfdc.get(m))&&Sfdc.Dom.hideByDisplay(b))});
Sfdc.Event.add(c,"drop",function(a){if(h.isDraggingFilesInProgress){var c=Sfdc.get(m);c&&Sfdc.Dom.hideByDisplay(c);h.isDraggingFilesInProgress=!1;b.getDragAndDropAttachmentHandle(h.config.parentId).handleAttachments(a)}})}};this.handleAttachments=function(a){function h(a){pc=parseInt(100*a.loaded/a.total,10);t.value=pc;Sfdc.Dom.updateHTML(u,pc+"%")}function m(){if(0<n.uploadQueue.length)f=n.uploadQueue.pop(),Sfdc.get(d+"DragAndDropFilename").innerHTML=f.name,p=v(n.config.parentId,f,h,m,g);else{n.uploadInProgress=
!1;var a=b.config;b.hideAttachmentProgressBar(a.componentId);q?(b.setRefresh=!0,b.showAttachmentErrorList(a.componentId)):b.refresh()}}function g(a){e(a);m()}function e(a,b){q=!0;var c=Sfdc.get(d+"DragAndDropErrorItem"),c=Sfdc.Dom.create(c,"","li");b||(b=Sfdc.Dom.getText(Sfdc.get(d+"DragAndDropFilename")));Sfdc.Dom.insertHTML(c,b+"\x3cbr\x3e ("+a+")")}function s(a){return a.size>r?(e(LC.getLabel("EmailAttachment","FileSizeExceedError",r/1024/1024),a.name),!1):!0}function v(a,c,g,h,d){var e=chatter.getToolbox();
a=b.getFormData(a,c,e);var k=new XMLHttpRequest;k.open("POST",e.sitePrefix()+e.apiurl()+b.url);k.onload=function(){if(200===k.status)h();else if(k.response.substring(0,AjaxServlet.CSRF_PROTECT.length)===AjaxServlet.CSRF_PROTECT){var a=chatter.getToolbox().evalJson(k.response);a.errors?d(a.errors.message):a.errormessage?d(a.errormessage):d("Unknow Error")}else d(k.response)};k.upload.addEventListener("progress",g,!1);k.send(a);return k}var q=!1,p,d="."+this.config.prefix,l=Sfdc.get(this.config.componentId),
t=Sfdc.get(d+"DragAndDropProgressBar",l),u=Sfdc.get(d+"DragAndDropPercent",l),r=parseInt(Sfdc.Dom.get(Sfdc.get(d+"MaxFileSize",l),"value"),10),n=this;a.stopPropagation();a.preventDefault();Sfdc.get(d+"ProgressBarContainer").style.display="block";b.showAttachmentProgressBar(b.type);a=a.dataTransfer.files;for(l=0;l<a.length;l++)s(a[l])&&this.uploadQueue.push(a[l]);Sfdc.Event.removeAll(Sfdc.get(d+"DragAndDropCancel"));Sfdc.Event.add(Sfdc.get(d+"DragAndDropCancel"),"click",function(a){a.preventDefault();
p.abort();g(LC.getLabel("ChatterFileMultiUpload","cancelled"))});this.uploadInProgress||(this.uploadInProgress=!0,m())}}};return b};
function RecordAttachmentDialog(a){this.isModal=!0;this.isMovable=!1;this.width=400;this.id=a;this.title=LC.getLabel("EmailAttachment","AttachmentTitle");this.header=LC.getLabel("EmailAttachment","AttachmentHeader");this.addEvents()}
RecordAttachmentDialog.addEventsToListenerOnPageLoad=function(){Sfdc.EntityFeed.getEventBus().addEventListener("case:recordAttachmentDialog","onAttachEmailFromFilesWidget",function(a,b){var c=caseInteraction.getEmailPublisher(b.entityId);"undefined"!=typeof c&&(Sfdc.EntityFeed.SelectPanel.selectComponentWithOption("FeedView"),c.showPublisher(),RecordAttachmentDialog.showDialogWithPreselected(b.entityId,b.tempEmailId,b.preselectedId))})};RecordAttachmentDialog.prototype=new OverlayDialog;
RecordAttachmentDialog.prototype.createContent=function(){var a=[];a.push("\x3cdiv id\x3d'"+this.id+"Inner'\x3e\x3c/div\x3e");a.push("\x3cdiv id\x3d'"+this.id+"Error' class\x3d'eaErrMsg'\x3e\x3c/div\x3e");this.overrideButton(0,LC.getLabel("EmailAttachment","AttachmentSubmit"),"RecordAttachmentDialog.reportAttachmentSelection()");this.overrideButton(1,LC.getLabel("Buttons","cancel"),"RecordAttachmentDialog.hideDialog()");this.buttons[0].id=this.id+"AttachmentSubmit";this.createButtons(a);document.getElementById(this.getContentId()).innerHTML=
a.join("")};var recordAttachmentPopup;
RecordAttachmentDialog.showDialogWithPreselected=function(a,b,c){var d="attachmentPicker_"+b;recordAttachmentPopup||(recordAttachmentPopup=new RecordAttachmentDialog(d),recordAttachmentPopup.register());recordAttachmentPopup.entityId=a;recordAttachmentPopup.tempEmailId=b;chatter.getToolbox().get({url:"/draftemail/attachments",params:{entityId:a,tempEmailId:b,showMode:"RECORD_ATTACHMENTS",attachmentIds:c},success:function(a,b){var c=Sfdc.get(recordAttachmentPopup.id+"Inner");c||(sfdcPage.executeOnloadQueue(),
c=Sfdc.get(recordAttachmentPopup.id+"Inner"));c.innerHTML=b.recordAttachmentListHtml;Sfdc.get(recordAttachmentPopup.id+"Error").innerHTML="";Sfdc.get(recordAttachmentPopup.id+"AttachmentSubmit").disabled=null!==Sfdc.get(".NoAttachments",c);recordAttachmentPopup.show()}})};RecordAttachmentDialog.showDialog=function(a,b){RecordAttachmentDialog.showDialogWithPreselected(a,b,"")};RecordAttachmentDialog.hideDialog=function(){recordAttachmentPopup.hide()};
RecordAttachmentDialog.reportAttachmentSelection=function(){if(Sfdc.resolve("Sfdc.EmailAttachments")){var a=[],b=document.getElementsByName("eaAttachmentIds");for(i=0;i<b.length;i++)!0===b[i].checked&&a.push(b[i].value);0<a.length&&Sfdc.EmailAttachments.addAttachments(recordAttachmentPopup.entityId,recordAttachmentPopup.tempEmailId,a,function(a,b){Sfdc.EmailAttachments.refreshAttachments(recordAttachmentPopup.entityId,recordAttachmentPopup.tempEmailId);RecordAttachmentDialog.hideDialog()},function(a,
b){document.getElementById(recordAttachmentPopup.id+"Error").innerHTML=b.errors.message})}};Sfdc.onload(function(){RecordAttachmentDialog.addEventsToListenerOnPageLoad()});
Sfdc.provide("Sfdc.EntityWidgetCommon",function(){return{showHideActionMenu:function(a){a=Sfdc.get(".eWidgetMenuHolder",Sfdc.Dom.getParent(a));Sfdc.Dom.isVisible(a)?Sfdc.Dom.hideByDisplay(a):Sfdc.Dom.show(a)},showActionsMenuButton:function(a,b){null!==a&&("COMPLETED"===b?Sfdc.Dom.hideByDisplay(a):Sfdc.Dom.show(a))},hideActionsMenuButton:function(a){null!==a&&Sfdc.Dom.hideByDisplay(a)}}}());var entityWidgetCommon=entityWidgetCommon||Sfdc.EntityWidgetCommon;
Sfdc.ns("Sfdc.AttachedArticleFeedItems");
Sfdc.AttachedArticleFeedItems.createAttachedArticleFeedItems=function(){function n(){function g(f,a){a.attachedToEmail=[];a.allAttachedArticlefeedItems=[];entityFeedPage.getEventBus().addEventListener("case:attachments","onAfterNewAttachment",function(b,e){if(e.caseId===a.caseId&&e.article){for(var d=!1,c=0;c<a.allAttachedArticlefeedItems.length;c++)if(a.allAttachedArticlefeedItems[c].articleId===e.article.id){d=a.allAttachedArticlefeedItems[c].attachArticleFeedItemsChildDomId;break}if(d){if(c=Sfdc.get(d))c=
Sfdc.Dom.getParent(c,".attachedArticleFeedItem"),c=Sfdc.select(".caAttachToEmail",c),Sfdc.Dom.addClass(c[0],"aaDisabledMenuItem");for(c=0;c<a.attachedToEmail.length;c++)if(a.attachedToEmail[c].articleId===e.article.id)return;a.attachedToEmail.push({attachmentId:e.attachment.id,articleId:e.article.id,language:e.article.language,versionNumber:e.article.versionNumber,attachArticleFeedItemsChildDomId:d})}}});entityFeedPage.getEventBus().addEventListener("case:attachments","onAfterRemoveAttachment",function(b,
e){if(e.entityId===a.caseId)for(var d=0;d<a.attachedToEmail.length;d++)if(a.attachedToEmail[d].attachmentId===e.attachmentId){var c=a.attachedToEmail[d].attachArticleFeedItemsChildDomId;a.attachedToEmail.splice(d,1);if(d=Sfdc.get(c))d=Sfdc.Dom.getParent(d,".attachedArticleFeedItem"),d=Sfdc.select(".caAttachToEmail",d),Sfdc.Dom.removeClass(d[0],"aaDisabledMenuItem");break}});entityFeedPage.getEventBus().addEventListener("case:email","onAfterSendEmail",function(b,e){if(e.caseId===a.caseId){for(var d=
0;d<a.allAttachedArticlefeedItems.length;d++){var c=Sfdc.get(a.allAttachedArticlefeedItems[d].attachArticleFeedItemsChildDomId);c&&(c=Sfdc.Dom.getParent(c,".attachedArticleFeedItem"),c=Sfdc.select(".caAttachToEmail",c),Sfdc.Dom.removeClass(c[0],"aaDisabledMenuItem"))}a.attachedToEmail=[]}});entityFeedPage.getEventBus().addEventListener("case:articles","onAfterDetachArticle",function(b,e){if(e.caseId===a.caseId)for(var d=0;d<a.allAttachedArticlefeedItems.length;d++)if(a.allAttachedArticlefeedItems[d].articleId===
e.articleId){a.allAttachedArticlefeedItems.splice(d,1);break}});this.addAttachArticleFeedItem=function(b){for(var e=0;e<a.allAttachedArticlefeedItems.length;e++)if(a.allAttachedArticlefeedItems[e].articleId===b.articleId)return;a.allAttachedArticlefeedItems.push(b)};this.getDomId=function(){return f};this.getConfig=function(){return a}}var k=[],l=this;this.initAttachedArticleFeed=function(f,a){if("undefined"!==typeof caseInteraction){var b=l.getAttachedArticleFeedsComponentByDomId(f);b||(b=new g(f,
{caseId:a.caseId,insertRichContentToEmailEnabled:a.canBeInsertedInlineInEmail}),k.push(b));b.addAttachArticleFeedItem({articleId:a.articleId,attachArticleFeedItemsChildDomId:a.attachArticleFeedItemsChildDomId});if(b=Sfdc.get(a.attachArticleFeedItemsChildDomId))b=Sfdc.Dom.getParent(b,".attachedArticleFeedItem"),b=Sfdc.select(".attachedArticleFeedItemActions",b)[0],b.style.display="block",caseInteraction.getEmailPublisher(a.caseId)&&(caseInteraction.getEmailPublisher(a.caseId).canAttachAsPdfToEmail()&&
a.canShareArticle&&Sfdc.Dom.addClass(Sfdc.select(".caAttachToEmail",b)[0],"visible"),a.canBeInsertedInlineInEmail&&(a.canShareArticle&&!Sfdc.userAgent.isIE6&&!Sfdc.userAgent.isIE7)&&Sfdc.Dom.addClass(Sfdc.select(".caInsertInlineArticleToEmail",b)[0],"visible"),a.hasPortal&&(b=Sfdc.select(".sharePkbSite",b))&&Sfdc.Dom.addClass(b[0],"visible"))}};this.getAttachedArticleFeedsComponentByDomId=function(f){for(var a=0;a<k.length;a++)if(k[a].getDomId()===f)return k[a];return null};this.unlinkArticle=function(f,
a,b){confirm(LC.getLabel("Global","are_you_sure"))?entityFeedPage.postObjectUpdate(f,{url:"/caseinteraction/casearticles/"+a+";delete",success:function(e,d){entityFeedPage.getEventBus().fireEvent("case:articles","onAfterDetachArticle",{caseId:f,caseArticleId:a,articleId:b});var c=entityFeedPage.getEntityFeed().getEntityFeedComponentByObjectId(f);if(c){var h=Sfdc.select(".caseEventArticleId");Sfdc.each(h,function(b){b.value===a&&c.removeFeedItemElement(b)})}},failure:function(a,b){}}):Sfdc.CaseContextMenuPanel.hideContextMenu()};
this.attachArticleToEmail=function(f,a,b,e,d,c){if(!Sfdc.Dom.hasClass(f.parentNode,"aaDisabledMenuItem")){a=l.getAttachedArticleFeedsComponentByDomId(b).getConfig();for(var h=0;h<a.attachedToEmail.length;h++)if(a.attachedToEmail[h].articleId===e)return;var m=caseInteraction.getEmailPublisherTempEmailId(b);if(m){var g=new LoadingScreen(f,LC.getLabel("CaseInteraction","Attaching"));g.show();entityFeedPage.post({url:"/caseinteraction/draftemail/articles;new",params:{caseId:b,tempEmailId:m,articleId:e,
language:d,versionNumber:c},success:function(a,f){entityFeedPage.getEventBus().fireEvent("case:attachments","onAfterNewAttachment",{caseId:b,tempEmailId:m,attachment:{id:f.attachmentId,html:f.attachmentHtml},article:{id:e,language:d,versionNumber:c},entityId:b});g.hide()},failure:function(a,b){g.hide()}})}}};this.insertArticleInlineToEmail=function(f,a,b,e){f=l.getAttachedArticleFeedsComponentByDomId(f).getConfig();caseInteraction.getCaseArticles().insertArticleInlineToCaseEmail(f.caseId,a,b,e,f.insertRichContentToEmailEnabled)};
this.attachArticleAsLink=function(f,a,b){entityFeedPage.getEventBus().fireEvent("case:publisher","onAfterSelectPublisher",{caseId:f,publisherType:"email",selectIfNotEqualTo:["portal"]});entityFeedPage.getEventBus().fireEvent("case:publisher","onAfterAttachAsLink",{caseId:f,article:{url:a,title:b}})};this.showPkbLinks=function(f,a,b,e,d){function c(b){b=b||window.event;for(b=b.target||b.srcElement;b!=document.body;){if(b.id=="shareUrl_"+a||b.id==a+"Menu")return;b=b.parentNode}Sfdc.Dom.removeClass(g,
"showPkbLinks");Sfdc.Event.remove(document.body,"click",c)}var g=document.getElementById("shareUrl_"+a);Sfdc.Dom.addClass(g,"showPkbLinks");Sfdc.Event.add(document.body,"click",c)}}attachedArticleFeedItemsInner={};var g;attachedArticleFeedItemsInner.getAttachArticleFeed=function(){g||(g=new n);return g};return attachedArticleFeedItemsInner};var attachedArticleFeedItems=Sfdc.AttachedArticleFeedItems.createAttachedArticleFeedItems();
Sfdc.provide("SfdcApp.CaseArticles",function(){function s(){function f(b,a){function d(k,c){if(k.caseId===a.caseId){var g=Ext.get(b);a.isSearch?g.select(".caPendingAttachment").each(function(a){a.removeClass("caPendingAttachment");a.select(".caAttachToEmail").first().removeClass("caDisabledMenuItem");if(c){var b=a.select(".caArticleId").first().dom.value;(b=k.attachedArticles[b])&&m(a,b,!1,!0,!0)}}):e.renderBody();a.attachedToEmail=[]}}function h(){Ext.get(b).select(".caRow").each(function(b){for(var c=
b.select(".caArticleId").first().dom.value,g=b.select(".caAttachToEmail").first(),e,d=0;d<a.attachedToEmail.length;d++)if(a.attachedToEmail[d].articleId===c){e=!0;break}e?(b.addClass("caPendingAttachment"),g.addClass("caDisabledMenuItem")):(b.removeClass("caPendingAttachment"),g.removeClass("caDisabledMenuItem"))})}var e=this;a.keywords=Sfdc.String.unescapeHtml(a.defaultKeywords);a.attachedToEmail=[];entityFeedPage.getEventBus().addEventListener("case:articles","onAfterAttachArticle",function(k,c){c.caseId===
a.caseId&&(a.isSearch?Ext.get(b).select(".caRow").each(function(b){c.article.id===b.select(".caArticleId").first().dom.value&&m(b,c.caseArticleId,!0,!1,a.isSearch)}):e.renderBody())});entityFeedPage.getEventBus().addEventListener("case:articles","onAfterDetachArticle",function(e,c){c.caseId===a.caseId&&Ext.get(b).select(".caRow").each(function(b){if(c.articleId===b.select(".caArticleId").first().dom.value)if(a.isSearch)m(b,c.caseArticleId,!1,!1,a.isSearch);else{var e=b.parent(".caArticleList");b.remove();
0===e.select(".caRow").getCount()&&e.select(".caEmptyArticleList").setDisplayed(!0)}})});entityFeedPage.getEventBus().addEventListener("case:email","onAfterLoaded",function(a,b){d(b,!1)});entityFeedPage.getEventBus().addEventListener("case:email","onAfterSendEmail",function(a,b){d(b,!0)});entityFeedPage.getEventBus().addEventListener("case:attachments","onAfterNewAttachment",function(e,c){if(c.caseId===a.caseId&&c.article){Ext.get(b).select(".caRow").each(function(a){!a.hasClass("caPendingAttachment")&&
a.select(".caArticleId").first().dom.value===c.article.id&&(a.addClass("caPendingAttachment"),a.select(".caAttachToEmail").first().addClass("caDisabledMenuItem"))});for(var d=0;d<a.attachedToEmail.length;d++)if(a.attachedToEmail[d].articleId===c.article.id)return;a.attachedToEmail.push({attachmentId:c.attachment.id,articleId:c.article.id,language:c.article.language,versionNumber:c.article.versionNumber})}});entityFeedPage.getEventBus().addEventListener("case:email","onAfterAttachmentAdded",function(b,
c){c.caseId===a.caseId&&a.attachedToEmail.push({attachmentId:c.attachment.id,articleId:c.article.id,language:c.article.language,versionNumber:c.article.versionNumber})});entityFeedPage.getEventBus().addEventListener("case:attachments","onAfterRemoveAttachment",function(b,c){if(c.entityId===a.caseId){for(var e=0;e<a.attachedToEmail.length;e++)if(a.attachedToEmail[e].attachmentId===c.attachmentId){a.attachedToEmail.splice(e,1);break}h()}});entityFeedPage.getEventBus().addConsoleEventListener("onObjectFieldTextChange",
function(d,c){var h=Ext.get(b);a.isSearch&&(c.objectId===a.caseId&&h&&h.isVisible()&&1<c.text.length&&c.text!==a.keywords)&&(h.select(".caSearchText").first().dom.value=c.text,a.keywords=c.text,e.renderBody())},{fields:["cas14"]});this.getConfig=function(){return a};this.getDomId=function(){return b};this.renderBody=function(d){var c=Ext.get(b);e.loadingScreen||(e.loadingScreen=new LoadingScreen(c.select(".caBody").first().dom,LC.getLabel("Global","loading")));e.loadingScreen.show();Sfdc.EntityFeed.perfMark("RenderArticleWidget");
if(a.caseId)var g=caseInteraction.getEmailPublisherTempEmailId(a.caseId);g={url:"/caseinteraction/casearticles",params:{caseId:a.caseId,displayMode:a.displayMode,keywords:a.keywords?Sfdc.String.escapeToHtml(a.keywords):null,searchOptions:a.searchOptions?Ext.encode(a.searchOptions):null,moreStartIndex:d,isdtp:-1!=window.location.href.lastIndexOf("isdtp\x3dvw")?"vw":null,canAttachToEmail:g&&a.canAttachToEmail},success:function(b,g){e.loadingScreen.hide();var f;if(d){var p=c.select(".caMore").first().parent();
f=p.parent();p.remove()}else f=c.select(".caArticleList").first(),f.first()&&f.first().remove();(p=f.createChild(g.caseArticlesBody))&&p.dom&&Sfdc.Resource.execScripts(Sfdc.Resource.getScriptsFromHtml(p.dom));a.isSearch=0<c.select(".caSearchResult").getCount();(p=c.select(".caSearch").first())&&p.setDisplayed(a.isSearch);(p=c.select(".caAttachedList").first())&&p.setDisplayed(!a.isSearch);a.caseId&&(caseInteraction.getEmailPublisherTempEmailId(a.caseId),a.canInsertLinkToEmail&&f.select(".caAttachArticleAsLink").each(function(a){a.setDisplayed(!0)}),
h());Sfdc.EntityFeed.perfEndMark("RenderArticleWidget");if(a.isSearch&&a.onSearchSuccessScript)a.onSearchSuccessScript()},failure:function(a,b){e.loadingScreen.hide()}};e.pendingAttachedArticleRefresh?(g.params.newAttachedArticles=!0,entityFeedPage.getObjectUpdate(a.caseId,g)):entityFeedPage.get(g)};this.searchArticles=function(e,c){if(e)a.isSearch=!0,a.displayMode=e;else if(!a.isSearch)return;a.keywords=c?c:a.defaultKeywords;Ext.get(b).select(".caSearchText").first().dom.value=a.keywords;this.renderBody()};
this.moreArticles=function(a,b){this.renderBody(b)};this.showAttachedArticles=function(b){if(b)a.isSearch=!1,a.displayMode=b;else if(a.isSearch)return;this.renderBody()};this.showAdvancedSearch=function(){a.caseId&&(window.checkSessionTimeout&&checkSessionTimeout(),e.searchDialog||(e.searchDialog=new q({id:"caAdvancedSearch"+a.caseId,url:a.searchUrl,onClose:function(){e.pendingAttachedArticleRefresh&&(e.renderBody(),e.pendingAttachedArticleRefresh=null)}}),e.searchDialog.register()),e.searchDialog.open())};
this.closeAdvancedSearch=function(){e.searchDialog&&e.searchDialog.hide()};this.setPendingAttachedArticleRefresh=function(){e.pendingAttachedArticleRefresh=!0};this.initialRender=function(){a.initialRenderDone||(a.initialRenderDone=!0,this.renderBody())}}function m(b,a,d,h,e){b=Ext.get(b);var k=b.select(".caLinkStatus").first();h?(k.removeClass("caLinkedIcon"),k.addClass("caEmailedIcon")):d?k.addClass("caLinkedIcon"):(k.removeClass("caLinkedIcon"),k.removeClass("caEmailedIcon"));b.select(".caLinked").each(function(b){b.setDisplayed(d||
h);(d||h)&&b.hasClass("caMenuItem")&&b.select("a").first().dom.setAttribute("onClick","caseInteraction.getCaseArticles().unlinkArticle(this, '"+a+"', "+e+")")});b.select(".caNotLinked").each(function(a){a.setDisplayed(!d&&!h)});b.select(".caAttachUrlToEmailLinked").each(function(a){a.setDisplayed(d||h)});b.select(".caAttachUrlToEmailNotLinked").each(function(a){a.setDisplayed(!d&&!h)});b.select(".caInsertInlineArticleToEmailLinked").each(function(a){a.setDisplayed(d||h)});b.select(".caInsertInlineArticleToEmailNotLinked").each(function(a){a.setDisplayed(!d&&
!h)})}var l=this,n=[];this.initCaseArticles=function(b,a){var d=Ext.id(b);l.getCaseArticlesComponentByDomId(d)||(d=new f(d,a),n.push(d))};this.getCaseArticlesComponent=function(b){b=Ext.get(b);b.hasClass("caCaseArticles")||(b=b.parent(".caCaseArticles"));return null!==b?l.getCaseArticlesComponentByDomId(b.id):null};this.getCaseArticlesComponentByDomId=function(b){for(var a=0;a<n.length;a++)if(n[a].getDomId()===b)return n[a];return null};this.getFirstCaseArticlesComponentByParent=function(b){(b=Ext.get(b))&&
(b=b.select(".caCaseArticles").first());return null!==b?l.getCaseArticlesComponentByDomId(b.id):null};this.getCaseArticlesComponentByCaseId=function(b){for(var a=0;a<n.length;a++)if(n[a].getConfig().caseId===b)return n[a];return null};this.searchArticles=function(b,a,d){l.getCaseArticlesComponent(b).searchArticles(a,d)};this.showAttachedArticles=function(b,a){l.getCaseArticlesComponent(b).showAttachedArticles(a)};this.moreArticles=function(b,a){l.getCaseArticlesComponent(b).moreArticles(b,a)};this.showAdvancedSearch=
function(b){l.getCaseArticlesComponent(b).showAdvancedSearch()};this.onArticleLinkedToCase=function(b,a){var d=l.getCaseArticlesComponentByCaseId(b);d&&(d.setPendingAttachedArticleRefresh(),a&&d.closeAdvancedSearch())};this.onDrawerOpen=function(b){(b=l.getCaseArticlesComponent(b))&&b.initialRender()};this.unlinkArticle=function(b,a,d){if(confirm(LC.getLabel("Global","are_you_sure"))){var h=Ext.get(Sfdc.CaseContextMenuPanel.getOriginalMenuElement(b)).parent(".caRow"),e=l.getCaseArticlesComponent(h).getConfig();
entityFeedPage.postObjectUpdate(e.caseId,{url:"/caseinteraction/casearticles/"+a+";delete",success:function(b,c){var d=Ext.get(h).select(".caArticleId").first().dom.value;entityFeedPage.getEventBus().fireEvent("case:articles","onAfterDetachArticle",{caseId:e.caseId,caseArticleId:a,articleId:d});Sfdc.CaseContextMenuPanel.hideContextMenu()},failure:function(a,b){Sfdc.CaseContextMenuPanel.hideContextMenu()}})}else Sfdc.CaseContextMenuPanel.hideContextMenu()};this.linkArticle=function(b,a,d,h,e,f,c){Ext.get(Sfdc.CaseContextMenuPanel.getOriginalMenuElement(b)).parent(".caRow");
entityFeedPage.postObjectUpdate(a,{url:"/caseinteraction/casearticles;new",params:{caseId:a,articleId:d,language:h,versionNumber:e},success:function(b,f){entityFeedPage.getEventBus().fireEvent("case:articles","onAfterAttachArticle",{caseId:a,caseArticleId:f.caseArticleId,article:{id:d,language:h,versionNumber:e}});"function"===typeof c&&c();Sfdc.CaseContextMenuPanel.hideContextMenu()},failure:function(a,b){Sfdc.CaseContextMenuPanel.hideContextMenu()}})};this.showCaseArticleMenu=function(b){var a=
Ext.get(b).parent().select(".caMenuHolder").first();a&&Sfdc.CaseContextMenuPanel.showHideContextMenu(b,{menuEl:a.dom})};this.attachArticleToEmail=function(b,a,d,h,e){b=Ext.get(Sfdc.CaseContextMenuPanel.getOriginalMenuElement(b));if(!b.select(".caAttachToEmail").first().hasClass("caDisabledMenuItem")){Sfdc.CaseContextMenuPanel.hideContextMenu();b=Ext.get(b).parent(".caRow");var f=l.getCaseArticlesComponent(b).getConfig(),c=caseInteraction.getEmailPublisherTempEmailId(f.caseId);if(c){var g=new LoadingScreen(b.dom,
LC.getLabel("CaseInteraction","Attaching"));g.show();entityFeedPage.post({url:"/caseinteraction/draftemail/articles;new",params:{caseId:f.caseId,tempEmailId:c,articleId:d,language:h,versionNumber:e},success:function(a,b){entityFeedPage.getEventBus().fireEvent("case:attachments","onAfterNewAttachment",{caseId:f.caseId,tempEmailId:c,attachment:{id:b.attachmentId,html:b.attachmentHtml},article:{id:d,language:h,versionNumber:e},entityId:f.caseId});g.hide()},failure:function(a,b){g.hide()}})}}};this.insertArticleInlineToEmail=
function(b,a,d,f,e,k){var c=Ext.get(Sfdc.CaseContextMenuPanel.getOriginalMenuElement(b)),c=Ext.get(c).parent(".caRow"),c=l.getCaseArticlesComponent(c).getConfig();this.insertArticleInlineToCaseEmail(c.caseId,a,d,f,c.insertRichContentToEmailEnabled,"",e,b,k);Sfdc.CaseContextMenuPanel.hideContextMenu()};this.insertArticleInlineToCaseEmail=function(b,a,d,f,e,k,c,g,l){var n=caseInteraction.getEmailPublisherTempEmailId(b);if(n){var m=function(){var c="",g=Sfdc.isArray(k)?k.join(","):"",l=e?"richtext":
"text";entityFeedPage.get({url:"/knowledge/commChannelLayout",params:{parentId:b,tempEmailId:n,articleId:a,languageId:d,versionNumber:f,commChannel:"Email",attachmentIds:g,format:l},success:function(a,d){for(var f=d.orderedKeys,h=d.unorderedKVPairs,g=d.attachments,k=e?"\x3cbr/\x3e":"\n",m=0;m<f.length;m++){var q=f[m];""!==h[q].masterLabel&&(c+=h[q].masterLabel+k);c+=h[q].value+k}Sfdc.EntityFeed.PublisherApi.selectAction(b,{actionName:"Case.Email"});Sfdc.EntityFeed.PublisherApi.setActionInputValues(b,
{actionName:"Case.Email",emailFields:{body:{value:c,format:l,insert:!0}}});0<g.length&&entityFeedPage.getEventBus().fireEvent("case:attachments","onAfterNewAttachment",{caseId:b,tempEmailId:n,entityId:b})},failure:function(c,g){entityFeedPage.getEventBus().fireEvent("case:attachmentRetryDialog","onAttachLimitReached",{context:{entityId:b,articleId:a,language:d,versionNumber:f,insertRichContentToEmailEnabled:e},fileSizes:g.fileSizes,limit:g.limit,limitDisplay:g.limitDisplay,availableSizeDisplay:g.availableSizeDisplay,
retryListHtml:g.attachmentRetryListHtml})}})};c?this.linkArticle(g,b,a,d,f,l,m):m()}};this.attachArticleAsLink=function(b,a,d,f,e,k,c,g){var l=function(){entityFeedPage.getEventBus().fireEvent("case:publisher","onAfterSelectPublisher",{caseId:a,publisherType:"email",selectIfNotEqualTo:["portal"]});entityFeedPage.getEventBus().fireEvent("case:publisher","onAfterAttachAsLink",{caseId:a,article:{url:d,title:f}})};e&&k&&c?this.linkArticle(b,a,e,k,c,g,l):l();Sfdc.CaseContextMenuPanel.hideContextMenu()}}
function q(f){var m=this;this.config=f;this.id=f.id;this.url=f.url;this.title="Advanced Search";this.width=900;this.minHeight=650;this.open=function(){m.display();if(f.onOpen)f.onOpen(m.id)}}var r;q.prototype=new AccessibleDialog({});q.prototype.display=function(){UserContext.isAccessibleMode||this.createContent();this.show()};q.prototype.hide=function(){AccessibleDialog.prototype.hide.call(this);if(this.config.onClose)this.config.onClose()};q.prototype.getContent=function(){var f=[];f.push("\x3cdiv class\x3d'caAdvancedSearchDialog'\x3e");
f.push("\x3cdiv class\x3d'caAdvancedSearchMain'\x3e");f.push("\x3ciframe src\x3d'"+this.url+"' width\x3d'100%' class\x3d'caAdvancedSearchFrame' frameBorder\x3d'0' id\x3d'caAdvancedSearchId'\x3e\x3c/iframe\x3e");f.push("\x3c/div\x3e");f.push("\x3cdiv class\x3d'caAdvancedSearchButtons'\x3e");f.push('\x3cinput class\x3d"btn" type\x3d"button" value\x3d"'+LC.getLabel("Buttons","close")+'" title\x3d"'+LC.getLabel("Buttons","close")+'"  onClick\x3d"window.sfdcPage.getDialogById(\''+this.id+"').cancel()\" /\x3e");
f.push("\x3c/div\x3e");f.push("\x3c/div\x3e");return f.join("")};return{getCaseArticles:function(){r||(r=new s);return r}}}());
Sfdc.provide("SfdcApp.CaseFeed",function(){function f(){this.onPageLoadInit=function(){entityFeedPage.getEntityFeed().forEachFeedComponent(function(a){var b=RelatedList.get(a.getConfig().objectId+"_RelatedCommentsList");if(b)Sfdc.on(b,"relatedList:onAction",function(b,d){-1!==d.indexOf("CaseCommentToggle")&&entityFeedPage.refreshComponents(a.getConfig().objectId,!1,!1,!0)})});entityFeedPage.getEventBus().addEventListener("case:articles","onAfterDetachArticle",function(a,b){var c=entityFeedPage.getEntityFeed().getEntityFeedComponentByObjectId(b.caseId);
if(c){var d=Sfdc.select(".caseEventArticleId");Sfdc.each(d,function(a){a.value===b.caseArticleId&&c.removeFeedItemElement(a)})}})};this.postRemoveCaseComment=function(a,b){entityFeedPage.postObjectUpdate(a,b)};this.enableEmailFeedItemActions=function(a,b,c){if((a=caseInteraction.getEmailPublisher(b))&&!a.isLocked)a=Sfdc.select("."+c),Sfdc.each(a,function(a){Sfdc.Dom.removeClass(a,c)})};this.enableCommentFeedItemActions=function(a,b){if(caseInteraction.getPublicCommentPublisher(b)){var c=Sfdc.select(".postAnswerAction");
Sfdc.each(c,function(a){Sfdc.Dom.show(a)})}}}var e;return{getCaseFeed:function(){e||(e=new f);return e}}}());
Sfdc.provide("SfdcApp.CaseFeedUtil",function(){function h(){trace=!0;var f=this;this.setElementDisplay=function(a,b){Ext.isEmpty(a)||(a.setVisibilityMode(Ext.Element.DISPLAY),a.setVisible(b))};this.show=function(a){Ext.isEmpty(a)||this.setElementDisplay(a,!0)};this.hide=function(a){Ext.isEmpty(a)||this.setElementDisplay(a,!1)};this.getHeight=function(a,b){var c=a.cloneNode(!0);c.style.display="block";c.style.visibility="hidden";c.style.position="fixed";document.body.appendChild(c);var d=Sfdc.get(b,
c),d=Sfdc.Dom.getHeight(d);document.body.removeChild(c);return d};this.stringIsEmpty=function(a){return 0===a.replace(/\s+$/g,"").length};this.log=function(a){trace&&("undefined"!=typeof console&&"undefined"!=typeof console.info)&&console.info(a)};this.disableIds=function(){var a=chatter.getToolbox();Ext.each(arguments,function(b){(b=document.getElementById(b))&&a.disable(b)})};this.enableIds=function(){var a=chatter.getToolbox();Ext.each(arguments,function(b){(b=document.getElementById(b))&&a.enable(b)})};
this.disableButtonIds=function(){var a=chatter.getToolbox();Ext.each(arguments,function(b){(b=document.getElementById(b))&&a.disableButton(b)})};this.enableButtonIds=function(){var a=chatter.getToolbox();Ext.each(arguments,function(b){(b=document.getElementById(b))&&a.enableButton(b)})};this.disableIdArray=function(){Ext.each(arguments,function(a){Ext.each(a,function(a){f.disableIds(a)})})};this.enableIdArray=function(){Ext.each(arguments,function(a){Ext.each(a,function(a){f.enableIds(a)})})};this.disableButtonIdArray=
function(){Ext.each(arguments,function(a){Ext.each(a,function(a){f.disableButtonIds(a)})})};this.enableButtonIdArray=function(){Ext.each(arguments,function(a){Ext.each(a,function(a){f.enableButtonIds(a)})})};this.clearIds=function(){Ext.each(arguments,function(a){if((a=Ext.get(a))&&a.dom)a.dom.value=""})};this.getValue=function(a){return!a?"":(a=Ext.get(a))?a.dom.value:""};this.setValue=function(a,b){if(a){var c=Ext.get(a);c&&(c.dom.value=b)}};this.insertAtCursor=function(a,b){var c=Ext.get(a);if(c)if(document.selection)c.focus(),
selection=document.selection.createRange(),selection.text=b;else if(c.dom.selectionStart||"0"==c.dom.selectionStart){var d=c.dom.selectionStart,e=c.dom.selectionEnd;c.dom.value=c.dom.value.substring(0,d)+b+c.dom.value.substring(e,c.dom.value.length);e=b.replace(/\r/g,"");d+=e.length;c.dom.selectionStart=d;c.dom.selectionEnd=d}else c.dom.value+=b};this.getCursorPosition=function(a){var b=Ext.get(a),c=0;document.selection?(b.focus(),a=document.selection.createRange(),null!==a&&(b=b.dom.createTextRange(),
c=b.duplicate(),b.moveToBookmark(a.getBookmark()),c.setEndPoint("EndToStart",b),c=c.text.length)):"number"==typeof b.dom.selectionStart&&(c=b.dom.selectionStart);return c};this.setCursorOn=function(a,b){var c=Ext.get(a);c&&(c.dom.createTextRange?(c=c.dom.createTextRange(),c.move("character",b),c.select()):"number"==typeof c.dom.selectionStart&&(c.focus(),c.dom.setSelectionRange(b,b)))};this.suppressWhiteSpacePost=function(a){return a.replace(/^\s*(\S*(\s+\S+)*)\s*$/gm,"$1")};this.convertHtml2Text=
function(a){if(!a||0===a.length)return"";a=a.replace(/(<a\s[^>]*href\s*=\s*\"([^\"]*)\"[^>]*>(.*?)<\/a>)/g,"$1 \x26lt;$2\x26gt;");var b=!0;a.match(/^<br\s*\/\s*>/g)&&(b=!1);var c=document.createElement("DIV");c.innerHTML=a;return b?this.suppressWhiteSpacePost(c.textContent||c.innerText):c.textContent||c.innerText};this.extractCaseId=function(a){return a.substring(a.lastIndexOf("_")+1)};this.getId=function(a,b){return a+b};this.refreshScripts=function(a){a=a.getElementsByTagName("script");Ext.each(a,
function(a){eval(a.innerText)})};this.previousElement=function(a){do a=a.previousSibling;while(a&&1!=a.nodeType);return a};this.parentElement=function(a,b){do a=a.parentNode;while(a&&a.className!=b);return a};this.nextElement=function(a,b){do a=a.nextSibling;while(a&&a.className!=b);return a};this.isChildElementVisible=function(a,b){a=Ext.get(a);do{if(!a.isVisible())return!1;a=a.parent()}while(a&&a.id!==b);return!0};this.showChildElement=function(a,b){a=Ext.get(a);do a.isVisible()||this.setElementDisplay(a,
!0),a=a.parent();while(a&&a.id!==b)};this.populateValuesForIds=function(a,b){a&&Ext.each(a,function(a){var d="",e=Ext.get(a);if(e)if("checkbox"===e.dom.type)d=e.dom.checked?"1":"0";else if("select-multiple"===e.dom.type)for(var e=Ext.getDom(a),d=[],f=0;f<e.options.length;f++)e.options[f].selected&&d.push(e.options[f].value);else d=e.dom.value;b[a]=d})}}var g;return{getUtil:function(){g||(g=new h);return g}}}());
Sfdc.ns("Sfdc.CaseFields");
Sfdc.CaseFields.initializeFieldsTable=function(t,u,v){function q(l,m){var a=Sfdc.get(l);if(a){var h=Sfdc.Dom.getHeight(a),g=Sfdc.Dom.getWidth(a);if(!(0===h||!m&&g===r)){r=g;var h=Sfdc.select(".publisherField",a),k=Math.min(4,h.length),g=Math.min(Math.floor(g/300),k);Sfdc.Dom.removeClass(a,"twoColumn");Sfdc.Dom.removeClass(a,"threeColumn");Sfdc.Dom.removeClass(a,"fourColumn");4<=g?Sfdc.Dom.addClass(a,"fourColumn"):3===g?Sfdc.Dom.addClass(a,"threeColumn"):2===g&&Sfdc.Dom.addClass(a,"twoColumn");for(a=
0;a<h.length;a++)Sfdc.Dom.setStyles(h[a],{height:""});a=0;do{var f,k=h;f=0;for(var c=[],d=a;d<k.length;d++){var e=k[d],b=Sfdc.Dom.getElementXY(e);if(0===c.length||b.y===f)c.push(e),f=b.y;else break}f=c;a+=f.length;k=a===h.length;c=f;d=g;e=k;for(b=0;b<c.length;b++){var n=c[b];Sfdc.Dom.removeClass(n,"lastCell");Sfdc.Dom.removeClass(n,"lastRow");b===d-1&&Sfdc.Dom.addClass(n,"lastCell");e&&Sfdc.Dom.addClass(n,"lastRow")}d=f;for(e=c=0;e<d.length;e++)b=d[e].getBoundingClientRect(),b=b.bottom-b.top,b>c&&
(c=b);for(d=0;d<f.length;d++)e=f[d],b=e.getBoundingClientRect(),b=b.bottom-b.top,0<c&&b!==c&&(Sfdc.Dom.setStyles(e,{height:c+"px"}),Sfdc.Dom.addClass(e,"resizedCell"))}while(!k)}}}function p(l,m){m.objectId&&m.objectId===t&&q(s,l.eventName&&"case:publisher:onFieldValidationError"===l.eventName)}var r=0,s="#"+u+" ."+v;entityFeedPage.getEventBus().addEventListener("case:publisher","onFieldValidationError",p);entityFeedPage.getEventBus().addEventListener("entityFeed:publisher","onResize",p);entityFeedPage.getEventBus().addEventListener("entityFeed:publisher",
"onShow",p);q(s)};
Sfdc.provide("SfdcApp.CasePublisherActions",function(){function n(c,l){var b={},k=!1;b.submit=function(a){b.clearErrors();var d=b.validate(),f;d&&(f=d.paramObject);if(f)b.disable(),entityFeedPage.postObjectUpdate(c.caseId,{url:d.servletUrl,params:f,failure:function(d,e){b.enable();b.handleError(d,e);var f;f="Post Failure:"+(e&&e.errorid?" Error ID: "+e.errorid+". ":"");f+=d&&d.responseText?"\nResponse text:\n"+d.responseText:"";caseInteraction.getUtil().log(f);if(c.onFailure)c.onFailure();a&&a(!1)},
success:function(d,f){b.enable();b.clearPublisher();b.resetPublisher();b.hook_handleSuccess(d,f);if(c.onSuccess)c.onSuccess();f.subjectId=c.caseId;entityFeedPage.getEventBus().fireEvent("case:publisher","onAfterUpdateStatus",{json:f});a&&a(!0)}});else{if(c.onFailure)c.onFailure();a&&a(!1)}};b.isDefaultText=function(a){return c.defaultTextValue==a};b.focus=function(){var a=Ext.get(c.publisherTextId);a.focus();if(!c.disableCollapsingBody){var d=a.dom;c.textBody&&!k?(d.value=c.textBody,k=!0):b.isDefaultText(d.value)&&
(d.value="");a.removeClass("ghostText");c.textBodyHeight&&(a.dom.style.height=c.textBodyHeight)}};b.clearPublisher=function(){Ext.getDom(c.publisherTextId).value=""};b.resetPublisher=function(){if(!c.disableCollapsingBody){var a=Ext.get(c.publisherTextId),d=a.dom;caseInteraction.getUtil().stringIsEmpty(d.value)&&(c.textBodyHeight&&a.dom.style.removeProperty("height"),a.addClass("ghostText"),d.value=c.defaultTextValue)}};b.unfocusPublisher=function(a){if((a=Ext.fly(a.target))&&(!a.dom||!Sfdc.Dom.getParent(a.dom,
".cke_skin_sfdc")&&!(Sfdc.Dom.getParent(a.dom,".EmailHeaderClass")||Sfdc.Dom.getParent(a.dom,".optionContainer")&&Sfdc.Dom.isVisible(c.parentId,!0))))a.parent("#"+c.parentId)||b.resetPublisher()};b.clearDetailErrors=function(){var a=Ext.select(".casePublisher .errorMsg");caseInteraction.getUtil().hide(a);a.each(function(a){a.update("")});Ext.select(".casePublisher .error").each(function(a){a.removeClass("error")})};b.clearHeaderError=function(){var a=Ext.select(".casePublisher .headerErrorMsg");caseInteraction.getUtil().hide(a);
a.each(function(a){a.update("")})};b.clearErrors=function(){b.clearHeaderError();b.clearDetailErrors()};b.validateRequiredField=function(a,d,f){var c=caseInteraction.getUtil(),e=Ext.get(a);return!e?!1:c.stringIsEmpty(e.dom.value)?(b.showFieldError(a,d,f),!1):!0};b.showFieldError=function(a,b,f){var c=Ext.get(a),e=Ext.get(b);if(c&&!e){var m=c.dom.parentNode;m&&(Ext.DomHelper.append(m,{tag:"div",cls:"errorMsg",id:b}),e=Ext.get(b))}e&&f&&(e.update("\x3cstrong\x3eError: \x3c/strong\x3e"+f),SfdcApp.CaseFeedPage.getUtil().show(e));
c&&c.addClass("error");this.hookHandleFieldError(a,b,f)};b.showHeaderError=function(a,b){var f=Ext.get(a);if(f){var c="";""===f.dom.innerHTML&&(c="\x3cdiv\x3e\x3cimg src\x3d'/s.gif' class\x3d'headerErrorMsgImg'/\x3e \x3cspan\x3e"+b+"\x3c/span\x3e\x3c/div\x3e");f.update(c);SfdcApp.CaseFeedPage.getUtil().show(f)}this.hookHandleHeaderError(a,b)};b.handleError=function(a,d){var f=caseInteraction.getUtil();if(d)for(var g in d)if(d.hasOwnProperty(g)&&(0===g.indexOf("FieldError")||0===g.indexOf("HeaderError"))&&
d[g]){try{var e=Ext.util.JSON.decode(d[g])}catch(m){f.log("Error while decoding inner json string. Error:"+m);break}e&&(0===g.indexOf("FieldError")?(b.showFieldError(e.fieldId,e.errorFieldId,e.errorFieldMsg),entityFeedPage.getEventBus().fireEvent("case:publisher","onFieldValidationError",{objectId:c.caseId,fieldId:e.fieldId})):0===g.indexOf("HeaderError")&&b.showHeaderError(e.headerErrorId,e.headerErrorMsg))}};b.showPublisher=function(){var a=Ext.get(c.publisherId).findParent(".casePublisher");entityFeedPage.getPublisher().selectActionByPanel(a.id);
(a=caseInteraction.getSwitchPublisherMink(a.id+"_switchPublisherMink_"+c.caseId))&&a.switchPublisher(c.publisherType,c.headerLabel)};b.isVisible=function(){var a=Ext.get(c.publisherId).findParent(".casePublisher"),b=caseInteraction.getSwitchPublisherMink(a.id+"_switchPublisherMink_"+c.caseId);return entityFeedPage.getPublisher().isPanelSelected(a.id)&&(!b||c.publisherType===b.currentPublisher)};b.hookHandleFieldError=function(a,b,c){};b.hookHandleHeaderError=function(a,b){};b.hook_handleSuccess=function(a,
b){};b.registerUnfocusPublisherEvent=function(){Ext.get(document.body).on("click",b.unfocusPublisher)};b.setSelectOption=function(a,b){if(a&&b)for(var c=a.options,g=0;g<c.length;g++)if(c[g].value===b){c[g].selected=!0;if(a.onchange)a.onchange();return!0}return!1};b.setParentFieldValues=function(a){var d={success:!0,parentFieldErrors:{}},f;for(f in a)if(a.hasOwnProperty(f)){var g=c.fieldDomIdLookup[f.toLowerCase()],e=g?Sfdc.get(g.domId):null;if(e)if(g.isLookup)d.success=!1,d.parentFieldErrors[f]=!0;
else if("checkbox"===e.type)e.checked=a[f].value||!1;else if("select-one"===e.type)b.setSelectOption(e,a[f].value);else if("select-multiple"===e.type)if(g=a[f].values,Sfdc.isArray(a[f].values)){for(var m=e.options,h=0;h<m.length;h++){m[h].selected=!1;for(var k=0;k<g.length;k++)if(m[h].value===g[k]){m[h].selected=!0;break}}MultiSelectPicklist.handleMSPChange(e)}else d.success=!1,d.parentFieldErrors[f]=!0;else"text"===e.type||"textarea"===e.type?a[f].insert?caseInteraction.getUtil().insertAtCursor(e.id,
a[f].value):e.value=a[f].value:e.value=a[f].value;else d.success=!1,d.parentFieldErrors[f]=!0}return d};b.registerActionHandler=function(a,d){entityFeedPage.getPublisher().registerActionHandler(c.caseId,{actionName:a,onInvoke:function(a,g){b.focus();var e=Sfdc.get(c.publisherSubmitBtnId);if(e&&e.disabled)g({success:!1});else if(d.onInvoke)d.onInvoke(a,g);else b.submit(function(a){g({success:a})})},onSetInputValues:function(a,c){b.focus();d.onSetInputValues(a,function(e){if(a.parentFields){var d=b.setParentFieldValues(a.parentFields);
d.success||(e.success=!1,e.parentFieldErrors=d.parentFieldErrors)}c(e)})}})};b.initializeAndWire=function(){var a=Ext.get(c.publisherSubmitBtnId);if(a)a.on("click",function(){b.submit()})};b.initializeAndWire();if(l){var h=p[c.caseId];h||(h={},p[c.caseId]=h);h[l]=b}return b}var p={};if(window.Perf&&Perf.enabled)var q=n,n=function(c,l){function b(){Perf.endMark("Publisher: submit")}var k=c.onFailure,h=c.onSuccess;c.onFailure=k?function(){k.call(c);b()}:b;c.onSuccess=h?function(){h.call(c);b()}:b;var a=
q.call(this,c,l),d=a.submit;a.submit=function(b){Perf.mark("Publisher: submit");d.call(a,b)};return a};Sfdc.onload(function(){entityFeedPage.getEventBus().addEventListener("case:publisher","onAfterSelectPublisher",function(c,l){var b=p[l.caseId];if(b){for(var k,h=0,a=l.selectIfNotEqualTo.length;h<a;h++)if((k=b[l.selectIfNotEqualTo[h]])&&k.isVisible())return;(k=b[l.publisherType])&&k.showPublisher()}})});return{create:n}}());
Sfdc.provide("SfdcApp.CaseChangeStatusPublisherAction",function(){function h(a,e){changeStatusPubObj=SfdcApp.CasePublisherActions.create(a,"status");changeStatusPubObj.getSelectedStatusValue=function(){var b=Sfdc.get(a.publisherStatusElementId);return b.options[b.selectedIndex].value};changeStatusPubObj.initialStatus=e;changeStatusPubObj.getInitialStatus=function(){return this.initialStatus};changeStatusPubObj.validate=function(){var b=Sfdc.get(a.publisherTextId).value;b==a.defaultTextValue&&(b=null);
var g=changeStatusPubObj.getSelectedStatusValue();if(""===g)changeStatusPubObj.resetPublisher();else{var d={};d.caseId=a.caseId;d.comment=b;d.status=g;caseInteraction.getUtil().populateValuesForIds(a.additionalFieldIdArray,d);return{servletUrl:a.servletUrl,paramObject:d}}};changeStatusPubObj.disable=function(){var b=caseInteraction.getUtil();b.disableIds(a.publisherTextId,a.publisherStatusElementId);b.disableButtonIds(a.publisherSubmitBtnId)};changeStatusPubObj.enable=function(){var b=caseInteraction.getUtil();
b.enableIds(a.publisherTextId,a.publisherStatusElementId);b.enableButtonIds(a.publisherSubmitBtnId)};changeStatusPubObj.resetPublisher=function(){if(!a.disableCollapsingBody){var b=Sfdc.get(a.publisherTextId);caseInteraction.getUtil().stringIsEmpty(b.value)&&(Sfdc.Dom.addClass(b,"ghostText"),b.value=a.defaultTextValue);a.useNativeCaseStatusField||0===Sfdc.get(a.publisherStatusElementId).selectedIndex&&changeStatusPubObj.disableStatusButton()}};changeStatusPubObj.disableStatusButton=function(){caseInteraction.getUtil().disableButtonIds(a.publisherSubmitBtnId)};
changeStatusPubObj.isInitialValueSelected=function(){return a.useNativeCaseStatusField?changeStatusPubObj.getSelectedStatusValue()===changeStatusPubObj.getInitialStatus():0===Sfdc.get(a.publisherStatusElementId).selectedIndex};changeStatusPubObj.handleStatusChange=function(){var b=caseInteraction.getUtil();changeStatusPubObj.isInitialValueSelected()?b.disableButtonIds(a.publisherSubmitBtnId):b.enableButtonIds(a.publisherSubmitBtnId)};changeStatusPubObj.hook_handleSuccess=function(b,g){a.useNativeCaseStatusField&&
(this.initialStatus=g.statusValue,caseInteraction.getUtil().disableButtonIds(a.publisherSubmitBtnId))};(function(){var b=Sfdc.get(a.publisherTextId);a.disableCollapsingBody||(b.value=a.defaultTextValue,Sfdc.Dom.addClass(b,"ghostText"));Sfdc.on(b,"focus",changeStatusPubObj.focus);Sfdc.on(b,"drop",changeStatusPubObj.focus);changeStatusPubObj.disableStatusButton();if(a.useNativeCaseStatusField)Sfdc.get(a.publisherStatusElementId).onchange=changeStatusPubObj.handleStatusChange;else Sfdc.on(Sfdc.get(a.publisherStatusElementId),
"change",changeStatusPubObj.handleStatusChange);changeStatusPubObj.registerUnfocusPublisherEvent();changeStatusPubObj.registerActionHandler("Case.ChangeStatus",{onSetInputValues:function(b,d){var f={success:!0,targetFieldErrors:{}};if(b.targetFields){var c=b.targetFields.commentBody||b.targetFields.CommentBody;if(c&&c.value){var e=Sfdc.get(a.publisherTextId);if(!Sfdc.EntityFeed.QuickAction.insertIntoTextField(e,c.value,c.insertType||(c.insert?"cursor":"replace")))f.success=!1,f.targetFieldErrors.CommentBody=
!0}}if(b.parentFields&&(c=b.parentFields.status||b.parentFields.Status)&&c.value)changeStatusPubObj.setSelectOption(Sfdc.get(a.publisherStatusElementId),c.value)?changeStatusPubObj.handleStatusChange():(f.success=!1,f.parentFieldErrors.Status=!0);d(f)}});a.quickTextConfig&&(this.quickTextAutoCompleteArea=new QuickTextAutoCompleteTextArea(a.quickTextConfig))})();entityFeedPage.registerOnUpdateComponent(a.parentId,{objectId:a.caseId,componentKey:a.componentKey,updateableElementClass:a.fieldsSection,
onUpdateCallback:function(){var b=Sfdc.get(a.publisherStatusElementId);a.useNativeCaseStatusField?Sfdc.get(a.publisherStatusElementId).onchange=changeStatusPubObj.handleStatusChange:(b.selectedIndex=0,Sfdc.on(b,"change",changeStatusPubObj.handleStatusChange))}});return changeStatusPubObj}return{create:function(a,e){return h(a,e)}}}());
Ext.ns("Sfdc.CaseContextMenu");Sfdc.CaseContextMenuPanel=function(){};Sfdc.CaseContextMenuPanel.CONTEXT_MENU_ID="caseContextMenu";Sfdc.CaseContextMenu=function(a){Sfdc.DropdownPanel.call(this,a)};Ext.extend(Sfdc.CaseContextMenu,Sfdc.DropdownPanel);Sfdc.CaseContextMenu.prototype.getXY=function(){return{x:getObjX(this.anchorElem)-1,y:Sfdc.CaseContextMenu.getMenuY(this.anchorElem)+this.anchorElem.offsetHeight+1}};Sfdc.CaseContextMenu.prototype.getSize=function(){return null};
Sfdc.CaseContextMenu.prototype.getContent=function(a){this.menuEl=a.menuEl;return a.menuEl.innerHTML};Sfdc.CaseContextMenu.getMenuY=function(a){for(var b=0;null!==a;)b+=a.offsetTop,a.offsetParent&&(a.offsetParent!=document.body&&a.offsetParent!=document.documentElement&&a.offsetParent.scrollTop)&&(b-=a.offsetParent.scrollTop),a=a.offsetParent;return b};
Sfdc.CaseContextMenuPanel.getContextMenu=function(){var a=Sfdc.DropdownPanel.getPanel(Sfdc.CaseContextMenuPanel.CONTEXT_MENU_ID);a||(a=new Sfdc.CaseContextMenu(Sfdc.CaseContextMenuPanel.CONTEXT_MENU_ID));return a};Sfdc.CaseContextMenuPanel.showHideContextMenu=function(a,b){var c=Sfdc.CaseContextMenuPanel.getContextMenu(),d=Ext.get(Sfdc.CaseContextMenuPanel.CONTEXT_MENU_ID);d&&d.isVisible()?c.close():c.show(a,b)};
Sfdc.CaseContextMenuPanel.hideContextMenu=function(){var a=Sfdc.CaseContextMenuPanel.getContextMenu(),b=Ext.get(Sfdc.CaseContextMenuPanel.CONTEXT_MENU_ID);b&&b.isVisible()&&a.close()};Sfdc.CaseContextMenuPanel.getOriginalMenuElement=function(a){var b=Ext.get(Sfdc.CaseContextMenuPanel.CONTEXT_MENU_ID);if(!b)return null;a=Ext.get(a);do a=a.parent();while(a&&a!=b);return!a?null:Sfdc.CaseContextMenuPanel.getContextMenu().menuEl};
Sfdc.provide("SfdcApp.CaseEmailPublisherAction",function(){function k(a){function h(b){function a(){var c=Sfdc.get(b.publisherRteDivId),d=Sfdc.get(".clearButton",c),c=Sfdc.get(".cke_top",c),r=Sfdc.get(".cke_toolbar",c);d&&(c&&r)&&((c=Sfdc.Dom.getHeight(c,!0)<2*Sfdc.Dom.getHeight(r,!0))&&!Sfdc.Dom.hasClass(d,"singleRow")?Sfdc.Dom.addClass(d,"singleRow"):!c&&Sfdc.Dom.hasClass(d,"singleRow")&&Sfdc.Dom.removeClass(d,"singleRow"))}this.quickTextAutoCompleteArea=null;this.justFocused=!1;if(b.quickTextConfig&&
b.hasRteFormat&&"undefined"!=typeof CKEDITOR){var d=Sfdc.clone(b.quickTextConfig);d.elementId=b.publisherRteId;d.getWhoIdFunction=k;this.quickTextAutoCompleteArea=new QuickTextAutoCompleteRteArea(d,b.publisherRteId);entityFeedPage.getEventBus().addEventListener("entityFeed:publisher","onResize",function(d,f){f.objectId===b.caseId&&a()})}this.getData=function(){return CKEDITOR.instances[b.publisherRteId].getData()};this.transferContents=function(a){Ext.get(b.publisherTextId).dom.value=caseInteraction.getUtil().convertHtml2Text(CKEDITOR.instances[b.publisherRteId].getData());
a&&setTimeout(a,0)};this.setText=function(a){CKEDITOR.instances[b.publisherRteId].setData(a,function(){emailPubObj.registerEventsForRte(this)})};this.insertText=function(a,c){var d=CKEDITOR.instances[b.publisherRteId],p=d.getData(),p=!p||0===p.length;c?p?d.setData(a,function(){emailPubObj.registerEventsForRte(this)}):d.insertHtml(a):p&&Sfdc.userAgent.isFirefox?d.setData("",function(){emailPubObj.registerEventsForRte(this);d.insertText(a)}):d.insertText(a)};this.enableEmailBodyReadOnly=function(){this.disable()};
this.disableEmailBodyReadOnly=function(){this.enable()};this.initHeight=function(){};this.transferHeight=function(){var a=Sfdc.get(b.publisherTextDivId),a=caseInteraction.getUtil().getHeight(a,".caseEmailPublisherTextWrapper"),c=Sfdc.get(b.publisherRteDivId);Sfdc.get(".cke_contents",c).style.height=a+"px"};this.hide=function(){"3"===CKEDITOR.version.substr(0,1)?CKEDITOR.instances[b.publisherRteId].focusManager.forceBlur():CKEDITOR.instances[b.publisherRteId].focusManager.blur(!0);caseInteraction.getUtil().hide(Ext.get(b.publisherRteDivId))};
this.show=function(){this.transferHeight();caseInteraction.getUtil().show(Ext.get(b.publisherRteDivId));a()};this.clearContentsAndReset=function(){setTimeout(this.clearContentsAndResetNoTimeout,0)};this.clearContentsAndResetNoTimeout=function(){CKEDITOR.instances[b.publisherRteId].setData("",function(){emailPubObj.registerEventsForRte(this);caseInteraction.getEmailPublisher(b.caseId).resetPublisher()})};this.clearContents=function(){setTimeout(this.clearContentsNoTimeout,0)};this.clearContentsNoTimeout=
function(){CKEDITOR.instances[b.publisherRteId].setData("",function(){emailPubObj.registerEventsForRte(this)})};this.enable=function(){CKEDITOR.instances[b.publisherRteId].setReadOnly(!1)};this.disable=function(){CKEDITOR.instances[b.publisherRteId].setReadOnly(!0)};this.getMode=function(){return"RICH"};this.initializeValue=function(a){(null!==a||void 0!==a)&&CKEDITOR.instances[b.publisherRteId].setData(a,function(){emailPubObj.registerEventsForRte(this)})};this.setCursor=function(){this.justFocused||
(CKEDITOR.instances[b.publisherRteId].focus(),a(),this.justFocused=!0,setTimeout(function(){this.justFocused=!1},500))};this.isEmailBodyReadOnly=function(){return!1};this.getQuickTextIds=function(){return this.quickTextAutoCompleteArea?this.quickTextAutoCompleteArea.getUsedQuickTextAndPurgeList():[]}}function q(b){this.quickTextAutoCompleteArea=null;if(b.quickTextConfig&&b.hasTextFormat){var a=Sfdc.clone(b.quickTextConfig);a.getWhoIdFunction=k;this.quickTextAutoCompleteArea=new QuickTextAutoCompleteTextArea(a)}this.makeResizable=
function(){var a=Sfdc.get(b.publisherTextDivId),c=Sfdc.get(".caseEmailPublisherTextWrapper",a),a=Sfdc.get(".resizer",a),d,e,g=function(b){d=Sfdc.Event.getMouseY(b)+Sfdc.Window.getScrollY();e=Sfdc.Dom.getHeight(c);Sfdc.Event.add(document.body,"mousemove",h);Sfdc.Event.add(document.body,"mouseup",m);Sfdc.Event.stopPropagation(b);Sfdc.Event.preventDefault(b)};a&&(a.onmousedown=g);var h=function(b){var a=Sfdc.Event.getMouseY(b)+Sfdc.Window.getScrollY(),a=e+a-d;c.style.height=a+"px";Sfdc.Cookie.setCookie("emailPublisherHeight",
a);Sfdc.Event.stopPropagation(b);Sfdc.Event.preventDefault(b)},m=function(b){Sfdc.Event.remove(document.body,"mousemove",h);Sfdc.Event.remove(document.body,"mouseup",m)}};this.getData=function(){return caseInteraction.getUtil().getValue(b.publisherTextId)};this.transferContents=function(b){this.transferContentsAndUpdate(b,null)};this.transferContentsAndUpdate=function(a,c){var d=caseInteraction.getUtil().getValue(b.publisherTextId);populatePublisher=function(){CKEDITOR.instances[b.publisherRteId].setData("",
function(){emailPubObj.registerEventsForRte(this);var e=this.getSelection(),g;e&&(g=e.getRanges());0<d.length&&CKEDITOR.instances[b.publisherRteId].insertText(d);e&&e.selectRanges(g);a&&a(c)})};setTimeout(populatePublisher,0)};this.setText=function(a){caseInteraction.getUtil().setValue(b.publisherTextId,a)};this.insertText=function(a,c){caseInteraction.getUtil().insertAtCursor(b.publisherTextId,a)};var d=!1;this.enableEmailBodyReadOnly=function(){d=Ext.get(b.publisherTextId).dom.readOnly=!0};this.disableEmailBodyReadOnly=
function(){d=Ext.get(b.publisherTextId).dom.readOnly=!1};this.isEmailBodyReadOnly=function(){return d};var e;this.saveCursorPosition=function(){e=caseInteraction.getUtil().getCursorPosition(b.publisherTextId)};this.restoreCursorPosition=function(){caseInteraction.getUtil().setCursorOn(b.publisherTextId,e)};this.initHeight=function(){var a=Sfdc.Cookie.getCookie("emailPublisherHeight");if(null!==a){var c=Sfdc.get(b.publisherTextDivId);Sfdc.get(".caseEmailPublisherTextWrapper",c).style.height=a+"px"}};
this.transferHeight=function(){var a=Sfdc.get(b.publisherRteDivId),a=caseInteraction.getUtil().getHeight(a,".cke_contents"),c=Sfdc.get(b.publisherTextDivId);Sfdc.get(".caseEmailPublisherTextWrapper",c).style.height=a+"px"};this.hide=function(){SfdcApp.CaseFeedPage.getUtil().hide(Ext.get(b.publisherTextDivId))};this.show=function(){this.transferHeight();SfdcApp.CaseFeedPage.getUtil().show(Ext.get(b.publisherTextDivId))};this.clearContents=function(){Ext.getDom(b.publisherTextId).value="";Ext.getDom(b.publisherTextId).focus()};
this.clearContentsAndReset=function(){this.clearContents()};this.enable=function(){caseInteraction.getUtil().enableIds(b.publisherTextId)};this.disable=function(){caseInteraction.getUtil().disableIds(b.publisherTextId)};this.getMode=function(){return"TEXT"};this.initializeValue=function(a){if(null!==a||void 0!==a)Ext.get(b.publisherTextId).dom.value=a};this.setCursor=function(){Ext.get(b.publisherTextId).focus()};this.getQuickTextIds=function(){return this.quickTextAutoCompleteArea?this.quickTextAutoCompleteArea.getUsedQuickTextAndPurgeList():
[]}}var g;emailPubObj=SfdcApp.CasePublisherActions.create(a,"email");emailPubObj.isOptionsDisplayed=!1;emailPubObj.attachedArticles=[];emailPubObj.toEmailRecipsAutoCompl=emailRecipsAutoComplManager.getEmailRecipientsAutoComplete(a.toId);emailPubObj.ccEmailRecipsAutoCompl=emailRecipsAutoComplManager.getEmailRecipientsAutoComplete(a.ccId);emailPubObj.bccEmailRecipsAutoCompl=emailRecipsAutoComplManager.getEmailRecipientsAutoComplete(a.bccId);var k=function(){return Ext.get("caseContact_"+a.caseId).dom.value},
w=function(b,c){b.repaint&&b.repaint();Ext.EventManager.fireResize&&Ext.EventManager.fireResize();var d=Ext.get(a.switchOptionsId),e=Ext.select(".casePublisher .casePublisherHeader");c?(d.addClass("plus"),d.removeClass("minus"),d.dom.title=LC.getLabel("CaseInteraction","emailSwitchOptionsPlusAlt"),d.dom.alt=LC.getLabel("CaseInteraction","emailSwitchOptionsPlusAlt"),e.removeClass("expandedHeader"),e.addClass("collapsedHeader")):(d.addClass("minus"),d.removeClass("plus"),d.dom.title=LC.getLabel("CaseInteraction",
"emailSwitchOptionsMinusAlt"),d.dom.alt=LC.getLabel("CaseInteraction","emailSwitchOptionsMinusAlt"),e.removeClass("collapsedHeader"),e.addClass("expandedHeader"),emailPubObj.toEmailRecipsAutoCompl.doLayout(),emailPubObj.ccEmailRecipsAutoCompl.doLayout(),emailPubObj.bccEmailRecipsAutoCompl.doLayout())};emailPubObj.canAttachAsPdfToEmail=function(){return a.canAttachAsPdfToEmail};emailPubObj.switchOptions=function(){var b=Ext.select(".casePublisher .detailContent ."+a.publisherType+" .casePublisherOptionBox");
b.setVisibilityMode(Ext.Element.DISPLAY);var c=emailPubObj.isOptionsDisplayed;emailPubObj.isOptionsDisplayed?(b.slideOut("t",{callback:function(a){w(a,c)},duration:0.25}),emailPubObj.isOptionsDisplayed=!1):(b.slideIn("t",{callback:function(a){w(a,c)},duration:0.25}),emailPubObj.isOptionsDisplayed=!0)};entityFeedPage.getEventBus().addEventListener("case:attachments","onAfterNewAttachment",function(b,c){if(c.caseId===a.caseId&&c.article&&c.article.id){for(var d=0;d<emailPubObj.attachedArticles.length;d++)if(emailPubObj.attachedArticles[d].articleId==
c.article.id)return;emailPubObj.attachedArticles.push({attachmentId:c.attachment.id,articleId:c.article.id,language:c.article.language,versionNumber:c.article.versionNumber})}emailPubObj.showPublisher()});entityFeedPage.getEventBus().addEventListener("case:attachments","onAfterRemoveAttachment",function(b,c){if(c.entityId===a.caseId&&c.attachmentId)for(var d=emailPubObj.attachedArticles.length-1;0<=d;d--)if(emailPubObj.attachedArticles[d].attachmentId==c.attachmentId){emailPubObj.attachedArticles.splice(d,
1);break}});Sfdc.onload(function(){Ext.each(a.attachedArticles,function(b){entityFeedPage.getEventBus().fireEvent("case:email","onAfterAttachmentAdded",{caseId:a.caseId,attachment:{id:b.attachmentId},article:{id:b.articleId,language:b.language,versionNumber:b.versionNumber}})})});entityFeedPage.getEventBus().addEventListener("case:publisher","onAfterAttachAsLink",function(b,c){if(c.caseId===a.caseId&&emailPubObj.isVisible()){var d="",d=emailPubObj.isTextMode()?c.article.title+" - "+c.article.url:
"\x26nbsp;\x3ca href\x3d'"+c.article.url+"'\x3e"+Sfdc.String.escapeToHtml(c.article.title)+"\x3c/a\x3e\x26nbsp;",e=Ext.get(a.publisherGhostId);null!==e&&e.isVisible()&&emailPubObj.focus();emailPubObj.insertBodyText(d,!emailPubObj.isTextMode(),!1)}});emailPubObj.isArticleAttached=function(a){for(var c=0;c<emailPubObj.attachedArticles.length;c++)if(emailPubObj.attachedArticles[c].articleId==a)return!0;return!1};emailPubObj.showEmailCcBccPopup=function(){openPopup(a.emailCcBccLookupUrl,"CCBCCLookup",
600,525,"width\x3d600, height\x3d525, toolbar\x3dno, status\x3dno, location\x3dno, directories\x3dno, menubar\x3dno, resizable\x3dyes, scrollable\x3dno",!0)};emailPubObj.validateEmailPublisher=function(b){emailPubObj.collapseMutton();var c=caseInteraction.getUtil(),d=!0,e=g.getData();emailPubObj.toEmailRecipsAutoCompl.emailAddressesIsEmpty()&&(emailPubObj.showFieldError(a.toId,a.toErrorId,LC.getLabel("CaseInteraction","MissingTo")),(d=Sfdc.Dom.getParent(Sfdc.get(a.toId),".emailFieldToHidden"))&&Sfdc.Dom.removeClass(d,
"emailFieldToHidden"),d=!1);if(!emailPubObj.validateRequiredField(a.subjectId,a.subjectErrorId,LC.getLabel("CaseInteraction","MissingSubject"))){var d=!1,f=Sfdc.Dom.getParent(Sfdc.get(a.subjectId),".emailSubject");Sfdc.Dom.addClass(f,"error");emailPubObj.showSubject()}if(!d)return null;d=Ext.get(a.publisherGhostId);if(null!==d&&d.isVisible())return emailPubObj.resetPublisher(),null;if(!b&&c.stringIsEmpty(e))return alert(LC.getLabel("CaseInteraction","EmailPublisherEmptyBodyError")),null;e=c.getValue(a.fromId);
b?(b=emailPubObj.toEmailRecipsAutoCompl.getUnassociatedEmailAddresses(),d=emailPubObj.ccEmailRecipsAutoCompl.getUnassociatedEmailAddresses(),f=emailPubObj.bccEmailRecipsAutoCompl.getUnassociatedEmailAddresses()):(b=emailPubObj.toEmailRecipsAutoCompl.getEmailAddresses(),d=emailPubObj.ccEmailRecipsAutoCompl.getEmailAddresses(),f=emailPubObj.bccEmailRecipsAutoCompl.getEmailAddresses());var r=Sfdc.JSON.stringify(emailPubObj.toEmailRecipsAutoCompl.getRelatedRecipients()),p=Sfdc.JSON.stringify(emailPubObj.ccEmailRecipsAutoCompl.getRelatedRecipients()),
h=Sfdc.JSON.stringify(emailPubObj.bccEmailRecipsAutoCompl.getRelatedRecipients()),c=c.getValue(a.subjectId),n=g.getData(),l=g.getMode(),m="";a.replyId&&(m=a.replyId);var k=a.tempEmailId,v=[];a.quickTextConfig&&(textQuickTextIds=emailPubObj.getTextState().getQuickTextIds(),rteQuickTextIds=emailPubObj.getRteState().getQuickTextIds(),textQuickTextIds.concat(rteQuickTextIds),v=Ext.encode(textQuickTextIds));var x;emailPubObj.templateState.isDirty&&(x=emailPubObj.templateState.getJson());return{from:e,
to:b,cc:d,bcc:f,toRelatedRecipients:r,ccRelatedRecipients:p,bccRelatedRecipients:h,subject:c,emailBody:n,replyId:m,tempEmailId:k,mode:l,articleArticles:Ext.encode(emailPubObj.attachedArticles),templateParamsJson:x,quickTextIdsJson:v}};emailPubObj.validate=function(){var b=emailPubObj.validateEmailPublisher(!1);null!==b&&caseInteraction.getUtil().populateValuesForIds(a.additionalFieldIdArray,b);return{servletUrl:emailPubObj.getDraftEmailMessageId()?"/caseinteraction/"+a.caseId+"/sendemail/"+emailPubObj.getDraftEmailMessageId()+
";edit":"/caseinteraction/"+a.caseId+"/sendemail/;new",paramObject:b}};emailPubObj.disable=function(){var b=caseInteraction.getUtil();b.disableIds.apply(b,a.idsToDisable);g.disable();b.disableButtonIds(a.publisherSubmitBtnId)};emailPubObj.enable=function(){var b=caseInteraction.getUtil();b.enableIds.apply(b,a.idsToDisable);g.enable();b.enableButtonIds(a.publisherSubmitBtnId)};emailPubObj.isCcAvailable=function(){var b=Sfdc.get(a.ccDivId),c=Sfdc.get(a.addCcId);return b&&Sfdc.Dom.isVisible(b)||c&&Sfdc.Dom.isVisible(c)};
emailPubObj.isCcShown=!1;emailPubObj.showCc=function(){this.toggleDisplay(a.parentId,a.ccDivId,a.addCcId);emailPubObj.isCcShown=!0;emailPubObj.ccEmailRecipsAutoCompl.doLayout()};emailPubObj.hideCc=function(){this.toggleDisplay(a.parentId,a.addCcId,a.ccDivId);emailPubObj.isCcShown=!1;emailPubObj.ccEmailRecipsAutoCompl.doLayout()};emailPubObj.isBccAvailable=function(){var b=Sfdc.get(a.bccDivId),c=Sfdc.get(a.addBccId);return b&&Sfdc.Dom.isVisible(b)||c&&Sfdc.Dom.isVisible(c)};emailPubObj.isBccShown=
!1;emailPubObj.showBcc=function(){this.toggleDisplay(a.parentId,a.bccDivId,a.addBccId);emailPubObj.isBccShown=!0;emailPubObj.bccEmailRecipsAutoCompl.doLayout()};emailPubObj.hideBcc=function(){this.toggleDisplay(a.parentId,a.addBccId,a.bccDivId);emailPubObj.isBccShown=!1;emailPubObj.bccEmailRecipsAutoCompl.doLayout()};emailPubObj.isSubjectAvailable=function(){var b=Sfdc.get(a.subjectDivId),c=Sfdc.get(a.addSubjectId);return b&&Sfdc.Dom.isVisible(b)||c&&Sfdc.Dom.isVisible(c)};emailPubObj.showSubject=
function(){this.toggleDisplay(a.parentId,a.subjectDivId,a.addSubjectId)};emailPubObj.hideSubject=function(){this.toggleDisplay(a.parentId,a.addSubjectId,a.subjectDivId)};emailPubObj.toggleDisplay=function(a,c,d){a=Sfdc.get(a);(d=Sfdc.get(d,a))&&Sfdc.Dom.hideByDisplay(d);(c=Sfdc.get(c,a))&&Sfdc.Dom.show(c)};emailPubObj.switchModeAndUpdate=function(a,c){emailPubObj.isTextMode()&&(g.transferContentsAndUpdate(a,c),emailPubObj.switchModeUiState())};emailPubObj.forceSwitchMode=function(a){g.transferContents(a);
emailPubObj.switchModeUiState()};emailPubObj.switchMode=function(){if(g==emailPubObj.getRteState()){var a=g.getData();if(a&&0<a.length&&!confirm(LC.getLabel("CaseInteraction","EmailConfirmHtmlToTextSwitch")))return}else if(g.isEmailBodyReadOnly())return;emailPubObj.forceSwitchMode();entityFeedPage.getEventBus().fireEvent("case:email","onAfterSwitchMode")};emailPubObj.switchModeUiState=function(){g.hide();g=g==emailPubObj.getRteState()?emailPubObj.getTextState():emailPubObj.getRteState();g.show()};
emailPubObj.clearPublisher=function(){caseInteraction.getUtil().clearIds(a.toId,a.ccId,a.bccId,a.subjectId);g.clearContentsAndReset();emailPubObj.templateState.reset()};emailPubObj.clearAttachmentsAndArticles=function(b,c,d){a.tempEmailId=b;a.draftEmailMessageId=c;Sfdc.EmailAttachments.refreshAttachmentElement(a.caseId,b,Sfdc.get(a.publisherId),d);emailPubObj.attachedArticles=[]};emailPubObj.hookHandleFieldError=function(b,c,d){b&&(c=Ext.select(".casePublisher .casePublisherOptionBox #"+b),a.expandableOptions&&
(0<c.getCount()&&!emailPubObj.isOptionsDisplayed)&&emailPubObj.switchOptions(),b==a.addCcId&&!emailPubObj.isCcShown&&emailPubObj.showCc(),b==a.addBccId&&!emailPubObj.isBccShown&&emailPubObj.showBcc(),b=Ext.get(b),caseInteraction.getUtil().isChildElementVisible(b,a.parentId)||caseInteraction.getUtil().showChildElement(b,a.parentId))};emailPubObj.hook_handleSuccess=function(b,c){emailPubObj.setTo(a.defaultToValue);emailPubObj.setBcc(a.defaultBccValue);emailPubObj.setSubject(a.defaultSubjectValue);a.replyId=
null;emailPubObj.clearAttachmentsAndArticles(c.tempEmailId,c.draftEmailMessageId,c.attachmentsElement);entityFeedPage.getEventBus().fireEvent("case:email","onAfterSendEmail",{caseId:a.caseId,attachedArticles:Ext.util.JSON.decode(c.attachedArticles)});entityFeedPage.getEventBus().fireEvent("entityFeed:componentRegistry","onAfterComponentStateChange",{objectId:a.caseId,componentKey:"CaseEmailPublisher",componentState:{tempEmailId:a.tempEmailId,isLocked:a.isLocked}})};emailPubObj.preparePublisherForReply=
function(b,c){if(!0===emailPubObj.isLocked)alert(LC.getLabel("CaseInteraction","CannotReplyWhileDraftUnderApproval"));else{if(emailPubObj.draftState.isDirty||emailPubObj.getDraftEmailMessageId())if(!confirm(emailPubObj.getDraftEmailMessageId()?LC.getLabel("CaseInteraction","ConfirmLoseChngsLastSave"):LC.getLabel("CaseInteraction","ConfirmLoseAllChanges")))return;emailPubObj.clearErrors();var d=a.replyServletUrl+"/"+b;paramObject={isReplyAll:c};entityFeedPage.post({url:d,params:paramObject,failure:function(a,
b){emailPubObj.handleError(a,b);var c;c="Post Failure:"+(b&&b.errorid?" Error ID: "+b.errorid+". ":"");c+=a&&a.responseText?"\nResponse text:\n"+a.responseText:"";caseInteraction.getUtil().log(c)},success:function(a,d){emailPubObj.initializePublisher(d,c,b)}})}};emailPubObj.getTempEmailId=function(){return a.tempEmailId};emailPubObj.getDraftEmailMessageId=function(){return a.draftEmailMessageId};emailPubObj.canUseMode=function(b){return"TEXT"==b&&a.hasTextFormat||"RICH"==b&&a.hasRteFormat};emailPubObj.setFrom=
function(b,c){var d=Sfdc.get(a.fromId);if(d&&Sfdc.isString(b)&&(!c||Sfdc.Dom.isVisible(d,!0))){if((d=Sfdc.get(a.fromId))&&Sfdc.isString(b))for(var e=!1,f=0;f<d.options.length;f++)if(d.options[f].value.split(":")[0]==b){d.selectedIndex=f;e=!0;break}return e}return!1};emailPubObj.setTo=function(b,c){var d=Sfdc.get(a.toId);return d&&Sfdc.isString(b)&&(!c||Sfdc.Dom.isVisible(d,!0))?(emailPubObj.toEmailRecipsAutoCompl.setRecipients(!0,b),!0):!1};emailPubObj.setCc=function(b,c){return Sfdc.get(a.ccId)&&
Sfdc.isString(b)&&(!c||emailPubObj.isCcAvailable())?(emailPubObj.ccEmailRecipsAutoCompl.setRecipients(!0,b),""!==b&&!emailPubObj.isCcShown&&emailPubObj.showCc(),!0):!1};emailPubObj.setBcc=function(b,c){return Sfdc.get(a.bccId)&&Sfdc.isString(b)&&(!c||emailPubObj.isBccAvailable())?(emailPubObj.bccEmailRecipsAutoCompl.setRecipients(!0,b),""!==b&&!emailPubObj.isBccShown&&emailPubObj.showBcc(),!0):!1};emailPubObj.setSubject=function(b,c){var d=Sfdc.get(a.subjectId);return d&&Sfdc.isString(b)&&(!c||emailPubObj.isSubjectAvailable())?
(d.value=b,""!==b&&emailPubObj.showSubject(),!0):!1};emailPubObj.initializePublisher=function(b,c,d){emailPubObj.setFrom(b.defaultFrom);emailPubObj.setTo(b.to);emailPubObj.setCc(b.cc);emailPubObj.setBcc(b.bcc);emailPubObj.setSubject(b.subject);b.initialMode!=g.getMode()&&emailPubObj.canUseMode(b.initialMode)&&emailPubObj.switchModeUiState();g.initializeValue(b.body);c&&(a.expandableOptions&&!emailPubObj.isOptionsDisplayed)&&emailPubObj.switchOptions();emailPubObj.templateState.reset();emailPubObj.clearAttachmentsAndArticles(b.tempEmailId,
a.draftEmailMessageId,b.attachmentsElement);emailPubObj.showPublisher();emailPubObj.focus();a.replyId=d;entityFeedPage.getEventBus().fireEvent("case:email","onAfterLoaded",{caseId:a.caseId,loadFromReply:!0})};emailPubObj.showSelectNextApproverDialog=function(b){var c=OverlayDialogElement.getDialog(caseInteraction.getUtil().getId("ChooseApprover",a.caseId)),d=Ext.select(".approverDialogContent").first(),e=d.parent();d.remove();e.createChild(b);c.show()};emailPubObj.overlaySubmitForApproval=function(){var b=
Sfdc.get("nextApproverId_lkid");emailPubObj.submitForApproval(b.value);OverlayDialogElement.getDialog(caseInteraction.getUtil().getId("ChooseApprover",a.caseId)).hide()};emailPubObj.submitForApproval=function(b,c){if(a.isEmailDraftEnabled){emailPubObj.clearErrors();var d=emailPubObj.validateEmailPublisher(!1);if(d){caseInteraction.getUtil().populateValuesForIds(a.additionalFieldIdArray,d);b&&b!=Udd.EMPTY_KEY&&(d.nextApproverId=b);var e=Sfdc.get(a.parentId),f=Sfdc.select(".submitForApproval",e)[0];
chatter.getToolbox().disableButton(f);e=emailPubObj.getDraftEmailMessageId()?"/caseinteraction/"+a.caseId+"/submitdraftemail/"+emailPubObj.getDraftEmailMessageId()+";edit":"/caseinteraction/"+a.caseId+"/submitdraftemail/;new";entityFeedPage.postObjectUpdate(a.caseId,{url:e,params:d,failure:function(b,d){var e=Sfdc.get(a.parentId),e=Sfdc.select(".submitForApproval",e)[0];chatter.getToolbox().enableButton(e);emailPubObj.handleError(b,d);c&&c(!1)},success:function(b,d){a.draftEmailMessageId=d.draftEmailMessageId;
chatter.getToolbox().enableButton(f);d.selectNextApproverContent?(emailPubObj.draftState.draftSaved(d.draftLastSavedTime,d.draftLastSavedBy),emailPubObj.showSelectNextApproverDialog(d.selectNextApproverContent)):d.autoApprovedAndSent?(emailPubObj.enable(),emailPubObj.clearPublisher(),emailPubObj.resetPublisher(),emailPubObj.hook_handleSuccess(b,d)):d.hasBeenRejected?emailPubObj.draftState.draftAutoRejected(d.draftLastSavedTime,d.draftApprovalInfoMsg):emailPubObj.draftState.draftSubmitted(d.draftLastSavedTime,
d.draftApprovalInfoMsg,d.isLocked);c&&c(!0)}})}else c&&c(!1)}else c&&c(!1)};emailPubObj.collapseMutton=function(){var b=Sfdc.get(a.parentId);(b=Sfdc.get(".zen-select",b))&&SfdcCmp.getInstance(b).collapse()};emailPubObj.resetPublisher=function(){a.disableCollapsingBody||caseInteraction.getUtil().stringIsEmpty(g.getData())&&!a.draftEmailMessageId&&emailPubObj.hidePublisherAndShowGhostText()};emailPubObj.hidePublisherAndShowGhostText=function(){var b=Ext.get(a.publisherGhostId);b&&(emailPubObj.hidePublisher(),
SfdcApp.CaseFeedPage.getUtil().show(b))};emailPubObj.hidePublisher=function(){caseInteraction.getUtil().hide(Ext.get(a.commonPublisherId))};emailPubObj.showPublisherArea=function(){caseInteraction.getUtil().show(Ext.get(a.commonPublisherId))};emailPubObj.focus=function(){emailPubObj.focusOnPublisherArea();g.setCursor()};emailPubObj.focusOnPublisherArea=function(){var b=Ext.get(a.publisherGhostId);b&&(caseInteraction.getUtil().hide(b),emailPubObj.showPublisherArea())};emailPubObj.clearBody=function(){!0!==
emailPubObj.isLocked&&(g.clearContents(),emailPubObj.templateState.isDirty&&(emailPubObj.templateState.hasAttachmentsFromTemplate&&entityFeedPage.post({url:"/caseinteraction/draftemail/"+emailPubObj.getTempEmailId()+";edit",params:{caseId:a.caseId,tempEmailId:a.tempEmailId,operation:"deleteTemplateAttachments"},success:function(b,c){Sfdc.EmailAttachments.renderAttachmentList(a.caseId,a.tempEmailId,c.attachmentListHtml,c.totalAttachments)}}),emailPubObj.templateState.reset(),emailPubObj.disableEmailBodyReadOnly()),
entityFeedPage.getEventBus().fireEvent("case:email","onAfterClearEmailBody"))};emailPubObj.templateState=new s;emailPubObj.addTemplate=function(b,c){var d=emailPubObj.getTempEmailId(),e=emailPubObj.templateState.isLastTemplateVF;if(emailPubObj.loadingScreen){if(Sfdc.Dom.isVisible(emailPubObj.loadingScreen.getOpaqueElement()))return}else emailPubObj.loadingScreen=new LoadingScreen(Sfdc.Dom.getParent(Sfdc.get(a.parentId),".casePublisher"),LC.getLabel("Global","loading"));emailPubObj.loadingScreen.show();
emailPubObj.clearErrors();entityFeedPage.post({url:"/caseinteraction/draftemail/"+d+";edit",params:{templateId:b,tempEmailId:d,caseId:a.caseId,isLastTemplateVF:e,operation:"retrieveTemplateAndUpdateDraft",retrieveAsText:c&&c.renderTemplatesAsText},success:function(a,d){emailPubObj.loadingScreen.hide();var e={templateId:b,templateSubject:d.templateSubject,templateBodyText:d.templateBodyText,isRichText:d.isRichText,isVF:d.isVF,templateEncoding:d.templateEncoding,attachmentListHtml:d.attachmentListHtml,
totalAttachments:d.totalAttachments,replyToEmail:d.replyToEmail,emailHeaderNameArrayJson:d.emailHeaderNameArrayJson,emailHeaderValueArrayJson:d.emailHeaderValueArrayJson,errorElementId:d.errorElementId,errorMessage:d.errorMessage};e.isRichText&&emailPubObj.isTextMode()?emailPubObj.switchModeAndUpdate(emailPubObj.updatePublisherWithTemplate,e):emailPubObj.updatePublisherWithTemplate(e);c&&c.success&&c.success()},failure:function(b,d){emailPubObj.loadingScreen.hide();d.errorElementId&&(emailPubObj.showHeaderError(d.errorElementId,
d.errorMessage),a.expandableOptions&&!emailPubObj.isOptionsDisplayed&&emailPubObj.switchOptions());c&&c.failure&&c.failure()}})};emailPubObj.updatePublisherWithTemplate=function(b){var c=!1;if(b.isVF&&emailPubObj.templateState.hasTemplateSelected()||emailPubObj.templateState.isLastTemplateVF)c=!0,emailPubObj.templateState.reset();b.isVF&&!b.isRichText&&emailPubObj.disableRTE();emailPubObj.preparePublisherForEdit();emailPubObj.setSubject(b.templateSubject);b.isVF||emailPubObj.disableEmailBodyReadOnly();
c||emailPubObj.restoreCursorPosition();emailPubObj.insertBodyText(b.templateBodyText,b.isRichText,c);b.attachmentListHtml&&Sfdc.EmailAttachments.renderAttachmentList(a.caseId,a.tempEmailId,b.attachmentListHtml,b.totalAttachments);b.errorElementId&&emailPubObj.showHeaderError(b.errorElementId,b.errorMessage);emailPubObj.templateState.update({templateId:b.templateId,encoding:b.templateEncoding,isVF:b.isVF,replyToEmail:b.replyToEmail,attachmentListHtml:b.attachmentListHtml,emailHeaderNameArrayJson:b.emailHeaderNameArrayJson,
emailHeaderValueArrayJson:b.emailHeaderValueArrayJson});b.isVF&&(b.isRichText?emailPubObj.enableEmailBodyReadOnly():emailPubObj.disableEmailBodyReadOnly());entityFeedPage.getEventBus().fireEvent("case:email","onAfterAddTemplate")};emailPubObj.insertBodyText=function(a,c,d){d?g.setText(a):g.insertText(a,c)};emailPubObj.isRTEMode=function(){return g==emailPubObj.getRteState()};emailPubObj.isTextMode=function(){return g==emailPubObj.getTextState()};emailPubObj.enableRTE=function(){emailPubObj.isRTEMode()||
emailPubObj.switchMode()};emailPubObj.disableRTE=function(){emailPubObj.isRTEMode()&&emailPubObj.forceSwitchMode()};emailPubObj.enableEmailBodyReadOnly=function(){g.enableEmailBodyReadOnly()};emailPubObj.disableEmailBodyReadOnly=function(){g.disableEmailBodyReadOnly()};emailPubObj.saveCursorPosition=function(){emailPubObj.isTextMode()&&g.saveCursorPosition()};emailPubObj.restoreCursorPosition=function(){emailPubObj.isTextMode()&&g.restoreCursorPosition()};emailPubObj.preparePublisherForEdit=function(){a.expandableOptions&&
!emailPubObj.isOptionsDisplayed&&emailPubObj.switchOptions();emailPubObj.focus()};emailPubObj.renderAttachmentList=function(b,c,d){Sfdc.EmailAttachments.renderAttachmentList(a.caseId,a.tempEmailId,c,d)};var t,u;emailPubObj.getRteState=function(){return t};emailPubObj.initRteState=function(a){t||(t=new h(a))};emailPubObj.initTextState=function(a){u||(u=new q(a))};emailPubObj.getTextState=function(){return u};emailPubObj.configureCkeditor=function(){if("undefined"!=typeof CKEDITOR)CKEDITOR.on("instanceReady",
function(a){var c={indent:!1,breakBeforeOpen:!0,breakAfterOpen:!1,breakBeforeClose:!1,breakAfterClose:!0};a.editor.dataProcessor.writer.setRules("div",c);a.editor.dataProcessor.writer.setRules("ul",c);a.editor.dataProcessor.writer.setRules("ol",c);a.editor.dataProcessor.writer.setRules("li",{indent:!1,breakBeforeOpen:!1,breakAfterOpen:!0,breakBeforeClose:!1,breakAfterClose:!1});emailPubObj.registerEventsForRte(a.editor)})};emailPubObj.registerEventsForRte=function(b){if(a.quickTextConfig){var c=function(a){emailPubObj.getRteState().quickTextAutoCompleteArea.handleInput(a.data.$)},
d=function(a){emailPubObj.getRteState().quickTextAutoCompleteArea.handleNav(a.data.$)},e=function(b){entityFeedPage.getEventBus().fireEvent("action:Case.Email","onDirty",{objectId:a.caseId})};"3"===CKEDITOR.version.substr(0,1)?(b.document.on("keyup",c),b.document.on("keydown",d),b.document.on("keypress",e)):(b=b.editable(),b.attachListener(b,"keyup",c),b.attachListener(b,"keydown",d),b.attachListener(b,"keypress",e))}};emailPubObj.isLocked=!1;emailPubObj.lockPublisher=function(){emailPubObj.isLocked=
!0;var b=emailPubObj.isLocked,c=Sfdc.get(a.fromId);Sfdc.Dom.set(c,"disabled",b);for(var c=Sfdc.get(a.parentId),d=[".toTextArea",".ccTextArea",".bccTextArea",".subjectTextArea"],e=0;e<d.length;e++){var f=Sfdc.select(d[e],c)[0];Sfdc.Dom.set(f,"readOnly",b)}d=[".casePublisherOptionBox .iconLookupLink",".ceaAttachFile",".ceaAttachmentRemoveIcon"];for(e=0;e<d.length;e++)f=Sfdc.select(d[e],c),!0===b?Sfdc.Dom.hideByVisibility(f):Sfdc.Dom.show(f,!0);!0===b?emailPubObj.enableEmailBodyReadOnly():emailPubObj.disableEmailBodyReadOnly();
emailPubObj.draftState.changeDiscardLink(!b)};emailPubObj.draftState=function(){var b={isDirty:!1,reset:function(){if(a.isEmailDraftEnabled&&(b.isDirty=!1,b.changeSaveLink(!1),emailPubObj.getDraftEmailMessageId()?b.changeDiscardLink(!0):b.changeDiscardLink(!1),!emailPubObj.getDraftEmailMessageId())){var c=Sfdc.get(a.parentId),d=Sfdc.select(".cedSaveTime",c);Sfdc.Dom.updateHTML(d[0],"\x26nbsp;");c=Sfdc.select(".caseHasDraftMessage",c)[0];Sfdc.Dom.hideByDisplay(c);Sfdc.Dom.hideByDisplay(Sfdc.Dom.getParent(c,
".publisherRow"))}},init:function(){function c(){h&&clearTimeout(timer);timer=setTimeout(function(){CKEDITOR.instances[a.publisherRteId].checkDirty()&&emailPubObj.draftState.markDirty()},500)}if(a.isEmailDraftEnabled){b.reset();var d=Sfdc.get(a.parentId),e=Sfdc.select(".cedSaveLink.publisherLink",d)[0];Sfdc.on(e,"click",emailPubObj.saveDraft);e=Sfdc.select(".cedDiscardLink.publisherLink",d)[0];Sfdc.on(e,"click",emailPubObj.discardDraft);e=[".toTextArea",".ccTextArea",".bccTextArea",".subjectTextArea"];
"TEXT"==a.initialMode?e.push("#"+a.publisherTextId):e.push("#"+a.publisherRteId);Sfdc.on(Sfdc.get(a.toId),"markRecipFieldDirty",b.markDirty);Sfdc.on(Sfdc.get(a.ccId),"markRecipFieldDirty",b.markDirty);Sfdc.on(Sfdc.get(a.bccId),"markRecipFieldDirty",b.markDirty);for(var f=0;f<e.length;f++){var g=Sfdc.select(e[f],d)[0];Sfdc.on(g,"keyup",b.markDirty);Sfdc.on(g,"paste",b.markDirty)}d=Sfdc.select(".fromSelect",d)[0];Sfdc.on(d,"change",b.markDirty);if("undefined"!==typeof CKEDITOR&&CKEDITOR.instances[a.publisherRteId]){var h;
CKEDITOR.instances[a.publisherRteId].on("saveSnapshot",c);CKEDITOR.instances[a.publisherRteId].on("key",c)}entityFeedPage.getEventBus().addEventListener("case:email","onAfterSendEmail",b.reset);entityFeedPage.getEventBus().addEventListener("case:attachments","onAfterRenderAttachment",b.markDirty);entityFeedPage.getEventBus().addEventListener("case:attachments","onAfterRemoveAttachment",b.markDirty);entityFeedPage.getEventBus().addEventListener("case:email","onAfterLoaded",function(a,c){c.loadFromReply&&
b.markDirty()});entityFeedPage.getEventBus().addEventListener("case:email","onAfterSwitchMode",b.markDirty);entityFeedPage.getEventBus().addEventListener("case:email","onAfterClearEmailBody",b.markDirty);entityFeedPage.getEventBus().addEventListener("case:email","onAfterAddTemplate",b.markDirty)}},markDirty:function(){a.isEmailDraftEnabled&&!0!==emailPubObj.isLocked&&(b.isDirty=!0,b.changeSaveLink(!0))},changeSaveLink:function(b){var d=Sfdc.get(a.parentId),e=Sfdc.select(".cedSaveLink.publisherLink",
d)[0],d=Sfdc.select(".cedSaveLink.disabledPublisherLink",d)[0];b?(Sfdc.Dom.show(e),Sfdc.Dom.hideByDisplay(d)):(Sfdc.Dom.hideByDisplay(e),Sfdc.Dom.show(d))},changeDiscardLink:function(b){var d=Sfdc.get(a.parentId),e=Sfdc.select(".cedDiscardLink.publisherLink",d)[0],d=Sfdc.select(".cedDiscardLink.disabledPublisherLink",d)[0];b?(Sfdc.Dom.show(e),Sfdc.Dom.hideByDisplay(d)):(Sfdc.Dom.hideByDisplay(e),Sfdc.Dom.show(d))},draftSaved:function(c,d){if(a.isEmailDraftEnabled){b.isDirty=!1;b.changeSaveLink(!1);
b.changeDiscardLink(!0);var e=Sfdc.get(a.parentId),f=Sfdc.select(".cedSaveTime",e);Sfdc.Dom.updateHTML(f[0],c);!0!==a.isUnderApproval&&!0!==a.hasBeenRejected&&(f=Sfdc.select(".caseHasDraftMessage",e)[0],e=Sfdc.select(".caseHasDraftMessage .messageText",e)[0],Sfdc.Dom.updateHTML(e,d),Sfdc.Dom.show(f),Sfdc.Dom.show(Sfdc.Dom.getParent(f,".publisherRow")));"undefined"!==typeof CKEDITOR&&CKEDITOR.instances[a.publisherRteId]&&CKEDITOR.instances[a.publisherRteId].resetDirty()}},draftDiscarded:function(c){if(a.isEmailDraftEnabled){a.hasBeenRejected=
!1;a.isUnderApproval=!1;b.isDirty=!1;b.changeSaveLink(!1);b.changeDiscardLink(!1);var d=Sfdc.get(a.parentId),e=Sfdc.select(".cedSaveTime",d);Sfdc.Dom.updateHTML(e[0],c);c=Sfdc.select(".caseHasDraftMessage",d)[0];Sfdc.Dom.hideByDisplay(c);Sfdc.Dom.hideByDisplay(Sfdc.Dom.getParent(c,".publisherRow"));"undefined"!==typeof CKEDITOR&&CKEDITOR.instances[a.publisherRteId]&&setTimeout(function(){CKEDITOR.instances[a.publisherRteId].resetDirty()},0);emailPubObj.isLocked&&emailPubObj.unlockPublisher();(d=Sfdc.select(".casePublisherSendButtonBox",
d))&&Sfdc.Dom.show(d,!0)}},draftAutoRejected:function(c,d,e){b.draftSaved(c,d);a.hasBeenRejected=!0;a.isUnderApproval=!1},draftSubmitted:function(c,d,e){a.hasBeenRejected=!1;b.draftSaved(c,d);"true"==e&&emailPubObj.lockPublisher();a.isUnderApproval=!0;c=Sfdc.get(a.parentId);(c=Sfdc.select(".casePublisherSendButtonBox",c))&&Sfdc.Dom.hideByDisplay(c)}};return b}();emailPubObj.saveDraft=function(){if(a.isEmailDraftEnabled){emailPubObj.clearErrors();var b=emailPubObj.validateEmailPublisher(!0);if(b){emailPubObj.draftState.changeSaveLink(!1);
var c;c=emailPubObj.getDraftEmailMessageId()?"/caseinteraction/"+a.caseId+"/draftemail/"+emailPubObj.getDraftEmailMessageId()+";edit":"/caseinteraction/"+a.caseId+"/draftemail/;new";entityFeedPage.postObjectUpdate(a.caseId,{url:c,params:b,failure:function(a,b){emailPubObj.handleError(a,b);var c;c="Post Failure:"+(b&&b.errorid?" Error ID: "+b.errorid+". ":"");c+=a&&a.responseText?"\nResponse text:\n"+a.responseText:"";caseInteraction.getUtil().log(c);emailPubObj.draftState.changeSaveLink(!0)},success:function(b,
c){a.draftEmailMessageId=c.draftEmailMessageId;emailPubObj.draftState.draftSaved(c.draftLastSavedTime,c.draftLastSavedBy)}})}}};emailPubObj.discardDraft=function(){if(a.isEmailDraftEnabled&&confirm(LC.getLabel("CaseInteraction","EmailConfirmDiscardDraft"))){var b=emailPubObj.getTempEmailId(),c=emailPubObj.getDraftEmailMessageId();!b||!c?caseInteraction.getUtil().log("Illegal state. During discard draft, tempemailid and draftemailMessageId should be populated"):(emailPubObj.draftState.changeDiscardLink(!1),
entityFeedPage.postObjectUpdate(a.caseId,{url:"/caseinteraction/"+a.caseId+"/draftemail/"+c+";delete",params:{},success:function(b,c){a.replyId=null;entityFeedPage.getEventBus().fireEvent("case:email","onAfterLoaded",{caseId:a.caseId,loadFromReply:!1});emailPubObj.clearPublisher();emailPubObj.clearAttachmentsAndArticles(c.tempEmailId,c.draftEmailMessageId,c.attachmentsElement);emailPubObj.draftState.draftDiscarded(c.draftLastSavedTime)},failure:function(a,b){var c;c="Post Failure:"+(b&&b.errorid?
" Error ID: "+b.errorid+". ":"");c+=a&&a.responseText?"\nResponse text:\n"+a.responseText:"";caseInteraction.getUtil().log(c);emailPubObj.draftState.changeDiscardLink(!0)}}))}};if(Ext.get(a.parentId).select("."+a.fieldsSection).first()){var y={};y.showAdditionalFields=a.showAdditionalFields;entityFeedPage.registerOnUpdateComponent(a.parentId,{objectId:a.caseId,componentKey:a.componentKey,updateableElementClass:a.fieldsSection,componentState:{tempEmailId:a.tempEmailId},componentContext:Ext.encode(y)})}(function(){if(a.expandableOptions){var b=
Ext.get(a.switchOptionsId+"_div");if(b)b.on("click",function(a,b,e){emailPubObj.switchOptions()})}emailPubObj.initRteState(a);emailPubObj.initTextState(a);g="TEXT"==a.initialMode?emailPubObj.getTextState():emailPubObj.getRteState();g.initHeight();a.draftEmailMessageId||emailPubObj.hidePublisherAndShowGhostText();emailPubObj.configureCkeditor();if(b=Ext.get(a.publisherGhostId))b.on("focus",emailPubObj.focus),b.on("drop",emailPubObj.focus);emailPubObj.registerUnfocusPublisherEvent();a.attachedArticles&&
(emailPubObj.attachedArticles=a.attachedArticles);emailPubObj.draftState.init();""!==a.initialTemplateId&&emailPubObj.templateState.update({templateId:a.initialTemplateId,encoding:a.encoding,isVF:a.isVF,replyToEmail:a.replyToEmail,emailHeaderNameArrayJson:a.emailHeaderNameArrayJson,emailHeaderValueArrayJson:a.emailHeaderValueArrayJson});(b=Sfdc.get("submitSendMutton"+a.caseId))&&SfdcCmp.bind(b);if(b=Ext.get(a.parentId).select(".submitForApproval"))b.on("click",function(){emailPubObj.submitForApproval()});
if(!0===a.isLocked&&(emailPubObj.lockPublisher(),"TEXT"!==a.initialNode&&"undefined"!=typeof CKEDITOR))CKEDITOR.on("instanceReady",function(a){g.enableEmailBodyReadOnly()});b=function(){var a=Sfdc.get(".cke_wysiwyg_frame");a&&Sfdc.Dom.setStyle(a,"width","100%")};entityFeedPage.getEventBus().addEventListener("case:email","onAfterSwitchMode",b);entityFeedPage.getEventBus().addEventListener("case:email","onAfterAddTemplate",b);entityFeedPage.getEventBus().addEventListener("entityFeed:publisher","onShow",
b);emailPubObj.registerActionHandler("Case.Email",{onInvoke:function(b,d){if(!emailPubObj.isLocked){var e=function(a){d({success:a})};if(a.canSendEmail&&(!b.submitType||"send"===b.submitType)){emailPubObj.submit(e);return}if(a.canSubmitForApproval&&(!b.submitType||"submitForApproval"===b.submitType||"approval"===b.submitType)){emailPubObj.submitForApproval(null,e);return}}d({success:!1})},onSetInputValues:function(b,d){var e={success:!0,targetFieldErrors:{}},f=b.emailFields||b.targetFields,g=null;
if(f){var h=f.body&&"text"==f.body.format?f.body:f.TextBody,k=f.body&&"richtext"==f.body.format?f.body:f.HtmlBody;Sfdc.isEmpty(h)&&(Sfdc.isEmpty(k)&&f.body)&&(emailPubObj.isTextMode()?h=f.body:emailPubObj.isRTEMode()&&(k=f.body));h&&k?(caseInteraction.getUtil().log("Both html and text body cannot be specified in the same call. please just set one or the other"),e.success=!1,e.targetFieldErrors.HtmlBody=!0,e.targetFieldErrors.TextBody=!0):h&&!a.hasTextFormat?(caseInteraction.getUtil().log("The target format specified in the custom component is plain text but the email publisher does not have a plain text mode."),
e.success=!1,e.targetFieldErrors.TextBody=!0):k&&!a.hasRteFormat&&(caseInteraction.getUtil().log("The target format specified in the custom component is rich text but the email publisher does not have a rich text enabled."),e.success=!1,e.targetFieldErrors.HtmlBody=!0);var n=f.from||f.FromAddress,l=f.to||f.ToAddress,m=f.cc||f.CcAddress,q=f.bcc||f.BccAddress,g=f.subject||f.Subject;a.expandableOptions&&(!emailPubObj.isOptionsDisplayed&&(n||l||m||q||g))&&emailPubObj.switchOptions();n&&!emailPubObj.setFrom(n.value,
!0)&&(e.success=!1,e.targetFieldErrors.FromAddress=!0);l&&!emailPubObj.setTo(l.value,!0)&&(e.success=!1,e.targetFieldErrors.ToAddress=!0);m&&!emailPubObj.setCc(m.value,!0)&&(e.success=!1,e.targetFieldErrors.CcAddress=!0);q&&!emailPubObj.setBcc(q.value,!0)&&(e.success=!1,e.targetFieldErrors.BccAddress=!0);if(h&&!e.targetFieldErrors.TextBody||k&&!e.targetFieldErrors.HtmlBody)f=function(){var a;if(emailPubObj.isRTEMode()){a=document.createElement("div");a.innerHTML=k.value;var b=Sfdc.Resource.getScriptsFromHtml(a);
if(null!==b)for(var c=0,d=b.length;c<d;c++)b[c].parentNode.removeChild(b[c]);a=a.innerHTML}else a=h.value;b=h||k;b=b.insertType?"replace"===b.insertType.toLowerCase():!b.insert;emailPubObj.insertBodyText(a,Sfdc.isDefAndNotNull(k),b)},emailPubObj.isRTEMode()&&h||emailPubObj.isTextMode()&&k?emailPubObj.forceSwitchMode(f):f()}f=function(){g&&!emailPubObj.setSubject(g.value,!0)&&(e.success=!1,e.targetFieldErrors.Subject=!0);var f=b.emailFields?b.emailFields.attachments:null;f&&Array.isArray(f.value)?
Sfdc.EmailAttachments.addAttachments(a.caseId,a.tempEmailId,f.value,function(){Sfdc.EmailAttachments.refreshAttachments(a.caseId,a.tempEmailId);d(e)},function(a,b){alert(b.errors.message);e.success=!1;e.attachmentError=!0;d(e)}):d(e)};(n=(b.emailFields?b.emailFields.template:null)||b.emailTemplate)&&n.id?(l=(l=Sfdc.get(".emailTemplateContainer",Sfdc.get(a.publisherId)))&&Sfdc.Dom.isVisible(l,!0),l||(l=(l=(l=Sfdc.Dom.getParent(Sfdc.get(a.publisherId),".EmailHeaderClass"))?Sfdc.get(".casePublisherHeader .etContainer",
l):null)&&Sfdc.Dom.isVisible(l,!0)),l?emailPubObj.addTemplate(n.id,{retrieveAsText:a.renderTemplatesAsText,success:f,failure:function(){e.success=!1;e.emailTemplateError=!0;d(e)}}):(e.success=!1,e.emailTemplateError=!0,d(e))):f()}})})();return emailPubObj}function s(){var a=this;this.encoding="";this.isLastTemplateVF=this.isMixedEncoding=!1;this.emailHeaderValueArrayJson=this.emailHeaderNameArrayJson=this.replyToEmail="";this.selectedTemplateIds={};this.isDirty=this.hasAttachmentsFromTemplate=!1;
this.reset=function(){a.encoding="";a.isMixedEncoding=!1;a.isLastTemplateVF=!1;a.replyToEmail="";a.emailHeaderNameArrayJson="";a.emailHeaderValueArrayJson="";a.selectedTemplateIds={};a.hasAttachmentsFromTemplate=!1;a.isDirty=!1};this.update=function(h){a.isDirty=!0;a.encoding?!a.isMixedEncoding&&h.encoding&&a.encoding!==h.encoding&&(a.isMixedEncoding=!0):a.encoding=h.encoding;h.isVF?(a.isLastTemplateVF=!0,h.replyToEmail&&(a.replyToEmail=h.replyToEmail),h.emailHeaderNameArrayJson&&(a.emailHeaderNameArrayJson=
h.emailHeaderNameArrayJson,a.emailHeaderValueArrayJson=h.emailHeaderValueArrayJson)):a.isLastTemplateVF=!1;h.templateId&&(a.selectedTemplateIds[h.templateId]=1);h.attachmentListHtml&&(a.hasAttachmentsFromTemplate=!0)};this.hasTemplateSelected=function(){for(var h in a.selectedTemplateIds)if(a.selectedTemplateIds.hasOwnProperty(h))return!0;return!1};this.getJson=function(){var h=[],k;for(k in a.selectedTemplateIds)a.selectedTemplateIds.hasOwnProperty(k)&&h.push(k);h=Ext.encode(h);return Ext.encode({encoding:a.encoding,
templateIdArrayJson:h,isMixedEncoding:a.isMixedEncoding,replyToEmail:a.replyToEmail,emailHeaderNameArrayJson:a.emailHeaderNameArrayJson,emailHeaderValueArrayJson:a.emailHeaderValueArrayJson})}}return{create:function(a){return k(a)}}}());function pickupValue(k,s,a){""!==k&&emailPubObj.toEmailRecipsAutoCompl.setRecipients(!1,k);""!==s&&emailPubObj.ccEmailRecipsAutoCompl.setRecipients(!1,s);""!==a&&emailPubObj.bccEmailRecipsAutoCompl.setRecipients(!1,a);closePopup()};
Sfdc.ns("Sfdc.EmailRecipientsAutoComplete");
Sfdc.EmailRecipientsAutoComplete.createEmailRecipsAutoComplManager=function(){EmailRecipientsAutoComplete=function(g){this.selectedRecipElem=null;this.newRecipElems=[];this.ONBLUR_DELAY_MS=this.minSuggestLen=0;this.ACBOX_MIN_WIDTH=g.acBoxMinWidth;this.CSS_CLASS="emailRecipients";this.RECIPS_FIELD_ID=g.recipsFieldId;this.TEXT_AREA_ID=this.RECIPS_FIELD_ID+"_textarea";this.recipsField=Sfdc.get(this.RECIPS_FIELD_ID);this.textArea=Sfdc.get(this.TEXT_AREA_ID);EmailRecipientsAutoComplete.superclass.constructor.call(this,
this.TEXT_AREA_ID,"/ui/support/caseinteraction/EmailRecipientsAutoCompleteServlet",0,{retURL:window.location.href},!0);var f=this;Sfdc.on(this.recipsField,"click",function(a){a=Sfdc.Event.getEventTarget(a);!Sfdc.Dom.hasClass(a,"recipient")&&!Sfdc.Dom.hasClass(a.parentNode,"recipient")&&f.textArea.focus()});Sfdc.on(window,"resize",function(){this.textArea=f.textArea;f.resizeTextArea()});Sfdc.on(this.textArea,"paste",function(){setTimeout(function(){f.addNewRecipients()},0)});Sfdc.on(this.textArea,
"blur",function(){!f.acBoxFocused&&(f.textArea.value&&f.shouldConvertToRecipient(f.textArea.value))&&f.addNewRecipients()});EmailRecipientsAutoComplete.prototype.shouldConvertToRecipient=function(a){return/\b\S+@\S+\.\S+\b/.test(a)};Sfdc.on(this.textArea,"keydown",function(a){if(""===f.textArea.value){var b=null,c=Sfdc.select(".recipient",f.recipsField);0<c.length&&(b=c[c.length-1]);Sfdc.Event.isKeyAction(a,Sfdc.Event.keyCode.BACKSPACE)?(a=f.getPrevRecipient(b)?Sfdc.get(".innerRecipient",f.getPrevRecipient(b)):
this.textArea,f.deleteRecipient(b,!1,a)):Sfdc.Event.isKeyAction(a,Sfdc.Event.keyCode.ARROW_L)&&b&&Sfdc.get(".innerRecipient",b).focus()}});EmailRecipientsAutoComplete.prototype.doLayout=function(){this.resizeTextArea()};this.setResizer(function(){for(var a=Sfdc.Dom.computeTextWidth(this.textArea.value+"O",this.textArea),b=0;1>=b;b++){var c=Sfdc.Dom.getPositionXY(Sfdc.get(".textAreaRightMarker",this.recipsField),"l")[0],d=Sfdc.Dom.getPositionXY(Sfdc.get(".textAreaLeftMarker",this.recipsField),"r")[0],
c=c-d,d=Sfdc.get(".recipsFieldTextAreaWrapper",this.recipsField),c=c-parseInt(Sfdc.Dom.getStyle(d,"paddingLeft"),10)-parseInt(Sfdc.Dom.getStyle(d,"paddingRight"),10)-parseInt(Sfdc.Dom.getStyle(d,"marginLeft"),10)-parseInt(Sfdc.Dom.getStyle(d,"marginRight"),10);a>=c||5>c?(this.textArea.style.width="100%",this.textArea.style.height=this.textArea.scrollHeight?this.textArea.scrollHeight+"px":"",this.recipsField.scrollTop=this.recipsField.scrollHeight):(this.textArea.style.width=c-5+"px",this.textArea.style.height=
"")}});EmailRecipientsAutoComplete.prototype.getEmailAddresses=function(){var a=[];this.addNewRecipients();for(var b=Sfdc.select(".recipient",this.recipsField),c=0;c<b.length;c++)a.push(Sfdc.get(".innerRecipient",b[c]).getAttribute("data-email"));return a.toString()};EmailRecipientsAutoComplete.prototype.emailAddressesIsEmpty=function(){return 0===this.getEmailAddresses().length};EmailRecipientsAutoComplete.prototype.getUnassociatedEmailAddresses=function(){var a=[];this.addNewRecipients();for(var b=
Sfdc.select(".recipient",this.recipsField),c=0;c<b.length;c++)Sfdc.get(".innerRecipient",b[c]).getAttribute("data-recipientid")||a.push(Sfdc.get(".innerRecipient",b[c]).getAttribute("data-email"));return a.toString()};EmailRecipientsAutoComplete.prototype.getRelatedRecipients=function(){for(var a=[],b=Sfdc.select(".recipient",this.recipsField),c=0;c<b.length;c++)if(Sfdc.get(".innerRecipient",b[c]).getAttribute("data-recipientid")){var d={};d.id=Sfdc.get(".innerRecipient",b[c]).getAttribute("data-recipientid");
d.email=Sfdc.get(".innerRecipient",b[c]).getAttribute("data-email");d.name=Sfdc.get(".innerRecipient",b[c]).value;a.push(d)}return a};EmailRecipientsAutoComplete.prototype.setRecipients=function(a){a&&this.clearRecipients();for(var b=1;b<arguments.length;b++){var c=arguments[b];if("string"===typeof c)for(var c=c.split(/[\s;,]+/),d=0;d<c.length;d++)this.addRecipient(c[d],c[d],"");else if(c instanceof Array)for(d=0;d<c.length;d++)this.addRecipient(c[d].recipientName||"",c[d].email||"",c[d].recipientId||
"")}};EmailRecipientsAutoComplete.prototype.clearRecipients=function(){for(var a=Sfdc.select(".recipient",this.recipsField),b=0;b<a.length;b++)this.recipsField.removeChild(a[b])};EmailRecipientsAutoComplete.prototype.addNewRecipients=function(){if(this.curSuggestions&&0<=this.selected){var a=this.curSuggestions[this.selected];this.addRecipient(a.recipientName,a.name,a.recipientId);this.setAppliedFlag(!0)}else for(var a=trim(this.textArea.value).split(/[\s;,]+/),b=0;b<a.length;b++)this.addRecipient(a[b],
a[b],"")};EmailRecipientsAutoComplete.prototype.addRecipient=function(a,b,c){b&&!c&&(this.curSuggestions=this.getSuggestions(b),1===this.curSuggestions.length&&b===this.curSuggestions[0].name&&(a=this.curSuggestions[0].recipientName,c=this.curSuggestions[0].recipientId));a&&b&&(a=this.createRecipient(a,b,c),this.recipsField.insertBefore(a,Sfdc.get(".textAreaLeftMarker",this.recipsField)),this.checkCacheOrRetrieve(b));this.textArea.value="";this.resizeTextArea();this.recipsField.scrollTop=this.recipsField.scrollHeight};
EmailRecipientsAutoComplete.prototype.createRecipient=function(a,b,c){var d=this,e=this.createOuterRecipient(b,c),f=this.createInnerRecipient(a,b,c);Sfdc.Dom.addClass(e,"recipient");e.appendChild(f);e.appendChild(this.createRecipDeleteButton(a,b,c));Sfdc.on(e,"click",function(){Sfdc.get(".innerRecipient",this).focus()});Sfdc.on(e,"keydown",function(a){Sfdc.Event.isKeyAction(a,Sfdc.Event.keyCode.BACKSPACE)||Sfdc.Event.isKeyAction(a,Sfdc.Event.keyCode.DELETE)?(Sfdc.get(".innerRecipient",this.parentNode).getAttribute("data-email"),
Sfdc.get(".innerRecipient",this.parentNode).getAttribute("data-recipientid"),a=Sfdc.Event.isKeyAction(a,Sfdc.Event.keyCode.BACKSPACE)?d.getPrevRecipient(this)?Sfdc.get(".innerRecipient",d.getPrevRecipient(this)):d.textArea:d.getNextRecipient(this)?Sfdc.get(".innerRecipient",d.getNextRecipient(this)):d.textArea,d.deleteRecipient(this,!1,a)):Sfdc.Event.isKeyAction(a,Sfdc.Event.keyCode.ARROW_L)?d.getPrevRecipient(this)&&Sfdc.get(".innerRecipient",d.getPrevRecipient(this)).focus():Sfdc.Event.isKeyAction(a,
Sfdc.Event.keyCode.ARROW_R)&&(d.getNextRecipient(this)?Sfdc.get(".innerRecipient",d.getNextRecipient(this)):d.textArea).focus()});this.cache[this.getCacheKey(b)]?this.addIconAndNumMatches(e):this.newRecipElems.push(e);this.element=f;this.hook_registerEventHandlers();return e};EmailRecipientsAutoComplete.prototype.getPrevRecipient=function(a){return a&&a.previousSibling&&Sfdc.Dom.hasClass(a.previousSibling,"recipient")?a.previousSibling:null};EmailRecipientsAutoComplete.prototype.getNextRecipient=
function(a){return a&&a.nextSibling&&Sfdc.Dom.hasClass(a.nextSibling,"recipient")?a.nextSibling:null};EmailRecipientsAutoComplete.prototype.deleteRecipient=function(a,b,c){a&&(Sfdc.Event.fireEvent(a,"mouseout"),Sfdc.Dom.removeChild(a),f.resizeTextArea(),c&&c.focus(),b&&this.resetElementToTextarea(),Sfdc.Event.fireEvent(this.recipsField,"markRecipFieldDirty"))};EmailRecipientsAutoComplete.prototype.addIconAndNumMatches=function(a){var b=Sfdc.get(".innerRecipient",a).getAttribute("data-email"),c=this.cache[this.getCacheKey(b)];
if(c){for(var d=0,e=0;e<c.length&&2>d;)b===c[e].name&&d++,e++;1>d?a.setAttribute("data-manymatches","false"):(b=document.createElement("img"),b.setAttribute("src","/s.gif"),1==d?(Sfdc.Dom.addClass(b,"recipientIcon oneRecipientIcon"),a.setAttribute("data-manymatches","false")):1<d&&(Sfdc.Dom.addClass(b,"recipientIcon manyRecipientsIcon"),a.setAttribute("data-manymatches","true")),a.insertBefore(b,a.firstChild),this.resizeTextArea())}};EmailRecipientsAutoComplete.prototype.hook_onFinishRetrievingServletResult=
function(){for(var a=0;a<this.newRecipElems.length;a++){var b=Sfdc.get(".innerRecipient",this.newRecipElems[a]).getAttribute("data-email");if(this.cache[this.getCacheKey(b)]){var c=Sfdc.get(".innerRecipient",this.newRecipElems[a]).getAttribute("data-recipientid"),d=Sfdc.get(".innerRecipient",this.newRecipElems[a]).value;this.addIconAndNumMatches(this.newRecipElems[a]);this.curSuggestions=this.getSuggestions(b);1===this.curSuggestions.length&&b===this.curSuggestions[0].name&&(Sfdc.get(".innerRecipient",
this.newRecipElems[a]).value=this.curSuggestions[0].recipientName,Sfdc.get(".innerRecipient",this.newRecipElems[a]).setAttribute("data-recipientid",this.curSuggestions[0].recipientId));c&&this.refreshRecipient(this.newRecipElems[a],d,b,c);this.newRecipElems.splice(a,1);a--}}};EmailRecipientsAutoComplete.prototype.refreshRecipient=function(a,b,c,d){b=this.createRecipient(b,c,d);a.parentNode.replaceChild(b,a);return b};EmailRecipientsAutoComplete.prototype.createOuterRecipient=function(a,b){var c=document.createElement("span");
if(b)for(var d=this.getSuggestions(a),e=0;e<d.length;e++)if(b==d[e].recipientId)return c.innerHTML=d[e].recipientHoverHtml,Sfdc.Dom.getFirstChild(c);return c};EmailRecipientsAutoComplete.prototype.createInnerRecipient=function(a,b,c){var d=this,e=document.createElement("input"),f="recip_"+Sfdc.newUID();Sfdc.Dom.addClass(e,"innerRecipient");e.setAttribute("id",f);e.setAttribute("type","button");e.setAttribute("value",a);e.setAttribute("data-email",b);e.setAttribute("data-recipientid",c);Sfdc.Event.add(e,
"click",function(){d.displaySuggestionsOnClick(f)});Sfdc.on(e,"keydown",function(a){Sfdc.Event.isKeyAction(a,Sfdc.Event.keyCode.ENTER)&&d.displaySuggestionsOnClick(f);Sfdc.Event.isKeyAction(a,Sfdc.Event.keyCode.TAB)||Sfdc.Event.preventDefault(a)});Sfdc.Event.add(e,"focus",function(){Sfdc.Dom.addClass(this.parentNode,"focused");"true"===this.parentNode.getAttribute("data-manymatches")&&Sfdc.Dom.addClass(this.parentNode,"activeRecipient")});Sfdc.Event.add(e,"blur",function(){Sfdc.Dom.removeClass(this.parentNode,
"focused");Sfdc.Dom.removeClass(this.parentNode,"activeRecipient")});return e};EmailRecipientsAutoComplete.prototype.createRecipDeleteButton=function(a,b,c){var d=this;a=document.createElement("img");Sfdc.Dom.addClass(a,"deleteRecipient");a.setAttribute("src","/s.gif");Sfdc.Event.add(a,"click",function(){d.deleteRecipient(this.parentNode,!0)});return a};EmailRecipientsAutoComplete.prototype.displaySuggestionsOnClick=function(a){this.selectedRecipElem=Sfdc.get(a);this.element=Sfdc.get(a);this.enabled=
this.focused=!0;this.displaySuggestions(!1)};EmailRecipientsAutoComplete.prototype.resetElementToTextarea=function(){this.selectedRecipElem=null;this.element=this.textArea};EmailRecipientsAutoComplete.prototype.isValidSuggestion=function(a,b){var c=this.getRegexForInput(a),d=[],e=b.name.match(c),c=b.recipientName.match(c);e&&d.push(e);c&&d.push(c);return d};EmailRecipientsAutoComplete.prototype.additionalDisplayConditionsValid=function(a){a=this.getInput();if(""===a)return this.handleEmptyInput(),
!1;a=this.getSuggestions(a);return this.selectedRecipElem&&1>=a.length?(this.selectedRecipElem=null,!1):!0};EmailRecipientsAutoComplete.prototype.addHeader=function(a){};EmailRecipientsAutoComplete.prototype.hook_hide=function(){this.resetElementToTextarea()};EmailRecipientsAutoComplete.prototype.getCacheKey=function(a){return a};EmailRecipientsAutoComplete.isNav=function(a){return!a||!a.keyCode?!1:a.keyCode==KEY_ARROW_D||a.keyCode==KEY_ARROW_U||a.keyCode==KEY_ESC||a.keyCode==KEY_TAB||a.keyCode==
KEY_ENTER||a.keyCode==KEY_SEMICOLON||a.keyCode==KEY_COMMA};EmailRecipientsAutoComplete.prototype.handleNav=function(a){a.keyCode==KEY_SEMICOLON||a.keyCode==KEY_COMMA?this.handleEnter(a):a.keyCode==KEY_ARROW_U?this.selectPrev():a.keyCode==KEY_ARROW_D?this.selectNext():EmailRecipientsAutoComplete.superclass.handleNav.call(this,a)};EmailRecipientsAutoComplete.prototype.complete=function(){null!==this.selectedRecipElem?(this.element=this.selectedRecipElem,EmailRecipientsAutoComplete.superclass.complete.call(this)):
(this.addNewRecipients(),this.clearACBox());this.resetElementToTextarea();Sfdc.Event.fireEvent(this.recipsField,"markRecipFieldDirty");return!0};EmailRecipientsAutoComplete.prototype.innerComplete=function(a){this.element&&(a&&0!==a.length)&&(a=this.refreshRecipient(this.selectedRecipElem.parentNode,a.recipientName,a.name,a.recipientId),Sfdc.get(".innerRecipient",a).focus())};EmailRecipientsAutoComplete.prototype.getSuggestionHtml=function(a){var b="",c=escapeHTML(this.findInput(this.lastInput)),
d=escapeHTML(a.name),e=escapeHTML(a.recipientName);escapeHTML(a.recipientId);a=escapeHTML(a.recipientType);c&&0<Sfdc.String.trim(c).length&&(c=this.getRegexForInput(c),e=e.replace(c,'$1\x3cstrong class\x3d"recipAutoComplMatch"\x3e$2\x3c/strong\x3e'),d=d.replace(c,'$1\x3cstrong class\x3d"recipAutoComplMatch"\x3e$2\x3c/strong\x3e'));b+="\x26nbsp;";b=e&&0<e.length?b+(e+" \x26lt;"+d+"\x26gt;"):b+d;return b+("\x3cspan class\x3d'recipientType'\x3e("+a+")\x3c/span\x3e")};EmailRecipientsAutoComplete.prototype.getInput=
function(){return null!==this.selectedRecipElem?trim(this.selectedRecipElem.getAttribute("data-email")):trim(this.textArea.value)};EmailRecipientsAutoComplete.prototype.initACBox=function(){EmailRecipientsAutoComplete.superclass.initACBox.call(this);Sfdc.Dom.addClass(document.getElementById(this.id+AutoCompleteInputElement.BOX_ID),this.CSS_CLASS)};EmailRecipientsAutoComplete.prototype.getMinimumWidth=function(){return this.ACBOX_MIN_WIDTH};EmailRecipientsAutoComplete.prototype.getACWidth=function(){return this.recipsField.clientWidth};
EmailRecipientsAutoComplete.prototype.positionACBox=function(a){if(this.recipsField&&this.acBox&&(!a||this.isACBoxVisible())){a=this.getACXPosition(this.recipsField);var b=this.getACYPosition(this.recipsField);this.acBox.setStyle("left",a+"px");this.acBox.setStyle("top",b+"px");a=this.getACWidth();this.acBox.setStyle("width",a+"px");"object"===typeof Ext&&(a=Ext.get("massEdit"),null!==a&&this.acBox.setStyle("zIndex",parseFloat(a.getStyle("z-index"),10)+10))}};EmailRecipientsAutoComplete.prototype.getACXPosition=
function(a){return Sfdc.Dom.getElementXY(this.recipsField).x};EmailRecipientsAutoComplete.prototype.getACYPosition=function(a){return Sfdc.Dom.getElementXY(this.recipsField).y+a.offsetHeight};EmailRecipientsAutoComplete.prototype.getOnBlurDelay=function(){return EmailRecipientsAutoComplete.ONBLUR_DELAY_MS}};Ext.extend(EmailRecipientsAutoComplete,AutoCompleteInputElement);return{eracHandles:{},initEmailRecipientsAutoComplete:function(g){var f=new EmailRecipientsAutoComplete({recipsFieldId:g.recipsFieldId,
defaultEmailAdresses:g.defaultEmailAddresses,acBoxMinWidth:g.acBoxMinWidth});this.initDefaultEmailAddresses(f,g.defaultEmailAddresses);g.relatedRecipients&&f.setRecipients(!1,Sfdc.JSON.parse(g.relatedRecipients));this.eracHandles[g.recipsFieldId]=f},getEmailRecipientsAutoComplete:function(g){return this.eracHandles[g]},initDefaultEmailAddresses:function(g,f){for(var a=0;a<f.length;a++)g.addRecipient(f[a],f[a],"");g.resetElementToTextarea()}}};
window.emailRecipsAutoComplManager=window.emailRecipsAutoComplManager||new Sfdc.EmailRecipientsAutoComplete.createEmailRecipsAutoComplManager;
Sfdc.provide("SfdcApp.EmailTemplates",function(){function k(f){var c={},h=!1;c.toggleTemplateOverlayDisplay=function(a){var b=Sfdc.get(a);(b=Sfdc.select(".etOverlay",b)[0])&&Sfdc.Dom.isVisible(b)?c.hideOverlay(b):c.renderOverlay(a)};c.adjustTemplateHeight=function(){var a=Sfdc.get(".compactPublisher .EmailHeaderClass .etOverlay");if(a){var b=Sfdc.first(".etOverlayTemplatesBlock",a);Sfdc.Dom.setStyles(b,{height:""});var c=Sfdc.get(".EmailHeaderClass .caseEmailCommonBodyAndDraftDetails").getBoundingClientRect().top,
a=a.getBoundingClientRect().top;c>a&&(c=Sfdc.Dom.getHeight(b)-(c-a),Sfdc.Dom.setStyles(b,{height:c+"px"}))}};c.renderOverlay=function(a){var b=caseInteraction.getEmailPublisher(f.caseId);if(!0!==b.isLocked){a=Ext.get(a);for(var e=a.select(".etOverlayContentsContainer").first();e.first();)e.first().remove();var d=a.select(".etOverlay").first();caseInteraction.getUtil().show(d);h||(Sfdc.on(document,"keydown",function(a){Sfdc.Event.isKeyAction(a,Sfdc.Event.keyCode.ESC)&&c.hideOverlay(d)}),Sfdc.on(document.body,
"click",function(a){(a=Sfdc.get(a.target))&&!Sfdc.Dom.getParent(a,".etContainer")&&c.hideOverlay(d)}),h=!0);b.focusOnPublisherArea();b.saveCursorPosition();var g=new LoadingScreen(d.dom,LC.getLabel("Global","loading"));g.show();entityFeedPage.get({url:f.servletUrl,success:function(a,b){g.hide();e.createChild(b.overlayHtml);var d=e.select(".etOverlaySelectElement").first();d&&d.focus();c.adjustTemplateHeight()},failure:function(a,b){g.hide()}})}};c.hideOverlay=function(a){caseInteraction.getUtil().hide(Ext.get(a))};
c.hideOverlayParent=function(a){a=Ext.get(a).findParent(".etOverlay");c.hideOverlay(a)};c.renderTemplateList=function(a){var b=Ext.get(a);a=Ext.get(b.findParent(".etOverlay"));var e=a.select(".etOverlayTemplatesContainer").first(),b=b.dom.options[b.dom.selectedIndex].value,d=new LoadingScreen(a.dom,LC.getLabel("Global","loading"));d.show();entityFeedPage.get({url:f.servletUrl,params:{filterId:b},success:function(a,b){for(d.hide();e.first();)e.first().remove();e.createChild(b.templateListHtml);c.adjustTemplateHeight()},
failure:function(a,b){d.hide()}})};c.addTemplate=function(a,b){caseInteraction.getEmailPublisher(f.caseId).addTemplate(b,{retrieveAsText:f.renderTemplatesAsText,success:function(){c.hideOverlayParent(a)}})};return c}return{createEmailTemplateComponent:function(f){return k(f)}}}());
var EntityFilesComponent={createEntityFilesComponent:function(){return{performAction:function(a,d,b,c){"downloadAttached"===b?window.open(c,"_blank"):"downloadChatter"===b?window.open(c,"_blank"):"email"===b&&(b=Sfdc.EntityFeed.getComponentState(a,"CaseEmailPublisher"),null!==b&&!b.isLocked&&(b=b.tempEmailId,Sfdc.EntityFeed.getEventBus().fireEvent("case:recordAttachmentDialog","onAttachEmailFromFilesWidget",{entityId:a,tempEmailId:b,preselectedId:d})))},enableEmailFilesWidgetActions:function(a){a=
Sfdc.EntityFeed.getComponentState(a,"CaseEmailPublisher");null!==a&&!a.isLocked&&(a=Sfdc.select(".caseEmailFileWidgetActions"),Sfdc.each(a,function(a){Sfdc.Dom.show(a)}))}}}},entityFilesComponent=EntityFilesComponent.createEntityFilesComponent();
Sfdc.provide("SfdcApp.CaseLogCallPublisherAction",function(){function h(a){logCallPubObj=SfdcApp.CasePublisherActions.create(a,"callLog");logCallPubObj.validate=function(){var b=Ext.getDom(a.publisherTextId);Ext.get(a.publisherSubmitBtnId);var b=b.value,c=!0;if(!a.disableCollapsingBody&&b==a.defaultTextValue||caseInteraction.getUtil().stringIsEmpty(b))c=!1;if(c){var d={};a.submitIdArray&&Ext.each(a.submitIdArray,function(a){var b="",c=Ext.get(a);c&&(b=c.dom.value);d[a]=b});caseInteraction.getUtil().populateValuesForIds(a.additionalFieldIdArray,
d);return{servletUrl:a.servletUrl,paramObject:d}}logCallPubObj.resetPublisher()};logCallPubObj.disable=function(){var b=caseInteraction.getUtil();b.disableIdArray(a.editableIdArray);b.disableButtonIdArray(a.editableBtnIdArray)};logCallPubObj.enable=function(){var b=caseInteraction.getUtil();b.enableIdArray(a.editableIdArray);b.enableButtonIdArray(a.editableBtnIdArray)};(function(){var b=Ext.get(a.publisherTextId);a.disableCollapsingBody?a.textBody&&(b.dom.value=a.textBody):b.dom.value=a.defaultTextValue;
b.on("focus",logCallPubObj.focus);b.on("drop",logCallPubObj.focus);Ext.get(document.body);logCallPubObj.registerUnfocusPublisherEvent();logCallPubObj.registerActionHandler("Case.LogACall",{onSetInputValues:function(b,d){var g={success:!0,targetFieldErrors:{}};if(b.targetFields){var e=b.targetFields.description||b.targetFields.Description;if(e&&e.value){var f=Sfdc.get(a.publisherTextId);if(!Sfdc.EntityFeed.QuickAction.insertIntoTextField(f,e.value,e.insertType||(e.insert?"cursor":"replace")))g.success=
!1,g.targetFieldErrors.Description=!0}}d(g)}});a.quickTextConfig&&(this.quickTextAutoCompleteArea=new QuickTextAutoCompleteTextArea(a.quickTextConfig))})();if(Ext.get(a.parentId).select("."+a.fieldsSection).first()){var f={};f.showAdditionalFields=a.showAdditionalFields;entityFeedPage.registerOnUpdateComponent(a.parentId,{objectId:a.caseId,componentKey:a.componentKey,updateableElementClass:a.fieldsSection,componentContext:Ext.encode(f)})}return logCallPubObj}return{create:function(a){return h(a)}}}());
Sfdc.provide("SfdcApp.CasePortalPublisherAction",function(){function h(a){commentPubObj=SfdcApp.CasePublisherActions.create(a,"portal");commentPubObj.validate=function(){var b=Ext.getDom(a.publisherTextId);Ext.get(a.publisherSubmitBtnId);var b=b.value,d=Ext.get(a.publisherSendNotificationCboxId),d=d&&d.dom.checked?"true":"false",e=!0;if(!a.disableCollapsingBody&&b==a.defaultTextValue||caseInteraction.getUtil().stringIsEmpty(b))e=!1;if(e)return{servletUrl:a.servletUrl,paramObject:{answer:b,caseId:a.caseId,
notificationSelected:d,questionId:a.questionId}};commentPubObj.resetPublisher()};commentPubObj.disable=function(){var b=caseInteraction.getUtil();b.disableIds(a.publisherTextId);b.disableButtonIds(a.publisherSubmitBtnId)};commentPubObj.enable=function(){var b=caseInteraction.getUtil();b.enableIds(a.publisherTextId);b.enableButtonIds(a.publisherSubmitBtnId)};commentPubObj.togglePublicAnswer=function(b,d,e){var c=document.getElementById(b+"_private");b=document.getElementById(b+"_public");null===c||
null===b||(document.getElementById(a.publisherSubmitBtnId).value=a.publisherAnswerButtonLabel,document.getElementById(a.publisherSubmitBtnId).title=a.publisherAnswerButtonLabel,"public"==d?(b.checked=!0,c.checked=!1,a.servletUrl=a.publisherPostToCommunityServletUrl,c.parentElement.setAttribute("class",c.parentElement.getAttribute("class").replace("privateSide_on","privateSide_off")),b.parentElement.setAttribute("class",b.parentElement.getAttribute("class").replace("publicSide_off","publicSide_on")),
d=document.getElementById(e),e=document.getElementById(e+"_label"),null!==d&&(d.setAttribute("class",d.getAttribute("class")+" hidden"),e.setAttribute("class",e.getAttribute("class")+" hidden"))):(b.checked=!1,c.checked=!0,a.servletUrl=a.publisherPrivateAnswerServletUrl,c.parentElement.setAttribute("class",c.parentElement.getAttribute("class").replace("privateSide_off","privateSide_on")),b.parentElement.setAttribute("class",b.parentElement.getAttribute("class").replace("publicSide_on","publicSide_off")),
d=document.getElementById(e),e=document.getElementById(e+"_label"),null!==d&&(d.setAttribute("class",d.getAttribute("class").replace(" hidden","")),e.setAttribute("class",e.getAttribute("class").replace(" hidden","")))))};commentPubObj.preparePublisherForPublicComment=function(b,d,e){commentPubObj.showPublisher();commentPubObj.togglePublicAnswer(d,b,e);caseInteraction.getUtil().setCursorOn(a.publisherTextId,0)};commentPubObj.unfocusPublisher=function(a){Ext.fly(a.target)&&commentPubObj.resetPublisher()};
commentPubObj.registerUnfocusPublisherEvent=function(){Ext.get(a.publisherTextId).on("blur",commentPubObj.unfocusPublisher)};entityFeedPage.getEventBus().addEventListener("case:publisher","onAfterAttachAsLink",function(b,d){if(d.caseId===a.caseId&&commentPubObj.isVisible()){var e=d.article.title+" - "+d.article.url,c=Ext.get(a.publisherTextId);c.dom.value==a.defaultTextValue?c.dom.value=e:caseInteraction.getUtil().insertAtCursor(a.publisherTextId,e);commentPubObj.focus()}});(function(){var b=Ext.get(a.publisherTextId);
a.disableCollapsingBody?a.textBody&&(b.dom.value=a.textBody):b.dom.value=a.defaultTextValue;b.on("focus",commentPubObj.focus);b.on("drop",commentPubObj.focus);commentPubObj.registerUnfocusPublisherEvent();commentPubObj.registerActionHandler("Case.CaseComment",{onSetInputValues:function(b,e){var c=b.portalPostFields||b.targetFields,f={success:!0,targetFieldErrors:{}};if(c&&(c=c.body||c.CommentBody)&&c.value){var g=Sfdc.get(a.publisherTextId);if(!Sfdc.EntityFeed.QuickAction.insertIntoTextField(g,c.value,
c.insertType||(c.insert?"cursor":"replace")))f.success=!1,f.targetFieldErrors.CommentBody=!0}if((c=b.portalPostFields?b.portalPostFields.sendEmail:null)&&c.value)(g=Sfdc.get(a.publisherSendNotificationCboxId))?g.checked=c.value||!1:(f.success=!1,f.sendEmailError=!0);e(f)}});a.quickTextConfig&&(this.quickTextAutoCompleteArea=new QuickTextAutoCompleteTextArea(a.quickTextConfig))})();return commentPubObj}return{create:function(a){return h(a)}}}());
QuickTextAutoCompleteTextArea=function(a){this.bulkUpdateMru=Sfdc.isDefAndNotNull(a.bulkUpdateMru)?a.bulkUpdateMru:!0;a.searchTrigger&&2===a.searchTrigger.length&&(this.searchTrigger=a.searchTrigger);a.requestParams||(a.requestParams={});Sfdc.isDefAndNotNull(a.channel)&&(a.requestParams[QuickTextAutoCompleteServlet.CHANNEL_PARAM]=a.channel);a.requestParams[QuickTextAutoCompleteServlet.REQUEST_TYPE_PARAM]="0";a.requestParams[QuickTextAutoCompleteServlet.QUICK_TEXT_TRIGGER_KEY]=this.searchTrigger;QuickTextAutoCompleteTextArea.superclass.constructor.call(this,
a.elementId,a.servletURI,a.minSuggestLen,a.requestParams,!0);this.displayHeader=!1;this.mergeMessageCache={};null!==a.showOverlayAtBottomOfElement&&(this.showOverlayAtBottomOfElement=a.showOverlayAtBottomOfElement);if(!this.showOverlayAtBottomOfElement){var b=Sfdc.Dom.getParent(this.element),c=document.createElement("div");c.className=this.element.className;Sfdc.Dom.setStyle(c,"overflow","auto");Sfdc.Dom.setStyle(c,"position","absolute");Sfdc.Dom.setStyle(c,"left","0px");Sfdc.Dom.setStyle(c,"top",
"0px");Sfdc.Dom.setStyle(c,"visibility","hidden");b.appendChild(c);b=document.createElement("span");Sfdc.Dom.setStyle(b,"word-wrap",Sfdc.Dom.getStyle(this.element,"wordWrap"));Sfdc.Dom.setStyle(b,"font-size",Sfdc.Dom.getStyle(this.element,"fontSize"));Sfdc.Dom.setStyle(b,"font-family",Sfdc.Dom.getStyle(this.element,"fontFamily"));c.appendChild(b);this.ghostSpanEl=b}Sfdc.isDefAndNotNull(a.entityId)&&(this.entityId=a.entityId);Sfdc.isDefAndNotNull(a.getWhoIdFunction)&&(this.getWhoIdFunction=a.getWhoIdFunction);
Sfdc.isDefAndNotNull(a.getWhatIdFunction)&&(this.getWhatIdFunction=a.getWhatIdFunction)};Ext.extend(QuickTextAutoCompleteTextArea,AutoCompleteInputElement);QuickTextAutoCompleteTextArea.prototype.showOverlayAtBottomOfElement=!0;QuickTextAutoCompleteTextArea.prototype.searchTrigger=";;";QuickTextAutoCompleteTextArea.prototype.count=1;QuickTextAutoCompleteTextArea.prototype.beginIndexOfSearchWord=null;QuickTextAutoCompleteTextArea.prototype.oneAfterEndIndexOfSearchWord=null;
QuickTextAutoCompleteTextArea.prototype.noOfChars=null;QuickTextAutoCompleteTextArea.prototype.mergeMessageCache=null;QuickTextAutoCompleteTextArea.prototype.ghostSpanEl=null;QuickTextAutoCompleteTextArea.prototype.lineHeight=null;QuickTextAutoCompleteTextArea.prototype.delay=200;QuickTextAutoCompleteTextArea.prototype.additionalYBuffer=8;QuickTextAutoCompleteTextArea.prototype.usedQuickTextIds=[];QuickTextAutoCompleteTextArea.prototype.entityId=null;
QuickTextAutoCompleteTextArea.prototype.getCacheKey=function(a){return a};QuickTextAutoCompleteTextArea.prototype.serverCallTimeOut=null;QuickTextAutoCompleteTextArea.prototype.getWhoIdFunction=null;QuickTextAutoCompleteTextArea.prototype.getWhatIdFunction=null;
QuickTextAutoCompleteTextArea.prototype.getBeginOfSearchWord=function(){var a=this.element.value,a=this.normalizeNewLines(a),b=this.getCaretPosition(this.element);this.oneAfterEndIndexOfSearchWord=b;if(0!==b)for(var c=-1,c=b-1,c=b-1;0<c;c--)if(0<=c-1&&a.substring(c-1,c+1)===this.searchTrigger)return this.beginIndexOfSearchWord=c+=1};QuickTextAutoCompleteTextArea.prototype.getInput=function(){return this.element.value};
QuickTextAutoCompleteTextArea.prototype.findInput=function(){var a=this.getBeginOfSearchWord(),b=this.oneAfterEndIndexOfSearchWord;return a?b===a?this.searchTrigger:this.element.value.substring(a,b):""};
QuickTextAutoCompleteTextArea.prototype.innerComplete=function(a){if(this.element&&(a&&0!==a.name.length)&&this.beginIndexOfSearchWord){if(!0===a.qtMerge){var b=a.qtId,c=this.getMergeCacheKey(b);if(this.mergeMessageCache[c])this.updateElementValue(this.mergeMessageCache[c].name),this.updateMru(a.qtId);else{var d=new QueryString;d.add(QuickTextAutoCompleteServlet.REQUEST_TYPE_PARAM,QuickTextAutoCompleteServlet.REQUEST_TYPE_LOOKUP);d.add(QuickTextAutoCompleteServlet.QUICK_TEXT_ID_PARAM,b);d.add(QuickTextAutoCompleteServlet.QUICK_TEXT_WHO_ID,
this.getWhoId());d.add(QuickTextAutoCompleteServlet.QUICK_TEXT_WHAT_ID,this.getWhatId());d.add(QuickTextAutoCompleteServlet.QUICK_TEXT_BULKUPDATEMRU,this.bulkUpdateMru);var e=this;Sfdc.Ajax.get(this.servletURI+d.toString(),function(a){if(a&&(e.clearMruCache(),(a=e.parseResponse(a))&&a[AbstractAutoCompleteServlet.SUGGESTIONS]&&a[AbstractAutoCompleteServlet.SUGGESTIONS][0]))e.mergeMessageCache[c]=a[AbstractAutoCompleteServlet.SUGGESTIONS][0],e.updateElementValue(a[AbstractAutoCompleteServlet.SUGGESTIONS][0].name)})}}else this.updateElementValue(a.name),
this.updateMru(a.qtId);this.usedQuickTextIds.push(a.qtId)}};QuickTextAutoCompleteTextArea.prototype.clearMruCache=function(a){this.bulkUpdateMru||(a=this.getCacheKey(this.searchTrigger),this.cache[a]&&(this.triedQueries[a]&&delete this.triedQueries[a],delete this.cache[a]))};
QuickTextAutoCompleteTextArea.prototype.updateMru=function(a){if(!this.bulkUpdateMru)if(Sfdc.isDefAndNotNull(a)){var b={};b[QuickTextAutoCompleteServlet.REQUEST_TYPE_PARAM]=QuickTextAutoCompleteServlet.REQUEST_TYPE_UPDATEMRU;b[QuickTextAutoCompleteServlet.QUICK_TEXT_ID_PARAM]=a;var c=this;Sfdc.Ajax.post(this.servletURI,function(a){c.clearMruCache()},{data:b,failure:function(){Sfdc.error("QuickText MRU update failed for "+a)},escape:encodeURIComponent})}else Sfdc.error("Invalid parameter to QuickTextAutoCompleteTextArea.updateMru().")};
QuickTextAutoCompleteTextArea.prototype.getMergeCacheKey=function(a){return a+"_"+this.getWhatId()+"_"+this.getWhoId()};QuickTextAutoCompleteTextArea.prototype.getWhoId=function(){return null!==this.getWhoIdFunction?this.getWhoIdFunction():null};QuickTextAutoCompleteTextArea.prototype.getWhatId=function(){return null!==this.getWhatIdFunction?this.getWhatIdFunction():this.entityId};
QuickTextAutoCompleteTextArea.prototype.getSearchWords=function(){return this.element.value&&this.beginIndexOfSearchWord<=this.oneAfterEndIndexOfSearchWord?this.element.value.substring(this.beginIndexOfSearchWord,this.oneAfterEndIndexOfSearchWord):null};
QuickTextAutoCompleteTextArea.prototype.updateElementValue=function(a){var b=this.oneAfterEndIndexOfSearchWord,c=this.beginIndexOfSearchWord-this.searchTrigger.length,d=this.element.value,d=this.normalizeNewLines(d);a=this.normalizeNewLines(a);var e=d.substring(0,c),b=d.substring(b);this.element.value=e?e.concat(a,b):a.concat(b);this.setCursorOn(this.id,c+a.length);Sfdc.Event.fireEvent(this.element,"input")};
QuickTextAutoCompleteTextArea.prototype.getCaretPosition=function(a){if("number"===typeof a.selectionStart)return a.selectionStart;a.focus();var b=document.selection.createRange();if(null!==b){a=a.createTextRange();var c=a.duplicate();a.moveToBookmark(b.getBookmark());c.setEndPoint("EndToStart",a);return this.normalizeNewLines(c.text).length}};
QuickTextAutoCompleteTextArea.prototype.setCursorOn=function(a,b){var c=Ext.get(a);c&&("number"===typeof c.dom.selectionStart?(c.focus(),c.dom.setSelectionRange(b,b)):c.dom.createTextRange&&(c=c.dom.createTextRange(),c.move("character",b),c.select()))};QuickTextAutoCompleteTextArea.prototype.isValidSuggestion=function(a,b){return b};
QuickTextAutoCompleteTextArea.prototype.addFooter=function(a,b){a.push("\x3ctr\x3e\x3ctd\x3e\x3cdiv id\x3d'dtlMsg"+this.element.id+"' class\x3d'detailMessageDiv'\x3e");a.push("\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e")};QuickTextAutoCompleteTextArea.prototype.retrieveFromServlet=function(a){this.serverCallTimeOut&&clearTimeout(this.serverCallTimeOut);var b=this;this.serverCallTimeOut=setTimeout(function(){QuickTextAutoCompleteTextArea.superclass.retrieveFromServlet.call(b,a)},this.delay)};
QuickTextAutoCompleteTextArea.prototype.select=function(a){QuickTextAutoCompleteTextArea.superclass.select.call(this,a);this.updatePreview()};
QuickTextAutoCompleteTextArea.prototype.updatePreview=function(){var a=Sfdc.get("dtlMsg"+this.element.id);0<=this.selected&&Sfdc.Dom.updateHTML(a,"\x3cdiv class \x3d 'quickTextTitle' \x3e"+escapeHTML(this.curSuggestions[this.selected].qtTitle)+"\x3c/div\x3e\x3cdiv class\x3d'quickTextDetailMessage'\x3e"+escapeHTML(this.curSuggestions[this.selected].name).replace(/\n/g,"\x3cbr/\x3e")+"\x3c/div\x3e")};QuickTextAutoCompleteTextArea.prototype.updateWidth=function(){};
QuickTextAutoCompleteTextArea.prototype.getACYPosition=function(a){if(!0===this.showOverlayAtBottomOfElement)return QuickTextAutoCompleteTextArea.superclass.getACYPosition.call(this,a);a=Sfdc.Dom.getPositionXY(a,"tl")[1];var b=Ext.get(Sfdc.Dom.getParent(this.ghostSpanEl));b.setHeight(Sfdc.Dom.getHeight(this.element));b.setWidth(Sfdc.Dom.getWidth(this.element));b=this.element.value.substring(0,this.beginIndexOfSearchWord);Sfdc.Dom.updateHTML(this.ghostSpanEl,b.replace(/\n/g,"\x3cbr/\x3e"));b=Sfdc.Dom.getHeight(this.ghostSpanEl);
Sfdc.Dom.updateHTML(this.ghostSpanEl,"");return b+a-this.element.scrollTop+this.additionalYBuffer};QuickTextAutoCompleteTextArea.prototype.hook_show=function(){var a=Ext.get(this.id+AutoCompleteInputElement.BOX_ID),b=a.getTop(),c=getScrollY(),d=getWindowHeight(),e=a.getHeight();b+e>c+d&&2*(b-c)>d&&a.setTop(b-e-this.getLineHeight()-2*this.additionalYBuffer);this.select(0);if((a=this.getRow(this.selected))&&a.className!==AutoCompleteInputElement.ROW_CSS_CLASS_SELECTED)a.className=AutoCompleteInputElement.ROW_CSS_CLASS_SELECTED};
QuickTextAutoCompleteTextArea.prototype.hook_onEmptyServletResult=function(a){var b=this.getSearchWords();b&&(1<a.length&&b.length>=a.length&&b.substring(0,a.length)===a)&&this.updateElementValue(b)};QuickTextAutoCompleteTextArea.prototype.getLineHeight=function(){if(null===this.lineHeight){var a=Sfdc.Dom.getStyle(this.element,"lineHeight");this.lineHeight=a.substring(0,a.indexOf("px"))}return this.lineHeight};
QuickTextAutoCompleteTextArea.prototype.getSuggestionWidth=function(){return this.getMinimumWidth()-10};QuickTextAutoCompleteTextArea.prototype.handleNav=function(a){QuickTextAutoCompleteTextArea.superclass.handleNav.call(this,a);AutoCompleteInputElement.isNav(a)&&(a.keyCode==KEY_ESC?(a=this.getSearchWords(),null!==a&&this.updateElementValue(a)):a.keyCode==KEY_ARROW_U?this.isACBoxVisible()&&AutoCompleteInputElement.captureKeystroke(a):a.keyCode==KEY_ARROW_D&&this.isACBoxVisible()&&AutoCompleteInputElement.captureKeystroke(a))};
QuickTextAutoCompleteTextArea.prototype.getMinimumWidth=function(){return this.element.offsetWidth};
QuickTextAutoCompleteTextArea.prototype.innerAddSuggestions=function(a,b,c,d){for(var e=0;e<b.length;e++){var g=b[e];if(g&&g.name){var f=e+d;a.push("\x3ctr\x3e\x3ctd\x3e");a.push("\x3cdiv ");a.push('unselectable\x3d"on"');a.push('onmouseover\x3d"');a.push("AutoCompleteInputElement.mouseOver('"+this.id+"', "+f+')"');a.push('onmouseout\x3d"');a.push("AutoCompleteInputElement.mouseOut('"+this.id+"', "+f+')"');a.push('onclick\x3d"');a.push("QuickTextAutoCompleteTextArea.click('"+this.id+"', "+f+')"');
this.compareSuggestions(c,g)?(a.push("class\x3d'"+AutoCompleteInputElement.ROW_CSS_CLASS_SELECTED+"' "),this.select(f)):a.push("class\x3d'"+AutoCompleteInputElement.ROW_CSS_CLASS+"' ");this.getSuggestionWidth()&&a.push(" style\x3d'width:"+this.getSuggestionWidth()+"px' ");a.push("id\x3d'"+AutoCompleteInputElement.getRowIdStatic(this.id,f)+"'\x3e");a.push(this.getSuggestionHtml(g));a.push("\x3c/div\x3e");a.push("\x3c/td\x3e\x3c/tr\x3e")}}};
QuickTextAutoCompleteTextArea.click=function(a,b){var c=AutoCompleteInputElement.getInstance(a);b==c.selected?(c.complete(),c.onClickFired=!0):(c.select(b),c.element.focus())};QuickTextAutoCompleteTextArea.prototype.positionACBox=function(){QuickTextAutoCompleteTextArea.superclass.positionACBox.call(this);this.acBox&&this.acBox.setStyle("width",this.getMinimumWidth()+"px")};
QuickTextAutoCompleteTextArea.prototype.getUsedQuickTextAndPurgeList=function(){var a=this.usedQuickTextIds.splice(0);this.usedQuickTextIds=[];return a};QuickTextAutoCompleteTextArea.prototype.normalizeNewLines=function(a){return a.replace(/\r\n/g,"\n")};
QuickTextAutoCompleteRteArea=function(b,a){this.rteElementId=a;this.editor=CKEDITOR.instances[this.rteElementId];QuickTextAutoCompleteRteArea.superclass.constructor.call(this,b)};Ext.extend(QuickTextAutoCompleteRteArea,QuickTextAutoCompleteTextArea);QuickTextAutoCompleteRteArea.prototype.rteElementId=null;QuickTextAutoCompleteRteArea.prototype.domElementWithSearchString=null;
QuickTextAutoCompleteRteArea.prototype.hook_registerEventHandlers=function(){var b=this;CKEDITOR.instances[this.rteElementId].on("blur",function(){b.focused=!1;if(!b.acBoxFocused){var a=b.getOnBlurDelay();0<a?setTimeout(function(){b.clearSuggestions()},a):b.clearSuggestions()}});CKEDITOR.instances[this.rteElementId].on("focus",function(){b.focused=!0})};QuickTextAutoCompleteRteArea.prototype.getInput=function(){return CKEDITOR.instances[this.rteElementId].getData()};
QuickTextAutoCompleteRteArea.prototype.findInput=function(){var b=this.editor.getSelection().getRanges(!0)[0];if(b.collapsed){var a=b.startContainer,b=this.getCursorPosition();if(-1!=b&&"function"===typeof a.getText&&"function"===typeof a.setText){this.domElementWithSearchString=a;this.oneAfterEndIndexOfSearchWord=b;a=a.getText().substring(0,b);a=null!==a?a.replace(String.fromCharCode(160)," "):null;this.beginIndexOfSearchWord=-1;for(var c=b-1;0<c;c--)if(0<=c-1&&a.substring(c-1,c+1)==this.searchTrigger){this.beginIndexOfSearchWord=
c+1;break}if(0<=this.beginIndexOfSearchWord)return this.beginIndexOfSearchWord===b?this.searchTrigger:a.substring(this.beginIndexOfSearchWord,b)}}return""};QuickTextAutoCompleteRteArea.prototype.getCursorPosition=function(){return this.editor.getSelection().getRanges(!0)[0].startOffset};
QuickTextAutoCompleteRteArea.prototype.getSearchWords=function(){return this.domElementWithSearchString&&this.domElementWithSearchString.getText()&&this.beginIndexOfSearchWord<=this.oneAfterEndIndexOfSearchWord?this.domElementWithSearchString.getText().substring(this.beginIndexOfSearchWord,this.oneAfterEndIndexOfSearchWord):null};
QuickTextAutoCompleteRteArea.prototype.updateElementValue=function(b){var a=this.domElementWithSearchString.getText(),a=a.substring(0,this.beginIndexOfSearchWord-this.searchTrigger.length)+a.substring(this.oneAfterEndIndexOfSearchWord);this.domElementWithSearchString.setText(a);var a=this.beginIndexOfSearchWord-this.searchTrigger.length,c=new CKEDITOR.dom.range(this.editor.document);c.setStart(this.domElementWithSearchString,a);c.setEnd(this.domElementWithSearchString,a);this.editor.getSelection().selectRanges([c]);
this.editor.insertText(b)};
QuickTextAutoCompleteRteArea.prototype.getACYPosition=function(){var b=this.editor.getSelection(),a=b.getRanges()[0].startContainer,c=a.getText(),f=0,d;d=a.$.parentNode||a.$.parentElement;if(d.id===this.rteElementId+"_rta_body"){var e=document.createElement("span");e.innerText="a";d.insertBefore(e,a.$);f=Ext.get(e).getTop();d.removeChild(e)}else f=Ext.get(d).getTop();a=document.createElement("span");a.innerText=c.substring(0,b.getRanges()[0].startOffset);d.appendChild(a);b=Ext.get(a).getHeight();
a.innerText="a";this.lineHeight=Ext.get(a).getHeight();d.removeChild(a);"3"===CKEDITOR.version.substr(0,1)?d=Ext.get(this.rteElementId+"_frame").getTop():(d=Sfdc.get("#cke_"+this.rteElementId+" .cke_contents"),d=Sfdc.Dom.getElementXY(d).y);return f+d+b-Sfdc.Window.getScrollY()};QuickTextAutoCompleteRteArea.prototype.getLineHeight=function(){return null===this.lineHeight?15:this.lineHeight};QuickTextAutoCompleteRteArea.prototype.getACXPosition=function(){return Ext.get(this.rteElementId+"_div").getLeft()};
QuickTextAutoCompleteRteArea.prototype.getMinimumWidth=function(){return Sfdc.Dom.getWidth(document.getElementById(this.rteElementId+"_div"))};QuickTextAutoCompleteRteArea.prototype.positionACBox=function(){QuickTextAutoCompleteRteArea.superclass.positionACBox.call(this);this.acBox&&this.acBox.setStyle("width",this.getMinimumWidth()+"px")};QuickTextAutoCompleteRteArea.prototype.hook_show=function(){QuickTextAutoCompleteRteArea.superclass.hook_show.call(this);CKEDITOR.instances[this.rteElementId].getCommand("enter").disable()};
QuickTextAutoCompleteRteArea.prototype.hook_hide=function(){CKEDITOR.instances[this.rteElementId].getCommand("enter").enable()};
var EntityMilestonesComponent={createEntityMilestonesComponent:function(){function v(e,f){function l(d){if(d.startTimer&&d.bhStartTime){var c=DateUtil.formatDate(new Date,"yyyy-MM-ddTHH:mm:ssZ"),b=DateUtil.formatDate(new Date(d.bhStartTime),"yyyy-MM-ddTHH:mm:ssZ");d=DateUtil.formatDate(new Date(d.bhEndTime),"yyyy-MM-ddTHH:mm:ssZ");if(0===DateUtil.compareDates(b,"yyyy-MM-ddTHH:mm:ssZ",c,"yyyy-MM-ddTHH:mm:ssZ")&&0===DateUtil.compareDates(c,"yyyy-MM-ddTHH:mm:ssZ",d,"yyyy-MM-ddTHH:mm:ssZ"))return!0}return!1}
function p(d,c,b){var a=new LoadingScreen(Sfdc.get(".eWidgetBody",Sfdc.get("#"+this.parentDomId)),LC.getLabel("EntityMilestonesComponent","Loading"));a.show();Sfdc.EntityFeed.postObjectUpdate(c,{url:b,success:function(b,c){a.hide()},failure:function(b,c){a.hide()}})}function u(d,c){Sfdc.userAgent.isChrome||Sfdc.userAgent.isSafari||Sfdc.userAgent.isOpera?d.style.WebkitTransform="rotate("+c+"deg)":Sfdc.userAgent.isIE?d.style.msTransform="rotate("+c+"deg)":d.style.transform="rotate("+c+"deg)"}function s(d,
c,b){b=Math.floor(d/3600);var a=Math.floor(d/60)-60*b;d=d-3600*b-60*a;return c?0===b&&0===a?LC.getLabel("EntityMilestonesComponent","SecsViolated",d):0===b?LC.getLabel("EntityMilestonesComponent","MinsSecsViolated",a,d):LC.getLabel("EntityMilestonesComponent","HrsMinsSecsViolated",b,a,d):0===b&&0===a?LC.getLabel("EntityMilestonesComponent","Secs",d):0===b?LC.getLabel("EntityMilestonesComponent","MinsSecs",a,d):LC.getLabel("EntityMilestonesComponent","HrsMinsSecs",b,a,d)}this.parentId=e;this.parentDomId=
f;this.milestones=[];this.intervalId=null;this.milestoneListInitialized=this.currMileInitialized=!1;this.resetEntityMilestone=function(){this.milestones=[];this.milestoneListInitialized=this.currMileInitialized=!1;this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)};this.initCurrentMilestone=function(d,c){this.currMileInitialized&&this.milestoneListInitialized&&this.resetEntityMilestone();"COMPLETED"!=c.status&&this.milestones.push({milestoneId:d,isCurrentMilestone:!0,config:c,
reRenderingNeeded:null});this.currMileInitialized=!0;this.initComponent()};this.initMilestoneList=function(d){this.currMileInitialized&&this.milestoneListInitialized&&this.resetEntityMilestone();for(var c=Object.keys(d),b=0;b<c.length;b++)"COMPLETED"!=d[c[b]].status&&this.milestones.push({milestoneId:c[b],isCurrentMilestone:!1,config:d[c[b]],reRenderingNeeded:null});this.milestoneListInitialized=!0;this.initComponent()};this.initComponent=function(){for(var d=0;d<this.milestones.length;d++)this.milestones[d].reRenderingNeeded=
l(this.milestones[d].config);this.currMileInitialized&&this.milestoneListInitialized&&(this.renderTimeInfo(!0),this.startTimer())};this.renderTimeInfo=function(d){for(var c=0;c<this.milestones.length;c++)if(d||this.milestones[c].reRenderingNeeded){var b=null,b=Sfdc.get(this.parentDomId);if(Sfdc.isDefAndNotNull(b))if(this.milestones[c].isCurrentMilestone?b=Sfdc.get(".eCurrentMilestoneTimeInfo",b):(b=Sfdc.select('[data-widgetid\x3d"'+this.milestones[c].milestoneId+'"]',b),b=null===b?null:b[0]),Sfdc.isDefAndNotNull(b)){var a=
this.milestones[c].config,e=this.milestones[c].isCurrentMilestone,f=void 0,h=void 0,n=void 0,k=void 0,f=a.milestoneId;if(a.isIE8below){if(0===a.timeSinceTarget&&0===a.timeRemaining){var h=b,n=a,g=k=k=void 0,g=k=void 0,k=e?Sfdc.get(".eCurrentMilestoneTime",h):Sfdc.select('[data-milestoneid\x3d"'+n.milestoneId+'"]',h)[0],k=Sfdc.Dom.getPrevious(k,"img"),g=Sfdc.Dom.getPrevious(k,"img");Sfdc.Dom.hideByDisplay(g);Sfdc.Dom.show(k)}}else if(0<a.timeRemaining||0===a.timeSinceTarget&&0===a.timeRemaining){var m=
b,l=a,p=e,q=l.status,t=void 0,r=k=n=h=void 0;p?(t=Sfdc.get(".eCurrentMilestoneTime",m),h=Sfdc.get(".leftcircle"+q,m),n=Sfdc.get(".rightcircle"+q,m),k=Sfdc.get(".wrapper"+q,m),r=Sfdc.get(".outline"+q,m)):(t=Sfdc.select('[data-milestoneid\x3d"'+l.milestoneId+'"]',m)[0],h=Sfdc.get(".listLeftCircle"+q,m),n=Sfdc.get(".listRightCircle"+q,m),k=Sfdc.get(".listWrapper"+q,m),r=Sfdc.get(".listOutline"+q,m));g=60*l.targetResponseInMins;0<l.timeRemaining?(m=l.timeRemaining,m<=g&&(g=360*(1-m/g),u(h,g),180>g?u(n,
g):(u(n,180),k.style.clip="auto"))):0===l.timeSinceTarget&&0===l.timeRemaining&&(Sfdc.Dom.hideByDisplay(h),Sfdc.Dom.hideByDisplay(n),Sfdc.Dom.hideByDisplay(k),p?(Sfdc.Dom.removeClass(r,"outlineIN_PROGRESS"),Sfdc.Dom.addClass(r,"outlineVIOLATED")):(Sfdc.Dom.removeClass(r,"listOutlineIN_PROGRESS"),Sfdc.Dom.addClass(r,"listOutlineVIOLATED"),Sfdc.Dom.removeClass(t,"IN_PROGRESS"),Sfdc.Dom.addClass(t,"VIOLATED"),h=Sfdc.get(".milestoneicon.icon"+q,m),Sfdc.Dom.removeClass(h,"milestoneicon iconIN_PROGRESS"),
Sfdc.Dom.addClass(h,"milestoneicon iconVIOLATED")))}e?(n=Sfdc.get(".eCurrentMilestoneTime",b),k=Sfdc.get(".eCurrentMilestoneStatusLabel",b)):(n=Sfdc.select('[data-milestoneid\x3d"'+f+'"]',b)[0],k=Sfdc.get(".eMilestoneListStatusLabel",b));0<a.timeSinceTarget?(f=0<a.timeSinceTargetInDays?a.statusLabel:s(a.timeSinceTarget,!0,e),h="overdue"):0<a.timeRemaining?(f=0<a.timeRemainingInDays?a.statusLabel:s(a.timeRemaining,!1,e),h="remaining"):0===a.timeSinceTarget&&0===a.timeRemaining?(f=s(a.timeSinceTarget,
!0,e),h="overdue"):"COMPLETED"===a.status?(f=LC.getLabel("EntityMilestonesComponent","Complete"),h=""):(f=s(a.timeRemaining,!1,e),h="remaining");n.innerHTML=f;k.innerHTML=h;e||("COMPLETED"===a.status?Sfdc.Dom.addClass(n,"COMPLETED"):Sfdc.Dom.removeClass(n,"COMPLETED"))}else Sfdc.log("[Entity Milestone] Milestone element found null or undefined when rendering time info for milestone id \x3d "+this.milestones[c].milestoneId)}};this.startTimer=function(){if(0<this.milestones.length){var d=Sfdc.Function.bind(function(){var c=
Sfdc.get(this.parentDomId);if(Sfdc.isDefAndNotNull(c)){if(this.intervalId){for(var c=this.milestones,b=!1,a=0;a<c.length;a++)c[a].reRenderingNeeded=l(c[a].config),c[a].reRenderingNeeded&&(0<c[a].config.timeRemaining?c[a].config.timeRemaining--:0<c[a].config.timeSinceTarget?c[a].config.timeSinceTarget++:0===c[a].config.timeSinceTarget&&0===c[a].config.timeRemaining&&c[a].config.timeSinceTarget++,b=!0);b&&this.renderTimeInfo(!1)}}else g.closeEntityMilestone(this.parentDomId)},this);this.intervalId=
setInterval(d,1E3)}};this.completeAction=function(d,c){for(var b=0;b<this.milestones.length;b++)if(this.milestones[b].milestoneId==d){p(this,this.milestones[b].config.parentId,c);break}}}var g={},p={};g.getEntityMilestone=function(e,f){Sfdc.isDefAndNotNull(p[f])||(p[f]=new v(e,f));return p[f]};g.closeEntityMilestone=function(e){var f=p[e];Sfdc.isDefAndNotNull(f)?(f.resetEntityMilestone(),delete p[e],Sfdc.log("[Entity Milestone] EntityMilestone successfully closed for domId: "+e)):Sfdc.log("[Entity Milestone] Could not close EntityMilestone for domId: "+
e)};g.initMilestoneComponent=function(e,f){g.getEntityMilestone(e,f)};g.initCurrentMilestone=function(e,f,l){g.getEntityMilestone(l.parentId,e).initCurrentMilestone(f,l)};g.initMilestoneListComponent=function(e,f,l){g.getEntityMilestone(e,f).initMilestoneList(l)};g.completeAction=function(e,f,g){e=p[e];Sfdc.isDefAndNotNull(e)?e.completeAction(f,g):Sfdc.log("[Entity Milestone] Complete Action on milestone always requires milestone component defined. Something is wrong here")};return g}},entityMilestonesComponent=
EntityMilestonesComponent.createEntityMilestonesComponent();
Sfdc.EntityMilestonesHoverDetail=function(){};
Sfdc.EntityMilestonesHoverDetail.getHover=function(b,d){var c=LookupHoverDetail.getHover(b,d);c.position=function(){var a=getElementByIdCS(this.id),b=Sfdc.EntityMilestonesHoverDetail.getHoverPosition(a),e=b.x,c=b.y,b=a.offsetWidth,d=a.offsetHeight,f=getScrollX(),g=getScrollY(),h=getWindowWidth(),k=getWindowHeight(),a=this.originalClass+" ";c+d+this.height<g+k?(a+="top",c+=d):(a+="bottom",c-=this.height);e+b-this.bubbleOffset+this.width<f+h?(a+="Left",e=e+b/2-this.bubbleOffset):(a+="Right",e=e+b/2-
this.width);this.hover.setStyle("left",e+"px");this.hover.setStyle("top",c+"px");this.hover.div.firstChild.className=a;if(this.hover.div.firstChild&&(e=Util.hasStyleEndsWith(this.hover.div.firstChild,"Override")))delStyleClass(this.hover.div,"lookupHoverDetailOverridable"),delStyleClass(this.hover.div.firstChild,e),addStyleClass(this.hover.div,e)};return c};
Sfdc.EntityMilestonesHoverDetail.getHoverPosition=function(b){for(var d=0,c=0,a=b;null!==a&&a.offsetParent!=document.body&&a.offsetParent!=document.documentElement;)d-=a.scrollLeft?a.scrollLeft:0,c-=a.scrollTop?a.scrollTop:0,a=a.parentElement;for(;null!==b;)d+=b.offsetLeft,c+=b.offsetTop,b=b.offsetParent;return{x:d,y:c}};
Sfdc.ns("Sfdc.CaseAttachment");
Sfdc.CaseAttachment.createCaseAttachmentUtil=function(){var a=new Sfdc.DragAndDropAttachment.createDnDAttachmentUtil("ca");a.url="/caseinteraction/attachments;new";a.type="caseAttachment";a.getFormData=function(a,b,e){var c=new FormData;c.append("file",b);c.append("entityId",a);c.append("token",e.token());c.append("createMode","UPLOAD");return c};a.refresh=function(){Sfdc.EntityFeed.refreshComponents(a.config.parentId,!1,!0,!0)};a.preInitTasks=function(d){return!d?(Sfdc.on(document.body,"click",function(b){b=
Sfdc.get(b.target);if(Sfdc.Dom.hasClass(b,"caDragAndDropCancel"))return d;a.hideAttachmentErrorList(a.config.componentId)}),!0):d};return a};window.caseAttachmentUtil=window.caseAttachmentUtil||new Sfdc.CaseAttachment.createCaseAttachmentUtil;
Sfdc.provide("Sfdc.EmailAttachments",function(){function l(c){var a=new Sfdc.DragAndDropAttachment.createDnDAttachmentUtil("ea");a.url="/draftemail/attachments;new";a.type="emailAttachment";a.getComponentId=function(){return c.componentId};a.getTempEmailId=function(){return c.tempEmailId};a.hideAttachmentCallouts=function(b){a.hideAttachmentList(b);a.hideAttachmentErrorList(b)};a.unFocusAttachmentCallouts=function(b,c){a.unFocusAttachmentList(b,c);a.hideAttachmentErrorList(c)};a.toggleAttachmentList=
function(b){var c=Sfdc.get(".zen.eaAttachmentCallout",Sfdc.get(b));Sfdc.Dom.isVisible(c)?Sfdc.Dom.hideByDisplay(c):(a.hideAttachmentErrorList(b),a.hideAttachmentProgressBar(b),Sfdc.Dom.show(c))};a.hideAttachmentList=function(b){b=Sfdc.get(".zen.eaAttachmentCallout",Sfdc.get(b));Sfdc.Dom.isVisible(b)&&Sfdc.Dom.hideByDisplay(b)};a.unFocusAttachmentList=function(b,c){var d=Sfdc.get(b.target);d&&!("eaAttachmentListLink"===Sfdc.Dom.get(d,"className")||Sfdc.Dom.getParent(d,".eaAttachmentListLink")||Sfdc.Dom.getParent(d,
".eaAttachmentCallout"))&&a.hideAttachmentList(c)};a.refresh=function(){var b=a.config;a.refreshAttachments(b.componentId,b.entityId,b.parentId)};a.refreshAttachments=function(b,a,d){Sfdc.EntityFeed.get({url:"/draftemail/attachments",params:{tempEmailId:d,entityId:a},success:function(b,a){Sfdc.EntityFeed.getEventBus().fireEvent("case:attachments","afterRefreshAttachments",{entityId:c.entityId,tempEmailId:c.tempEmailId,attachmentListHtml:a.attachmentListHtml,totalAttachments:a.totalAttachments})}})};
a.updateAttachmentCount=function(b,c){var d=Sfdc.get(b),e=Sfdc.select("a.eaAttachmentListLink",d)[0],g=Sfdc.get(".eaTotalAttachmentCount",d);Sfdc.Dom.set(g,"value",c);0<c?(Sfdc.Dom.updateHTML(e,c),3<c?(d=Sfdc.get(".eaEmailAttachmentList",d))&&Sfdc.Dom.addClass(d,"eaEmailAttachmentListScroll"):(d=Sfdc.get(".eaEmailAttachmentListScroll",d))&&Sfdc.Dom.removeClass(d,"eaEmailAttachmentListScroll")):(Sfdc.Dom.updateHTML(e,""),a.hideAttachmentList(b))};a.renderAttachmentList=function(b,f,d){var e=Sfdc.get(b),
e=Sfdc.get(".eaAttachFileList.zen-body",e);f&&Sfdc.Dom.updateHTML(e,f);a.updateAttachmentCount(b,d);Sfdc.EntityFeed.getEventBus().fireEvent("case:attachments","onAfterRenderAttachment",{entityId:c.entityId,tempEmailId:c.tempEmailId,totalAttachments:d})};a.addAttachments=function(b,a,c,e){Sfdc.EntityFeed.post({url:"/draftemail/attachments;new",params:{tempEmailId:b,attachmentIds:a.toString(),createMode:"ASSOCIATE"},success:c,failure:e})};a.removeAttachment=function(a,f){var d=Sfdc.Dom.getParent(a,
".eaLiAttachment");confirm(LC.getLabel("EmailAttachment","DeleteWarning"))&&Sfdc.EntityFeed.post({url:"/draftemail/attachments/"+f+";delete",params:{entityId:c.entityId},success:function(e,g){var h=Sfdc.Dom.getParent(a,".emailAttachment");Sfdc.Dom.removeChild(d);h=Sfdc.get(".eaTotalAttachmentCount",h);h=parseInt(Sfdc.Dom.get(h,"value"),10)-1;Sfdc.EntityFeed.getEventBus().fireEvent("case:attachments","afterUpdateAttachments",{entityId:c.entityId,tempEmailId:c.tempEmailId,totalAttachments:h});Sfdc.EntityFeed.getEventBus().fireEvent("case:attachments",
"onAfterRemoveAttachment",{entityId:c.entityId,tempEmailId:c.tempEmailId,attachmentId:f})}})};a.refreshAttachmentElement=function(a,f){var d=Sfdc.get(".emailAttachment",a);if(d&&d.id===c.componentId){var e=d.parentNode;Sfdc.Dom.removeChild(d);Sfdc.Dom.insertHTML(e,f);d=Sfdc.get(".emailAttachment",a);Sfdc.Resource.execScripts(Sfdc.Resource.getScriptsFromHtml(d))}};a.preInitTasks=function(b){return!b?(Sfdc.on(document,"keydown",function(b){Sfdc.Event.isKeyAction(b,Sfdc.Event.keyCode.ESC)&&(a.hideAttachmentCallouts(c.componentId),
a.hideAttachmentList(c.componentId))}),Sfdc.on(document.body,"click",function(f){var d=Sfdc.get(f.target);if(Sfdc.Dom.hasClass(d,"eaDragAndDropCancel"))return b;a.unFocusAttachmentCallouts(f,c.componentId)}),!0):b};a.getFormData=function(a,c,d){var e=new FormData;e.append("file",c);e.append("token",d.token());e.append("entityId",a);e.append("iborder","0");e.append("tempEmailId",a);e.append("createMode","UPLOAD");e.append("omode","1");e.append("otype","2");e.append("smode","0");e.append("utype","00P");
e.append("Attach","Attach To Email");return e};c.dropzoneId&&a.initDragAndDropAttachmentHandle({componentId:c.componentId,entityId:c.entityId,parentId:c.tempEmailId,dropzoneId:c.dropzoneId});return a}function g(c,a){var b=k[c];return b&&b.getTempEmailId()===a?b:null}var k={};Sfdc.onload(function(){Sfdc.EntityFeed.getEventBus().addEventListener("case:attachments","afterUpdateAttachments",function(c,a){var b=g(a.entityId,a.tempEmailId);b&&b.updateAttachmentCount(b.getComponentId(),a.totalAttachments)});
Sfdc.EntityFeed.getEventBus().addEventListener("case:attachments","afterRefreshAttachments",function(c,a){var b=g(a.entityId,a.tempEmailId);b&&b.renderAttachmentList(b.getComponentId(),a.attachmentListHtml,a.totalAttachments)});Sfdc.EntityFeed.getEventBus().addEventListener("case:attachments","onAfterNewAttachment",function(c,a){var b=g(a.entityId,a.tempEmailId);b&&b.refreshAttachments(b.getComponentId(),a.entityId,a.tempEmailId)})});return{addAttachments:function(c,a,b,f,d){(c=g(c,a))&&c.addAttachments(a,
b,f,d)},removeAttachment:function(c,a,b,f){(a=g(a,b))&&a.removeAttachment(c,f)},toggleAttachmentList:function(c,a){var b=g(c,a);b&&b.toggleAttachmentList(b.getComponentId())},refreshAttachments:function(c,a){var b=g(c,a);b&&b.refreshAttachments(b.getComponentId(),c,a)},renderAttachmentList:function(c,a,b,f){(c=g(c,a))&&c.renderAttachmentList(c.getComponentId(),b,f)},refreshAttachmentElement:function(c,a,b,f){(c=k[c])&&c.refreshAttachmentElement(b,f)},initAttachments:function(c){var a=l(c);k[c.entityId]=
a}}}());
Sfdc.provide("SfdcApp.CaseFeedPage",function(){function n(a){if(e["emailPublisher_"+a])return e["emailPublisher_"+a];caseInteraction.getUtil().log("Array index emailPublisher_"+a+" is not initialized.")}function p(){this.sendEmail=function(a){(a=caseInteraction.getEmailPublisher(ApiUtils.to15CharId(a)))&&a.submit()};this.publishAnswer=function(a){(a=caseInteraction.getPublicCommentPublisher(ApiUtils.to15CharId(a)))&&a.submit()};this.logCall=function(a){(a=caseInteraction.getLogCallPublisher(ApiUtils.to15CharId(a)))&&
a.submit()};this.searchArticles=function(a,b){var c=Ext.select("*[id$\x3d:"+a+"]").first();c&&(c=caseInteraction.getCaseArticles().getFirstCaseArticlesComponentByParent(c))&&c.searchArticles(null,b)}}function q(a,b,c){this.menuButton=new MenuButtonRounded(a,b,6);this.id=a;this.currentPublisher=c;this.hide=function(){this.menuButton.hide()};this.switchPublisher=function(a,b){this.menuButton.hide();if(this.currentPublisher!=a){var c=this.currentPublisher+"HeaderClass",e=a+"HeaderClass";Ext.get(this.id).dom.title=
b;Ext.get(this.id+MenuButtonElement.LABEL).dom.innerHTML=b;Ext.select(".casePublisher .headerContent .menuButtonMenu span.selected").removeClass("selected");Ext.select(".casePublisher .headerContent .menuButtonMenu ."+a).addClass("selected");Ext.query(".casePublisher .headerContent ."+a);var d=Ext.select(".casePublisher .headerContent ."+this.currentPublisher);caseInteraction.getUtil().hide(d);d=Ext.select(".casePublisher .detailContent ."+this.currentPublisher);caseInteraction.getUtil().hide(d);
if(d=Ext.select(".casePublisher ."+c))d.removeClass(c),d.addClass(e);this.currentPublisher=a;c=Ext.select(".casePublisher .headerContent ."+a);caseInteraction.getUtil().show(c);c=Ext.select(".casePublisher .detailContent ."+a);caseInteraction.getUtil().show(c);(c=Ext.select(".casePublisher .etContainer"))&&("Email"==a?caseInteraction.getUtil().show(c):caseInteraction.getUtil().hide(c))}}}Sfdc.onload(function(){SfdcApp.CaseFeed.getCaseFeed().onPageLoadInit()});var f={},g={},e={},h={},k={},l,m={};return{getCaseFeed:function(){return SfdcApp.CaseFeed.getCaseFeed()},
getCaseArticles:function(){return SfdcApp.CaseArticles.getCaseArticles()},initEmailTemplateComponent:function(a){a&&(f["emailTemplateComponent_"+a.caseId]=SfdcApp.EmailTemplates.createEmailTemplateComponent(a))},getEmailTemplateComponent:function(a){a="emailTemplateComponent_"+a;a=f[a]?f[a]:void 0;return a},getChangeStatusPublisherAction:function(a){g["changeStatusPublisher_"+a]?a=g["changeStatusPublisher_"+a]:(caseInteraction.getUtil().log("Array index changeStatusPublisher_"+a+" is not initialized."),
a=void 0);return a},initChangeStatusPublisherAction:function(a,b,c){b?g["changeStatusPublisher_"+a]=SfdcApp.CaseChangeStatusPublisherAction.create(b,c):caseInteraction.getUtil().log("Specs Object should be initialized.")},getEmailPublisherAction:function(a){return n(a)},initEmailPublisherAction:function(a,b){b?(e["emailPublisher_"+a]=SfdcApp.CaseEmailPublisherAction.create(b)).getTextState().makeResizable():caseInteraction.getUtil().log("Specs Object should be initialized.")},switchModeForId:function(a){a=
caseInteraction.getUtil().extractCaseId(a);emailPublisher=caseInteraction.getEmailPublisher(a);emailPublisher.switchMode()},getEmailPublisherActionTempEmailId:function(a){n(a)?a=emailPubObj.getTempEmailId():(a=entityFeedPage.getComponentState(a,"CaseEmailPublisher"),a=null!==a?a.tempEmailId:null);return a},getLogCallPublisherAction:function(a){h["logCallPublisher_"+a]?a=h["logCallPublisher_"+a]:(caseInteraction.getUtil().log("Array index logCallPublisher_"+a+" is not initialized."),a=void 0);return a},
initLogCallPublisherAction:function(a,b){b?h["logCallPublisher_"+a]=SfdcApp.CaseLogCallPublisherAction.create(b):caseInteraction.getUtil().log("Specs Object should be initialized.")},getPortalPublisherAction:function(a){k["publicCommentPublisher_"+a]?a=k["publicCommentPublisher_"+a]:(caseInteraction.getUtil().log("Array index publicCommentPublisher_"+a+" is not initialized."),a=void 0);return a},initPortalPublisherAction:function(a,b){b?k["publicCommentPublisher_"+a]=SfdcApp.CasePortalPublisherAction.create(b):
caseInteraction.getUtil().log("Specs Object should be initialized.")},getPublicComponentsApi:function(){l||(l=new p);return l},getUtil:function(){return SfdcApp.CaseFeedUtil.getUtil()},initSwitchPublisherMink:function(a,b,c){b=new q(a,b,c);m[a]=b},getSwitchPublisherMink:function(a){a=a&&m[a]?m[a]:null;return a}}}());
Sfdc.ns("Sfdc.CaseInteraction");
Sfdc.CaseInteraction.createCaseInteraction=function(){return{getCaseFeed:function(){return SfdcApp.CaseFeedPage.getCaseFeed()},getCaseArticles:function(){return SfdcApp.CaseFeedPage.getCaseArticles()},initEmailTemplateComponent:function(a){return SfdcApp.CaseFeedPage.initEmailTemplateComponent(a)},getEmailTemplateComponent:function(a){return SfdcApp.CaseFeedPage.getEmailTemplateComponent(a)},getPublicCommentPublisher:function(a){return SfdcApp.CaseFeedPage.getPortalPublisherAction(a)},initPublicCommentPublisher:function(a,
b){return SfdcApp.CaseFeedPage.initPortalPublisherAction(a,b)},switchModeForId:function(a){return SfdcApp.CaseFeedPage.switchModeForId(a)},getEmailPublisher:function(a){return SfdcApp.CaseFeedPage.getEmailPublisherAction(a)},initEmailPublisher:function(a,b){return SfdcApp.CaseFeedPage.initEmailPublisherAction(a,b)},getEmailPublisherTempEmailId:function(a){return SfdcApp.CaseFeedPage.getEmailPublisherActionTempEmailId(a)},getLogCallPublisher:function(a){return SfdcApp.CaseFeedPage.getLogCallPublisherAction(a)},
initLogCallPublisher:function(a,b){return SfdcApp.CaseFeedPage.initLogCallPublisherAction(a,b)},getChangeStatusPublisher:function(a){return SfdcApp.CaseFeedPage.getChangeStatusPublisherAction(a)},initChangeStatusPublisher:function(a,b,c){return SfdcApp.CaseFeedPage.initChangeStatusPublisherAction(a,b,c)},getPublicComponentsApi:function(){return SfdcApp.CaseFeedPage.getPublicComponentsApi()},getUtil:function(){return SfdcApp.CaseFeedPage.getUtil()},initSwitchPublisherMink:function(a,b,c){return SfdcApp.CaseFeedPage.initSwitchPublisherMink(a,
b,c)},getSwitchPublisherMink:function(a){return SfdcApp.CaseFeedPage.getSwitchPublisherMink(a)},getSection:function(){return"CaseInteraction"}}};var caseInteraction=Sfdc.CaseInteraction.createCaseInteraction();

//# sourceMappingURL=/javascript/1426154839000/sfdc/source/CaseInteraction.js.map
